<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>rails javascript include external &#183; RailsApps</title>
    <link href="https://plus.google.com/u/0/b/117374718581973393536/117374718581973393536/posts/" rel="publisher" />
    <link rel="stylesheet" href="http://railsapps.github.com/css/bootstrap.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="http://railsapps.github.com/css/screen.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="http://railsapps.github.com/css/gollum.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="http://railsapps.github.com/css/site.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="http://railsapps.github.com/css/syntax.css" type="text/css" charset="utf-8" />
    <script src="http://code.jquery.com/jquery-1.6.min.js" type="text/javascript"></script>
    <script src="http://railsapps.github.com/javascript/jquery.text_selection-1.0.0.min.js" type="text/javascript"></script>
    <script src="http://railsapps.github.com/javascript/jquery.previewable_comment_form.js" type="text/javascript"></script>
    <script src="http://railsapps.github.com/javascript/jquery.tabs.js" type="text/javascript"></script>
    <script src="http://railsapps.github.com/javascript/gollum.js" type="text/javascript"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-5109366-14']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body>

  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a href="http://railsapps.github.com/" class="brand">RailsApps Project</a>
        <ul class="pull-right nav">
          <li><a href="http://blog.railsapps.org/" class="twitter">Blog</a></li>
          <li><a href="http://twitter.com/rails_apps" class="twitter">Twitter</a></li>
          <li><a href="https://plus.google.com/117374718581973393536" class="google">Google +</a></li>
          <li><a href="https://github.com/RailsApps" class="github">GitHub Repository</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container"> 

    <div class="content wikistyle gollum textile">
      <h1>Including External JavaScript Files in Rails</h1>
<h4>by Daniel Kehoe</h4>
<p><em>Last updated 17 September 2012</em></p>
<p>How to include external JavaScript files in Rails 3.1 or newer. There is no import, include, or require in JavaScript, so what is the best way to add an external JavaScript library to the Rails asset pipeline? A summary of your options, including using the <a href="http://api.jquery.com/jQuery.getScript/">jQuery <code>getScript</code> method</a> to load a JavaScript file from within a JavaScript file.</p>
<p><em>This is a draft of a work in progress. Is the article accurate? Does it reflect recommended practices? Please <a href="#comment">leave a comment</a> below.</em></p>
<p>This is a guide for developers using the example apps from the RailsApps repository. The <a href="http://railsapps.github.com/">RailsApps project</a> provides open source apps and detailed tutorials for Rails developers.</p>
<h2>JavaScript’s Missing Directive</h2>
<p>The C language has <code>#include</code>, Java has <code>import</code>, Perl has <code>use</code> or <code>require</code>, <span class="caps">PHP</span> has <code>include</code> or <code>require</code>, and Ruby has <code>require</code>. These directives add the contents of one file into another. Often these directives are used to incorporate code libraries provided by other developers. Some languages also have a package manager that provides a standard format for distributing programs and libraries (Ruby has RubyGems). What’s the equivalent in JavaScript? Nothing. JavaScript doesn’t have a native package manager or import directive.</p>
<p>Instead, you’re expected to include all the JavaScript files you require for a web page in a series of <span class="caps">HTML</span>  <code>&lt;script&gt;</code> tags typically placed between the <code>&lt;head&gt;</code> tags at the top of an <span class="caps">HTML</span> file. The order of placement is important. The web browser compiles the JavaScript code sequentially. If your code requires an external library, the external script must be listed first.</p>
<h2>Rails and the Asset Pipeline</h2>
<p>Rails 3.1 introduced the asset pipeline in August 2011. Before that, Rails did very little to manage JavaScript. The <code>javascript_include_tag</code> served as a helper to construct a <code>&lt;script&gt;</code> tag. You also could specify <code>&lt;%= javascript_include_tag :defaults %&gt;</code> to incorporate a list of JavaScript files specified in the <strong>config/application.rb</strong> file. Before Rails 3.1, you would use a <code>javascript_include_tag</code> on application layouts or page-specific view files to add every script required for your web pages.</p>
<p>The Rails asset pipeline adds some of the functionality of a package manager for your project-specific JavaScript code. You can organize multiple JavaScript files in the <strong>app/assets/javascripts</strong> folder. The default <strong>app/assets/javascripts/application.js</strong> file serves as a manifest file, specifying which files you require. By default, the file’s <code>//= require_tree .</code> recursively includes all JavaScript files in the <strong>app/assets/javascripts</strong> directory. Sprockets, the mechanism that powers the Rails asset pipeline, will concatenate and minify all the specified JavaScript files into a single <strong>application.js</strong> file which you can include in your application layout with the &lt;%= javascript_include_tag “application” %&gt; statement. Sprockets also performs preprocessing so you can write JavaScript as CoffeeScript or include Ruby code as an <span class="caps">ERB</span> file. Order of execution is still important; a manifest file must list each JavaScript file in dependent order.</p>
<h2>External Scripts</h2>
<p>The Rails asset pipeline is a powerful tool for managing project-specific JavaScript code; however, it doesn’t offer a facility for managing JavaScript files that are obtained outside of your own application. External scripts, those that are downloaded by a web browser from a remote web server, must be specified as they were before Rails 3.1; that is, with a helper such as &lt;%= javascript_include_tag “http://example.com/example.js” %&gt; included in an application layout or view file.</p>
<h2>Simple Dependencies</h2>
<p>Some external scripts work independently of your project-specific JavaScript code. For example, you might add  <br><code>&lt;%= javascript_include_tag 'http://html5shiv.googlecode.com/svn/trunk/html5.js' %&gt;</code> to your application layout to support HTML5 tags in old versions of Internet Explorer. Your own JavaScript would not be dependent on the file and you could load it either before or after your <strong>application.js</strong> script (though in the case of HTML5Shiv you’d want to load it before any <span class="caps">CSS</span> files).</p>
<p>Some external scripts have simple dependency chains. In your <strong>application.js</strong> file, your manifest might specify project-specific JavaScript files that use methods from the Google Maps <span class="caps">API</span>. You’d have to load the Google Maps <span class="caps">API</span> before your <strong>application.js</strong> script with a tag such as <code>&lt;%= javascript_include_tag 'http://maps.googleapis.com/maps/api/js?sensor=false' %&gt;</code>.</p>
<h2>Complex Dependencies</h2>
<p>Now consider the problem of external scripts that are dependent on jQuery, which is loaded by the Rails asset pipeline. For example, you might wish to use a jQuery plugin. You could load it with a <code>javascript_include_tag</code>  following the &lt;%= javascript_include_tag “application” %&gt; statement. But what if you wanted to use the jQuery plugin methods in your own project-specific JavaScript code which is managed by the Rails asset pipeline? You’re faced with the problem of inserting the external script in the middle of the asset pipeline which apparently can’t be done. Suppose you wished to use a jQuery validation plugin. You could try something like this:</p>
<pre>
&lt;%= javascript_include_tag 'application' %&gt;
&lt;%= javascript_include_tag 'http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js' %&gt;
&lt;%= javascript_include_tag 'code_that_uses_the_validation_plugin' %&gt;
</pre>
<p>But you’re no longer using the asset pipeline to manage your JavaScript files. It’s easier to simply copy the plugin script to your own application. You could put it in the <strong>app/assets/javascripts</strong> folder; by convention, the preferred location is in the <strong>vendor/assets/javascripts</strong> folder. You must specify it in your <strong>application.js</strong> manifest as you would your own code, like this:</p>
<pre>
//= require jquery
//= require jquery_ujs
//= require jquery.validate.min
</pre>
<h2>Including a JavaScript File From Within a JavaScript File</h2>
<p>I said that <em>apparently</em> one cannot insert an external script in the middle of the asset pipeline. In fact it can be done, despite JavaScript’s lack of an import directive. You can use the <a href="http://api.jquery.com/jQuery.getScript/">jQuery <code>getScript</code> method</a> to load a JavaScript file from within a JavaScript file. There may be times when you don’t want to store a copy of an external file locally.</p>
<p>Consider this example. I want to use the Stripe JavaScript library to initiate transactions for credit card payment. I don’t want to store the Stripe code on my server because of the risk that someone could gain access to my server and change the code to intercept credit card data. I could use two successive javascript_include_tag statements to set up the code:</p>
<pre>
&lt;%= javascript_include_tag 'https://js.stripe.com/v1/' %&gt;
&lt;%= javascript_include_tag 'application' %&gt;
</pre>
<p>I could consolidate the two statements like this:</p>
<pre>
&lt;%= javascript_include_tag 'https://js.stripe.com/v1/', 'application' %&gt;
</pre>
<p>Alternatively, I could use the jQuery <code>getScript</code> method:</p>
<p>Create a file <strong>app/assets/javascripts/stripe.js.erb</strong>:</p>
<pre>
$.getScript('https://js.stripe.com/v1/', function(){
  if (typeof Stripe != 'undefined') {
    console.log('Okay. Stripe JavaScript file loaded.');
  }
  else
  {
    console.log('Problem. Stripe JavaScript file not loaded.');
  }
});
</pre>
<p>If I want to use the Stripe library on any page of my application, it is now available with nothing more than the default <code>&lt;%= javascript_include_tag "application" %&gt;</code> in the application layout, provided the <strong>application.js</strong> manifest includes <code>//= require_tree .</code>. (If you want to include it only on specific pages, see below.)</p>
<h2>Page-Specific JavaScript</h2>
<p>For small applications with only a few pages, there may be no need to configure your application for page-specific JavaScript. Often JavaScript is written to interact with specific elements on a page; if so, the browser will evaluate the JavaScript for each page but only activate it if the appropriate page element is present. For organizational efficiency during development, place the JavaScript code in a separate file and give it a name that corresponds to the view. Then let Sprockets concatenate and minify all your JavaScript files into a single <strong>application.js</strong> file. The default directive <code>//= require_tree .</code> in the  <strong>app/assets/javascripts/application.js</strong> manifest file will recursively include all JavaScript files in the <strong>app/assets/javascripts</strong> directory. Or remove the <code>//= require_tree .</code> directive and list each file individually.</p>
<p>For large applications, you must weigh the organizational benefit of consolidating and processing all JavaScript code with the performance efficiency of processing JavaScript code only on specific pages. Complicating the equation is the performance overhead of opening a server connection for multiple files, mitigated when the files are cached by the browser. Intuitively it may seem the browser will be more efficient if it only processes code for a specific page but there will be a performance penalty for downloading additional files unless the files are cached. You may need to profile performance to know for sure. For rudimentary analysis, use the “Network” tab in the WebKit developer tools (in Chrome or Safari) or Firebug (in Firefox). Use the <a href="http://developer.yahoo.com/yslow/">Yslow</a> tool for a detailed analysis of web page performance factors. See an article from New Relic on <a href="http://blog.newrelic.com/2012/09/04/improving-site-performance-with-yslow/">Improving Site Performance with YSlow</a>.</p>
<p>Consider again our example of the Stripe JavaScript library. Our example site uses the Stripe script only on a single page where the visitor makes a credit card payment. There will be a performance cost to download and cache the Stripe JavaScript file but we know that only a small number of visitors to the site will be visiting the payment page. In this case, it makes sense to load the file as page-specific JavaScript.</p>
<h2>Application Layout for Page-Specific JavaScript</h2>
<p>For page-specific JavaScript, you’ll need to add a <code>javascript_include_tag</code> to the <code>head</code> section of your page view. One approach is to modify your controller to use a custom layout for the view (see a range of approaches in the RailsGuide <a href="http://guides.rubyonrails.org/layouts_and_rendering.html#using-render">Layouts and Rendering in Rails</a>). Such a minor customization defeats the purpose of the site-wide application layout; fortunately, Rails offers a better option.</p>
<p>It’s best to set up your application layout with a <code>&lt;%= yield(:head) %&gt;</code> statement so you can inject additional tags in the <code>head</code> section of the view. See an example of a <a href="http://railsapps.github.com/rails-default-application-layout.html">Rails Default Application Layout</a> from the RailsApps project. Here’s an example of the <code>head</code> section:</p>
<pre>
&lt;head&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;&lt;%= content_for?(:title) ? yield(:title) : "App_Name" %&gt;&lt;/title&gt;
  &lt;meta name="description" content="&lt;%= content_for?(:description) ? yield(:description) : "App_Name" %&gt;"&gt;
  &lt;%= stylesheet_link_tag "application", :media =&gt; "all" %&gt;
  &lt;%= javascript_include_tag "application" %&gt;
  &lt;%= csrf_meta_tags %&gt;
  &lt;%= yield(:head) %&gt;
&lt;/head&gt;
</pre>
<p>The <code>&lt;%= yield(:head) %&gt;</code> statement follows the <code>&lt;%= javascript_include_tag "application" %&gt;</code> so you can use jQuery in any page-specific JavaScript code you add.</p>
<h2>Using <code>content_for</code> for Page-Specific JavaScript</h2>
<h2 id="comment">Credits</h2>
<p>Daniel Kehoe wrote this article for the RailsApps project.</p>
<p>Was this useful to you? Follow me on Twitter:<br><a href="http://twitter.com/rails_apps">rails_apps</a><br>
and tweet some praise. I’d love to know you were helped out by the article.</p>
    </div><!-- class="content" -->
    
    <div class="comments">
      <div class="content wikistyle gollum">
        <h2>Comments</h2>
      </div>
      <p>Is this helpful? Your encouragement fuels the project. Please tweet or add a comment. Couldn't get something to work? For the example apps and tutorials, it's best to open an issue on GitHub so we can help you.</p> 
      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'railsapps'; // required: replace example with your forum shortname
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div><!-- class="comments" -->

    <div class="footer row">
      <div class="span4">
      </div>
    
      <div class="span4">
       </div>

      <div class="span4">
      </div>
    </div>

  </div>
            
  </body>
</html>
