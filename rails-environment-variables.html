<!DOCTYPE html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Configuring Rails Environment Variables &#183; RailsApps</title>
  <meta name="viewport" content="width=device-width">
  <link href="https://plus.google.com/117374718581973393536" rel="publisher">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.2.2/css/normalize.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.2.2/css/foundation.min.css">
  <link rel="stylesheet" href="http://railsapps.github.io/css/railsapps.css" />
  <link rel="stylesheet" href="http://railsapps.github.io/css/syntax.css" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="http://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    <script type="text/javascript">
  window.analytics=window.analytics||[],window.analytics.methods=["identify","group","track","page","pageview","alias","ready","on","once","off","trackLink","trackForm","trackClick","trackSubmit"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var key=window.analytics.methods[i];window.analytics[key]=window.analytics.factory(key)}window.analytics.load=function(t){if(!document.getElementById("analytics-js")){var a=document.createElement("script");a.type="text/javascript",a.id="analytics-js",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.io/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)}},window.analytics.SNIPPET_VERSION="2.0.9",
    window.analytics.load("l1stqfqqbf");
    window.analytics.page();
    window.analytics.ready(function () {
      ga('require', 'linker');
      ga('linker:autoLink', ['railscomposer.com','learn-rails.com','blog.railsapps.org','tutorials.railsapps.org']);
    });
    </script>
</head>
<body>
  <div class="fixed">
    <nav class="top-bar" data-topbar>
      <ul class="title-area">
        <li class="name">
          <a href="http://railsapps.github.io/" class="brand">RailsApps Project</a>
        </li>
        <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
      </ul>
      <section class="top-bar-section">
        <ul class="right">
          <li><a href="https://tutorials.railsapps.org/" class="google">Tutorials</a></li>
          <li><a href="http://twitter.com/rails_apps" class="twitter">Twitter</a></li>
          <li><a href="http://blog.railsapps.org/" class="twitter">Blog</a></li>
          <li><a href="https://github.com/RailsApps" class="github">GitHub Repository</a></li>
        </ul>
      </section>
    </nav>
  </div>
  <div class="row">
    <div class="large-12 columns">
      <div class="content wikistyle gollum textile">
        h1. Rails Environment Variables

h4. by Taylor Mock and Daniel Kehoe

_Last updated 15 December 2012_

Setting Rails environment variables. Using ENV variables in Rails, locally and with Heroku. Rails configuration and security with environment variables.

h4. If You Are New to Rails

If you're new to Rails, see "What is Ruby on Rails?":http://railsapps.github.io/what-is-ruby-rails.html, the book "Learn Ruby on Rails":http://learn-rails.com/learn-ruby-on-rails.html, and recommendations for a "Rails tutorial":https://tutorials.railsapps.org/rails-tutorial.

h4. !http://railsapps.github.io/images/join/join-railsapps.png(Join RailsApps)!:http://railsapps.github.io/

h4. What is the RailsApps Project?

This is an article from the RailsApps project. The "RailsApps project":http://railsapps.github.io/ provides example applications that developers use as starter apps. Hundreds of developers use the apps, report problems as they arise, and propose solutions. Rails changes frequently; each application is known to work and serves as your personal "reference implementation." Each application is accompanied by a tutorial so there is no mystery code. Support for the project comes from subscribers. Please accept our invitation to "join the RailsApps project":http://railsapps.github.io/.

h2. Environment Variables

Many applications require configuration of settings such as email account credentials or API keys for external services. You can pass local configuration settings to an application using environment variables.

Operating systems (Linux, Mac OS X, Windows) provide mechanisms to set local "environment variables":http://en.wikipedia.org/wiki/Environment_variable, as does "Heroku":http://www.heroku.com/ and other deployment platforms. Here we show how to set local environment variables in the Unix shell. We also show two alternatives to set environment variables in your application without the Unix shell.

h2. Keeping Environment Variables Private

Remote "git repositories":http://railsapps.github.io/rails-git.html such as "GitHub":https://github.com/signup/free are a place to store and share code. If your project is open source, any developer will have access to your code. You don't want to share email account credentials or private API keys with the public. If you're collaborating on a team with a private git repository, your local settings may not be suitable for all members of the team. In general, you shouldn't save email account credentials or private API keys to a shared git repository.

h2. Gmail Example

Consider an application that uses Gmail to send email messages. Access to Gmail requires a username and password for access to your Gmail account. In your Rails application, you will need to configure these credentials in the file *config/environments/production.rb*. A portion of the file might look like this:

<pre>
config.action_mailer.smtp_settings = {
  address: "smtp.gmail.com",
  port: 587,
  domain: "example.com",
  authentication: "plain",
  enable_starttls_auto: true,
  user_name: ENV["GMAIL_USERNAME"],
  password: ENV["GMAIL_PASSWORD"]
}
</pre>

You could "hardcode" your Gmail username and password into the file but that would expose it to everyone who has access to your git repository. Instead use the Ruby variable @ENV["GMAIL_USERNAME"]@ to obtain an environment variable. The variable can be used anywhere in a Rails application. Ruby will replace @ENV["GMAIL_USERNAME"]@ with an environment variable.

Let's consider how to set local environment variables.

h2. Option One: Set Unix Environment Variables

If you're familiar with Unix, you've likely had experience setting environment variables. Unix environment variables are typically set in a file that is read when starting an interactive shell (the *~/.bashrc* file for the bash shell).

Are you using a bash shell? Use @echo $SHELL@ to find out. For a bash shell, using the Gmail example, edit the *~/.bashrc* file and add:

<pre>
export GMAIL_USERNAME="myname@gmail.com"
</pre>

You'll have to open a new shell or restart your terminal application to continue.

It's important to learn to use the Unix shell if you're commited to improving your skills as a developer. But troubleshooting shell problems can be difficult, especially when using rvm, the "Ruby Version Manager":https://rvm.io/, or when the application is launched in nonstandard ways.

We'll show you two alternatives to using the Unix shell that only require a few lines of code in your Rails application to set environment variables. Use one of these alternative approaches when you don't want to set environment variables in the Unix shell.

h2. Option Two: Use the Figaro Gem

The "figaro gem":https://github.com/laserlemon/figaro offers a practical alternative to setting environment variables in the Unix shell.

The gem takes advantage of Ruby's ability to set environment variables as well as read them. The gem reads a  *config/application.yml* file and sets environment variables before anything else is configured in the Rails application.

If you want to use different credentials in development, test, or production environments, the gem will let you specify the different credentials in the *config/application.yml* file. If you're deploying to Heroku, the gem gives you a rake task that will set all the environment variables on Heroku. The gem also gives you a syntax to access the environment variables as Figaro method calls which can be useful in setting up tests.

The figaro gem makes it so easy to set configuration variables you may find it useful to set other configuration parameters besides email account credentials or private API keys.

Here's how to use it. In your *Gemfile*, add:

<pre>
gem 'figaro'
</pre>

and run @$ bundle install@.

The gem provides a generator:

<pre>
$ bundle exec figaro install
</pre>

The generator creates a *config/application.yml* file and modifies the *.gitignore* file to prevent the file from being checked into a git repository.

You can add environment variables as key/value pairs to *config/application.yml*:

<pre>
GMAIL_USERNAME: Your_Username
</pre>

The environment variables will be available anywhere in your application as ENV variables:

<pre>
ENV["GMAIL_USERNAME"]
</pre>

This gives you the convenience of using the same variables in code whether they are set by the Unix shell or the figaro gem's *config/application.yml*. Variables in the *config/application.yml* file will override environment variables set in the Unix shell.

In tests or other situations where ENV variables might not be appropriate, you can access the configuration values as Figaro method calls:

<pre>
Figaro.env.gmail_username
</pre>

Use this syntax for setting different credentials in development, test, or production environments:

<pre>
HELLO: world
development:
  HELLO: developers
production:
  HELLO: users
</pre>

In this case, @ENV["HELLO"]@ will produce "developers" in development, "users" in production and "world" otherwise.

Figaro provides a rake task to set the environment variables in the *config/application.yml* file as Heroku environment variables:

<pre>
rake figaro:heroku
</pre>

If you're using one of the "RailsApps example applications":http://railsapps.github.io/ or you have generated a starter application using the "Rails Composer":http://railsapps.github.io/rails-composer/ tool, you'll find a file named *config/application.yml*. This file was added by the figaro gem and contains key/value entries for each environment variable you may need. Each entry is commented out. Remove the comment character if you want to override environment variables from the Unix shell or set the environment variables using the *config/application.yml* file.

h2. Option Three: Use a _local_env.yml_ File

Like the "figaro gem":https://github.com/laserlemon/figaro, this technique takes advantage of Ruby's ability to set environment variables as well as read them. The figaro gem has additional features and we recommend it. However, if you want to understand how to set environment variables from within your Rails application, or you don't want to add the figaro gem to your application, you may want to consider this implementation.

We'll create a simple file that contains key/value pairs for each environment variable using the standard YAML file format. We'll make sure this file is listed in the *.gitignore* file so it isn't checked into the git repository. And we'll add some code to the *config/application.rb* to read the file and set the environment variables before anything else is configured in the Rails application.

h3. The _local_env.yml_ File

Create a file *config/local_env.yml*:

<pre>
# Rename this file to local_env.yml
# Add account settings and API keys here.
# This file should be listed in .gitignore to keep your settings secret!
# Each entry gets set as a local environment variable.
# This file overrides ENV variables in the Unix shell.
# For example, setting:
# GMAIL_USERNAME: 'Your_Gmail_Username'
# makes 'Your_Gmail_Username' available as ENV["GMAIL_USERNAME"]
GMAIL_USERNAME: 'Your_Gmail_Username'
</pre>

h3. Set .gitignore

If you have created a git repository for your application, your application root directory should contain a file named *.gitignore* (it is a hidden file). Be sure your *.gitignore* file contains:

<pre>
/config/local_env.yml
</pre>

This prevents the *config/local_env.yml* file from being checked into a git repository and made available for others to see.

h3. Rails Application Configuration File

Rails provides the *config/application.rb* file for specifying settings for various Rails components. We want to set our environment variables before any other settings. Rails provides a @config.before_configuration@ method to do so. See the RailsGuide "Configuring Rails Applications":http://guides.rubyonrails.org/configuring.html for more.

Find the following code at the end of the *config/application.rb* file:

<pre>
# Version of your assets, change this if you want to expire all your assets
    config.assets.version = '1.0'
</pre>

and add this code after it:

<pre>
config.before_configuration do
  env_file = File.join(Rails.root, 'config', 'local_env.yml')
  YAML.load(File.open(env_file)).each do |key, value|
    ENV[key.to_s] = value
  end if File.exists?(env_file)
end
</pre>

The code opens the *config/local_env.yml* file, reads each key/value pair, and sets environment variables.

The code only runs if the file exists. If the file exists, the code overrides ENV variables set in the Unix shell. If you prefer to set environment variables in the Unix shell, don't create the *config/local_env.yml* file.

h3. Using Environment Variables

Use @ENV["GMAIL_USERNAME"]@ anywhere in a Rails application. Your application won't know if it was loaded from the *config/local_env.yml* file or from the Unix shell.

h3. Distinguishing Development From Test Environments

Occasionally you'll want to use different account credentials or API keys for test and development environments.

Give the variables different names, for example:

<pre>
GMAIL_USERNAME_DEV: 'Your_Gmail_Username_For_Development'
GMAIL_USERNAME_TEST: 'Your_Gmail_Username_For_Tests'
</pre>

and use the variables conditionally:

<pre>
if Rails.env.development?
  config.action_mailer.smtp_settings = {
    user_name: ENV["GMAIL_USERNAME_DEV"]
  }
end

if Rails.env.test?
  config.action_mailer.smtp_settings = {
    user_name: ENV["GMAIL_USERNAME_TEST"]
  }
end

if Rails.env.production?
  config.action_mailer.smtp_settings = {
    user_name: ENV["GMAIL_USERNAME"]
  }
end
</pre>

This approach works with either the *config/local_env.yml* file or environment variables obtained from the Unix shell.

h2. Setting Environment Variables on Heroku

"Heroku":http://www.heroku.com/ is a popular choice for low cost, easily configured Rails application hosting. See the article "Heroku and Rails":http://railsapps.github.io/rails-heroku-tutorial.html for details.

Heroku provides a simple mechanism for setting environment variables. After creating your Heroku app, set Heroku environment variables to provide the same data your application obtains from your local shell environment.

For example, for Gmail:

<pre>
$ heroku config:add GMAIL_USERNAME=myname@gmail.com
</pre>

If you have "multiple environments":https://devcenter.heroku.com/articles/multiple-environments on Heroku:

<pre>
$ heroku config:add GMAIL_USERNAME=myname@gmail.com --remote staging
</pre>

You can check that everything has been added correctly by running:

<pre>
$ heroku info --app myapp
</pre>

where "myapp" is the name of your Heroku application.

If you are using the figaro gem, just run:

<pre>
rake figaro:heroku
</pre>

Notice that you don't use the *config/application.yml* file. Your *.gitignore* file should prevent it from getting added to the git repository. It won't exist when you deploy to Heroku and your application will obtain environment variables from the Heroku configuration table.

h2. Other Approaches

There are other approaches to setting environment variables in Rails.

Tammer Saleh suggests a similar approach using the Rails *environment.rb* file in his blog posting, "Managing Heroku environment variables for local development":http://tammersaleh.com/posts/managing-heroku-environment-variables-for-local-development.

Brandon Keepers offers the "dotenv":https://github.com/bkeepers/dotenv Ruby gem that handles loading environment variables in development. The dotenv gem loads environment variables from a *.env* file.

"Foreman":https://github.com/ddollar/foreman is a tool for starting and configuring multiple processes in a complex application. Foreman will load environment variables from a *.env* file.

There are numerous gems such as "yettings":https://github.com/charlotte-ruby/yettings that set application configuration variables or other constants from a YAML file and allow access the to values with a method such as @AppConfig.gmail_username@. This approach is best used for constants that can be checked into a git repository and are not specific to a particular deployment. Local environment variables are better suited to deployment-specific configuration settings.

h2(#comment). Did You Like the Article?

Was this useful to you? Follow "rails_apps":http://twitter.com/rails_apps on Twitter and tweet some praise. We'd love to know you were helped out by the tutorial.

Any issues? Please leave a comment below.


      </div>
      <div class="comments" id="comments">
        <div class="content wikistyle gollum">
          <h2>Comments</h2>
        </div>
        <p>Is this helpful? Your encouragement fuels the project. Please tweet or add a comment. Couldn't get something to work? For the example apps and tutorials, it's best to open an issue on GitHub so we can help you.</p>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'railsapps'; // required: replace example with your forum shortname
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div><!-- class="comments" -->
    </div><!-- class="columns" -->
  </div><!-- class="row" -->
  <footer class="row">
    <div class="large-12 columns">
      <div class="row">
         <div class="medium-4 large-4 columns">
           <dl class="footer_nav">
             <dt>RailsApps &#183; Getting Started</dt>
             <dd><a href="http://railsapps.github.io/ruby-and-rails.html">Ruby on Rails</a></dd>
             <dd><a href="http://railsapps.github.io/what-is-ruby-rails.html">What is Ruby on Rails?</a></dd>
             <dd><a href="http://learn-rails.com/learn-ruby-on-rails.html">Learn Ruby on Rails</a></dd>
             <dd><a href="https://tutorials.railsapps.org/rails-tutorial">Rails Tutorial</a></dd>
             <dd><a href="http://learn-rails.com/ruby-on-rails-tutorial-for-beginners">Ruby on Rails Tutorial for Beginners</a></dd>
             <dd><a href="http://railsapps.github.io/installing-rails.html">Install Ruby on Rails</a></dd>
             <dd><a href="http://railsapps.github.io/installrubyonrails-mac.html">Install Ruby on Rails - Mac OS X</a></dd>
             <dd><a href="http://railsapps.github.io/installrubyonrails-ubuntu.html">Install Ruby on Rails - Ubuntu</a></dd>
             <dd><a href="http://railsapps.github.io/rubyonrails-nitrous-io.html">Ruby on Rails - Nitrous.io</a></dd>
             <dd><a href="http://railsapps.github.io/updating-rails.html">Update Rails</a></dd>
             <dd><a href="http://railsapps.github.io/rails-composer/">Rails Composer</a></dd>
             <dd><a href="http://railsapps.github.io/">Rails Examples</a></dd>
             <dd><a href="http://railsapps.github.io/rails-examples-tutorials.html">Rails Starter Apps</a></dd>
           </dl>
         </div>
         <div class="medium-4 large-4 columns">
           <dl class="footer_nav">
             <dt>RailsApps &#183; Articles</dt>
             <dd><a href="http://railsapps.github.io/rails-authorization.html">Rails Authorization</a></dd>
             <dd><a href="http://railsapps.github.io/rails-google-analytics.html">Analytics for Rails</a></dd>
             <dd><a href="http://railsapps.github.io/rails-heroku-tutorial.html">Heroku and Rails</a></dd>
             <dd><a href="http://railsapps.github.io/rails-javascript-include-external.html">JavaScript and Rails</a></dd>
             <dd><a href="http://railsapps.github.io/rails-environment-variables.html">Rails Environment Variables</a></dd>
             <dd><a href="http://railsapps.github.io/rails-git.html">Git and Rails</a></dd>
             <dd><a href="http://railsapps.github.io/rails-github.html">Rails GitHub</a></dd>
             <dd><a href="http://railsapps.github.io/rails-send-email.html">Send Email with Rails</a></dd>
             <dd><a href="http://railsapps.github.io/rails-haml.html">Haml and Rails</a></dd>
             <dd><a href="http://railsapps.github.io/rails-default-application-layout.html">Rails Application Layout</a></dd>
             <dd><a href="http://railsapps.github.io/rails-html5-boilerplate.html">HTML5 Boilerplate for Rails</a></dd>
             <dd><a href="http://railsapps.github.io/rails-3-2-example-gemfile.html">Example Gemfiles for Rails</a></dd>
             <dd><a href="http://railsapps.github.io/rails-application-templates.html">Rails Application Templates</a></dd>
             <dd><a href="http://railsapps.github.io/rails-product-planning.html">Rails Product Planning</a></dd>
             <dd><a href="http://railsapps.github.io/rails-project-management.html">Rails Project Management</a></dd>
           </dl>
           </div>
           <div class="medium-4 large-4 columns">
           <dl class="footer_nav">
             <dt>RailsApps &#183; Tutorials</dt>
             <dd><a href="http://railsapps.github.io/twitter-bootstrap-rails.html">Rails Bootstrap</a></dd>
             <dd><a href="http://railsapps.github.io/rails-foundation.html">Rails Foundation</a></dd>
             <dd><a href="http://railsapps.github.io/rails-omniauth/">OmniAuth Tutorial</a></dd>
             <dd><a href="http://railsapps.github.io/tutorial-rails-devise.html">Rails Devise Tutorial</a></dd>
             <dd><a href="http://railsapps.github.io/tutorial-rails-devise-rspec-cucumber.html">Devise RSpec</a></dd>
             <dd><a href="http://railsapps.github.io/tutorial-rails-bootstrap-devise-cancan.html">Devise Bootstrap</a></dd>
             <dd><a href="http://railsapps.github.io/rails-devise-roles">Role-Based Authorization</a></dd>
             <dd><a href="http://railsapps.github.io/rails-devise-pundit">Rails Authorization with Pundit</a></dd>
             <dd><a href="https://tutorials.railsapps.org/rails-stripe-membership-saas">Rails Membership Site with Stripe</a></dd>
             <dd><a href="https://tutorials.railsapps.org/rails-recurly-subscription-saas">Rails Subscription Site with Recurly</a></dd>
             <dd><a href="https://tutorials.railsapps.org/rails-prelaunch-signup">Startup Prelaunch Signup Application</a></dd>
           </dl>
           <dl class="footer_nav">
            <dt>RailsApps Profile</dt>
            <dd><a href="https://plus.google.com/108039160165742774777?rel=author">Google</a></dd>
            <dd><a href="https://plus.google.com/117374718581973393536" rel="publisher">Find us on Google+</a></dd>
           </dl>
        </div>
      </div>
    </div>
  </footer>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.2.2/js/foundation.min.js"></script>
<script>
  $(document).foundation();
</script>
</body>
</html>
