<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <title>Workshop Notes</title>
    <meta content='Workshop Notes for Ruby on Rails workshop.' name='description'>
    <meta content='Rails Tutorial' name='keywords'>

    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="http://railsapps.github.io/css/tutorials.css" type="text/css" />
    <link rel="stylesheet" href="http://railsapps.github.io/css/github.css" type="text/css" />
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>
    <script src="http://railsapps.github.io/javascript/tutorials.js"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-5109366-14']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body class='tutorials show' data-spy='scroll' data-target='.bs-docs-sidebar'>





<div class="container">
  <div class="row">
    <div class="span3 bs-docs-sidebar">
      <ul class="nav nav-list bs-docs-sidenav">
        <li>
          <div class="tutorial-account">
            <a href="https://tutorials.railsapps.org/plan/portal" class="brand">Tutorials</a><span class="pull-right"><a href="https://tutorials.railsapps.org/logout">Logout</a></span>
          </div>
        </li>
        <li>
          <ul class="tutorial-links">
            <li><span class="uppercase repotitle">learn-rails</span></li>
            <li>By Daniel Kehoe</li>
            <li>Last updated 04 Jun 2013</li>
            <li><a href="https://github.com/RailsApps/learn-rails">GitHub Repository</a></li>
            <li><a href="https://github.com/RailsApps/learn-rails/issues">GitHub Issues</a></li>
            <li><a href="#comments">Comments</a></li>
          </ul>
        </li>
        <li class="level2"><a href="#">CONTENTS</a></li>
        <li class='level2'><a href='#introduction'><i class='icon-chevron-right'></i> Introduction</a></li>
<li class='level2'><a href='#concepts'><i class='icon-chevron-right'></i> Concepts</a></li>
<li class='level2'><a href='#getting-help'><i class='icon-chevron-right'></i> Getting Help</a></li>
<li class='level2'><a href='#product-planning'><i class='icon-chevron-right'></i> Product Planning</a></li>
<li class='level2'><a href='#project-management'><i class='icon-chevron-right'></i> Project Management</a></li>
<li class='level2'><a href='#accounts-you-may-need'><i class='icon-chevron-right'></i> Accounts You May Need</a></li>
<li class='level2'><a href='#getting-started'><i class='icon-chevron-right'></i> Getting Started</a></li>
<li class='level2'><a href='#create-the-application'><i class='icon-chevron-right'></i> Create the Application</a></li>
<li class='level2'><a href='#rails-directory-structure'><i class='icon-chevron-right'></i> Rails Directory Structure</a></li>
<li class='level2'><a href='#source-control-with-git'><i class='icon-chevron-right'></i> Source Control with Git</a></li>
<li class='level2'><a href='#gems'><i class='icon-chevron-right'></i> Gems</a></li>
<li class='level2'><a href='#configuration'><i class='icon-chevron-right'></i> Configuration</a></li>
<li class='level2'><a href='#static-pages-and-routing'><i class='icon-chevron-right'></i> Static Pages and Routing</a></li>
<li class='level2'><a href='#dynamic-home-page'><i class='icon-chevron-right'></i> Dynamic Home Page</a></li>
<li class='level2'><a href='#troubleshooting'><i class='icon-chevron-right'></i> Troubleshooting</a></li>
<li class='level2'><a href='#just-enough-ruby'><i class='icon-chevron-right'></i> Just Enough Ruby</a></li>
<li class='level2'><a href='#layout-and-views'><i class='icon-chevron-right'></i> Layout and Views</a></li>
<li class='level2'><a href='#stylesheets-and-themes'><i class='icon-chevron-right'></i> Stylesheets and Themes</a></li>
<li class='level2'><a href='#adding-pages'><i class='icon-chevron-right'></i> Adding Pages</a></li>
<li class='level2'><a href='#contact-form'><i class='icon-chevron-right'></i> Contact Form</a></li>
<li class='level2'><a href='#sending-mail'><i class='icon-chevron-right'></i> Sending Mail</a></li>
<li class='level2'><a href='#mailing-list'><i class='icon-chevron-right'></i> Mailing List</a></li>
<li class='level2'><a href='#deploy'><i class='icon-chevron-right'></i> Deploy</a></li>
<li class='level2'><a href='#landing-pages'><i class='icon-chevron-right'></i> Landing Pages</a></li>
<li class='level2'><a href='#analytics'><i class='icon-chevron-right'></i> Analytics</a></li>
<li class='level2'><a href='#traffic'><i class='icon-chevron-right'></i> Traffic</a></li>
<li class='level2'><a href='#whats-next'><i class='icon-chevron-right'></i> What’s Next?</a></li>
<li class='level2'><a href='#comments'><i class='icon-chevron-right'></i> Comments</a></li>

      </ul>
    </div>
    <div class="span9">
      <div class="jumbotron subhead">
        <h1>RailsApps Tutorials</h1>
        <p class="lead">Learn Rails</p>
      </div>

  <section class='chapter' id='introduction'><h2>Introduction</h2>
<p>Welcome. This tutorial is a first step on your path to learn Ruby on Rails.</p>
<p>It covers key concepts so you’ll have a solid foundation for continued study.</p>
<p>You’ll build a working web application so you’ll gain hands-on experience with key concepts. Along the way, you’ll learn techniques used by professional Rails developers and you’ll understand why Rails has become a popular choice for web development.</p>
<h3 id="screenshot">Screenshot</h3>
<p><img src="https://tutorials.railsapps.org/assets/learn-rails.png" title="Rails with Twitter Bootstrap" alt="Rails with Twitter Bootstrap" /></p>
<h3 id="is-it-for-you">Is It for You?</h3>
<p>You don’t need to be a programmer to succeed with this tutorial. You’ll become familiar with the Ruby programming language and the Unix command line interface as you build a Rails application.</p>
<p>This tutorial is ideal if you are:</p>
<ul>
  <li>a student</li>
  <li>a startup founder</li>
  <li>making a career change</li>
</ul>
<p>People who are working in social media or graphic design will find the tutorial useful as an introduction to development with Rails. If you’ve built simple websites using <span class="caps">HTML</span> or used applications such as WordPress, you’ll easily progress to working with Rails. If you’ve used <span class="caps">PHP</span> or Java, this tutorial will introduce you to Rails.</p>
<p>For people who have never encountered <span class="caps">HTML</span>, <span class="caps">CSS</span>, or JavaScript, it’s best to start elsewhere with an “Introduction to Web Design” course or online tutorial. There are thousands of such tutorials; I especially like the <a href="http://curriculum.railsbridge.org/frontend/">RailsBridge Frontend Curriculum</a>.</p>
<h3 id="what-to-expect">What To Expect</h3>
<p>This is the foundation for a series of tutorials from the <a href="http://railsapps.github.io/">RailsApps project</a> that accompany our starter apps.</p>
<p>Tutorials from <a href="http://twitter.com/rails_apps">@rails_apps</a> take you on a guided path starting with absolute basics (this tutorial). You’ll progress to intermediate-level tutorials and soon be using our in-depth guides for professional Rails developers.</p>
<p>I believe it is important to feel satisfaction and accomplishment as you learn. That’s why each tutorial introduces Rails in stages. With each tutorial you will build a real-world Rails application. As you deploy and use your own Rails application you will have confirmation of your accomplishment and feel your success. Hands-on learning with real Rails applications is the key to absorbing and retaining knowledge.</p>
<p>The applications you’ll build in the tutorials are not classroom exercises. The primary purpose of the RailsApps project is to provide starter applications for Rails developers. You’ll be building real applications that you can customize and adapt for your startup, at your job, or for clients.</p>
<p>When you’ve completed this tutorial, you will be ready for more advanced self-study, including other tutorials from the RailsApps project, textbook introductions to Rails, or workshops and developer bootcamps that provide intensive training in Ruby on Rails. Other curriculums often skip the basics but this tutorial will give you a good grounding in foundation concepts so you won’t feel overwhelmed or frustrated as you continue yoru studies.</p>
<p>This tutorial is good preparation for:</p>
<ul>
  <li>advanced tutorials in the <a href="https://tutorials.railsapps.org/">RailsApps Tutorials</a> series</li>
  <li>textbooks such as Michael Hartl’s <a href="http://ruby.railstutorial.org/ruby-on-rails-tutorial-book">Ruby on Rails Tutorial</a></li>
  <li>introductory workshops from <a href="http://workshops.railsbridge.org/">RailsBridge</a> or <a href="http://railsgirls.com/">Rails Girls</a></li>
  <li>intensive training such as <a href="http://devbootcamp.com">DevBootcamp</a> or <a href="generalassemb.ly">General Assembly</a></li>
</ul>
<p>I know there are many textbooks, workshops, and classroom programs that teach Ruby on Rails. I believe this tutorial is unique in covering the basics while introducing the tools and techniques of professional Rails development.</p>
<h3 id="the-application">The Application</h3>
<p>We’ll build a basic web application that can be used by a typical small business. The website will include a home page, “about” page, contact form, and option to sign up for a mailing list.</p>
<p>You’ll find the complete <a href="http://github.com/RailsApps/learn-rails/">learn-rails</a> application on GitHub. It is a working application that is maintained by a team of experienced developers so you can always check the “reference implementation” if you have problems.</p>
<h3 id="support-the-project">Support the Project</h3>
<p>The <a href="http://railsapps.github.io/">RailsApps project</a> provides example applications that developers use as starter apps. Hundreds of developers use the apps, report problems as they arise, and propose solutions. Rails changes frequently; each application is known to work and serves as your personal “reference implementation” so you can stay up to date. Each is accompanied by a tutorial so there is no mystery code. Maintenance and development of the RailsApps applications is supported by subscriptions to the <a href="https://tutorials.railsapps.org">RailsApps tutorials</a>.</p>
<p>If you haven’t done so, please consider purchasing a monthly subscription to support the project. You can purchase a subscription at <a href="https://tutorials.railsapps.org">tutorials.railsapps.org</a>.</p>
</section>
<section class='chapter' id='concepts'><h2>Concepts</h2>
<p>This chapter explains key concepts for a beginner. It provides the background you need before you begin coding.</p>
<p>This chapter is excerpted from the article <a href="http://railsapps.github.io/what-is-ruby-rails.html">What is Ruby on Rails?</a>.</p>
<h3 id="how-rails-works">How Rails Works</h3>
<p>The next three paragraphs cover absolute basics; you can jump ahead to “Six Perspectives On a Rails Application” if you’ve built web applications before.</p>
<p>Web browsers are applications (software programs) that work by reading files. A word processing program reads files that are stored on your computer; a web browser reads files that are requested across the Internet from remote computers called servers.</p>
<p>A web browser combines three kinds of files—<span class="caps">HTML</span>, <span class="caps">CSS</span>, and JavaScript—to display web pages. Web browsers obtain <span class="caps">HTML</span>, <span class="caps">CSS</span>, and JavaScript files, either from static files that are delivered by a web server, or from an “application server” that creates files dynamically using a programming language such as <a href="http://en.wikipedia.org/wiki/Ruby_(programming_language)">Ruby</a>. Rails provides an application server that uses Ruby to assemble <span class="caps">HTML</span>, <span class="caps">CSS</span>, and JavaScript files from component files (often adding content from a database). A software program written in Ruby and organized using Rails conventions is a “Rails web application.”</p>
<p>Why use a web application server? A web browser needs only a single <span class="caps">HTML</span> file to display a web page (<span class="caps">CSS</span> and JavaScript files are optional). However, if you are creating several web pages, it often makes sense to assemble the <span class="caps">HTML</span> file from smaller components. For example, you might make a small file that will be included on every page to make a footer (Rails calls these “partials”). Consider another example: If you are displaying content from a database, you might not want the complex programming code that accesses the database mixed into your <span class="caps">HTML</span> (programmers call this <a href="http://en.wikipedia.org/wiki/Separation_of_concerns">separation of concerns</a> and it makes for more modular, maintainable programs). Finally, if you are using a web application server such as the one supplied with Rails, you can add features to your website with code that has been developed and tested by other people so you don’t have to build everything yourself. These are all good reasons to use a web application server.</p>
<h3 id="six-perspectives-on-a-rails-application">Six Perspectives On a Rails Application</h3>
<p>You’ll encounter new terminology as you learn Rails. Cognitive scientists tell us we need more than definitions to learn new terms. We need to make associations, categorizing and grouping new concepts. To help you learn the terminology of Ruby on Rails, the <a href="http://railsapps.github.io/what-is-ruby-rails.html">What is Ruby? And Rails?</a> article describes Rails from six different perspectives. Here’s a summary from the article.</p>
<p>From the <strong>perspective of the web browser</strong>, Rails is simply a program that generates <span class="caps">HTML</span>, <span class="caps">CSS</span>, and JavaScript files. These files are generated dynamically. You can’t see them on the server side but you can view these files by using the web developer tools that are built in to every browser (choose the menu item “Web Developer Tools” in Google Chrome or “Web Developer Toolbar” in Firefox).</p>
<p>From the <strong>perspective of a programmer</strong>, Rails is a set of files organized with a specific structure. The structure is the same for every Rails application; this commonality is what makes it easy to collaborate with other Rails developers. We use text editors to edit these files to make a web application.</p>
<p>From the <strong>perspective of a software architect</strong>, the article <a href="http://railsapps.github.io/what-is-ruby-rails.html">What is Ruby? And Rails?</a> explains that programming languages provide a standard set of abstractions (known as classes and methods) that are organized into a higher level of abstraction (known as an <span class="caps">API</span>, or “application programming interface”). Rails developers organize their code to conform to certain widely known <a href="http://en.wikipedia.org/wiki/Software_pattern">software design patterns</a>. You’ll become familiar with these abstractions as you build a Rails application. Later in the tutorial, we’ll describe the <a href="http://en.wikipedia.org/wiki/Model%E2%80%93View%E2%80%93Controller">model–view–controller</a> design pattern. As a beginner, you will see the <span class="caps">MVC</span> pattern reflected in the file structure of a Rails application. From the perspective of a software architect, it is used as an organizing principle for the <a href="http://api.rubyonrails.org/">Rails <span class="caps">API</span></a>.</p>
<p>The <a href="http://railsapps.github.io/what-is-ruby-rails.html">What is Ruby? And Rails?</a> article introduces the <strong>perspective of a time traveler</strong> in order to introduce the concept of software version control. Specifically, we use the <a href="http://en.wikipedia.org/wiki/Git_(software)">Git</a> revision control system to record a series of snapshots of your project’s filesystem. Git makes it easy to back up and recover files; more importantly, Git lets you make exploratory changes, trying out code you may decide to discard, without disturbing work you’ve done earlier. You can use Git with <a href="https://github.com/">GitHub</a> for remote backup of your projects. Git can keep multiple versions (“branches”) of your local code in sync with a remote GitHub repository, making it possible to collaborate with others on open source or proprietary projects. Strictly speaking, Git and GitHub are not part of Rails (they are tools that can be used on any development project). But Rails and the gems that go into a complex web application would not exist without Git and GitHub. A professional Rails developer uses Git and GitHub constantly on any real-world Rails project.</p>
<p>We can also look at Rails from the <strong>perspective of a gem hunter</strong>. Rails is popular because developers have written and shared many software libraries (RubyGems, or “gems”) that provide useful features for building websites. We can think of a Rails application as a collection of gems that provide basic functionality, plus custom code that adds unique features for a particular website. Some gems are required by every Rails application, for example, a database adaptor that allows Rails to connect to databases. Other gems are used to make development easier, for example, gems for testing that help programmers find bugs. Still other gems add functionality to the website, such as gems for logging in users or processing credit cards. Knowing what gems to use, and why, is an important aspect of learning Rails. This tutorial will show you how to build a web application using some of the most commonly used gems.</p>
<p>Finally, we can consider a Rails application from the <strong>perspective of a tester</strong>. Software testing is part of Rails culture; Rails is the first web development platform to make testing an integrated part of development. Before Rails, automated testing was rarely part of web development. A web application would be tested by users and (maybe) a QA team. If automated tests were used, the tests were often written after the web application was largely complete. Rails introduced the discipline of Test-Driven Development (<span class="caps">TDD</span>) to the wider web development community. With <span class="caps">TDD</span>, tests are written <em>before</em> any implementation coding. It may seem odd to write tests first, but for a skilled <span class="caps">TDD</span> practitioner, it brings coherence to the programming process. First, the developer will give thought to what needs to be accomplished and think through alternatives and edge cases. Second, the developer will have complete test coverage for the project. With good test coverage, it is easier to <em>refactor</em>, rearranging code to be more elegant or efficient. Running a test suite after refactoring provides assurance that nothing inadvertently broke after the changes.</p>
<p><span class="caps">TDD</span> is seen as a necessary skill of an experienced Rails developer. Because this is a tutorial for beginners, it <em>will not</em> introduce you to techniques of Test-Driven Development. However, the example application (on GitHub) contains a test suite and I’ll show you how to download and run the ready-made tests. As you work through more advanced tutorials from the RailsApps project, you’ll be introduced to Test-Driven Development.</p>
<h3 id="stacks">Stacks</h3>
<p>The set of technologies or software libraries that are used to develop an application or deliver web pages is called a technology “stack.” For example, Mark Zuckerberg developed Facebook in 2004 using the <a href="http://en.wikipedia.org/wiki/LAMP_(software_bundle)"><span class="caps">LAMP</span></a> stack:</p>
<ul>
  <li>Linux (operating system)</li>
  <li>Apache (web server)</li>
  <li>MySQL (database)</li>
  <li><span class="caps">PHP</span> (programming language)</li>
</ul>
<p>Rails, as a web development framework, and Ruby, as a programming language, can be used with a choice of operating systems, web servers, and databases. For this tutorial, your technology stack will be:</p>
<ul>
  <li>Mac OS X, Linux, or Windows</li>
  <li>WEBrick (web server)</li>
  <li>SQLite (database)</li>
  <li>Ruby on Rails (language and framework)</li>
</ul>
<p>Rails itself is a stack, if we look at the gems we select for a project. For example, the Rails stack used at <a href="http://37signals.com/">37signals</a>, where the creator of Rails works, includes these components:</p>
<ul>
  <li><span class="caps">ERB</span> for view templates</li>
  <li>MySQL for databases</li>
  <li>MiniTest for testing</li>
</ul>
<p>Any Rails stack includes a variety of gems that add features to a website or make development easier. Sometimes the choice of components is driven by the requirements of an application. At other times, the stack is a matter of personal preference. Just as craftsmen and aficionados debate the merits of favorite tools and techniques in any profession, Rails developers avidly dispute what’s the best Rails stack for development.</p>
<p>The proliferation of choices for the Rails stack makes learning difficult, particularly because the components selected by the creator of Rails are not the same components used by many leading Rails developers. For example, many developers use a Rails stack that includes:</p>
<ul>
  <li>Haml for view templates</li>
  <li>PostgreSQL for databases</li>
  <li>Rspec for testing</li>
</ul>
<p>You can learn much about Rails by following the experts’ debates about the merits of a favorite stack. The debates are a source of much innovation and improvement for the Rails framework. In the end, the power of the crowd prevails; usually the best components in the Rails stack are the most popular.</p>
</section>
<section class='chapter' id='getting-help'><h2>Getting Help</h2>
<p>I’m often asked, “Where’s the Rails manual?” There isn’t one. No single document tells you how to use Rails. Instead, there’s a wealth of documentation that describes various aspects of Rails. You won’t need any other documentation to complete this tutorial but I’d like to suggest some resources that will be helpful as you go deeper in your study of Rails.</p>
<h3 id="references">References</h3>
<p>You might keep some of these references open in a tab in your browser window.</p>
<p>In addition to the resources listed here, the RailsApps project offers a list of <a href="http://railsapps.github.io/ruby-and-rails.html">top resources for Ruby and Rails</a>, including books and blogs.</p>
<h4 id="railsguides">RailsGuides</h4>
<p>The <a href="http://guides.rubyonrails.org/">Rails Guides</a> are Rails’s official documentation, written for intermediate-level developers who already have experience writing web applications. The Rails Guides are an excellent reference if you want to check the correct syntax for Rails code. You’ll be able to use the Rails Guides after completing this tutorial.</p>
<h4 id="cheatsheets">Cheatsheets</h4>
<p>Tobias Pfeiffer has created a useful <a href="http://pragtob.github.io/rails-beginner-cheatsheet/index.html">Rails Beginner Cheat Sheet</a> that provides a good overview of Rails syntax and commands.</p>
<h4 id="api-documentation"><span class="caps">API</span> Documentation</h4>
<p>The <span class="caps">API</span> documentation for Ruby and Rails shows every class and method. These are extremely technical documents (the only thing more technical is reading the source code itself). The documents offer very little help for beginners, as each class and method is considered in isolation, but there are times when checking the <span class="caps">API</span> documentation is the only way to know for certain how something works.</p>
<ul>
  <li><a href="http://api.rubyonrails.org/">Rails Documentation</a> – official <span class="caps">API</span> docs</li>
  <li><a href="http://railsapi.com/">Rails Searchable <span class="caps">API</span> Doc</a> – alternative interface for the <span class="caps">API</span> docs</li>
  <li><a href="http://apidock.com/rails">apidock.com/rails</a> – Rails <span class="caps">API</span> docs with usage note</li>
  <li><a href="http://apidock.com/ruby">apidock.com/ruby</a> – Ruby <span class="caps">API</span> docs with usage notes</li>
</ul>
<h3 id="getting-help-2">Getting Help</h3>
<p>What to do when you get stuck?</p>
<p>“Google it,” of course. Often you need to eliminate outdated advice that is relevant only for older versions of Rails. Google has options under “Search tools” to show only recent results from the past year.</p>
<p>Go directly to <a href="http://stackoverflow.com/questions/tagged/ruby-on-rails-3">Stack Overflow</a> for answers to your questions, or look for Stack Overflow answers in Google search results. Answers from Stack Overflow are helpful if you check carefully to make sure the answers are recent. It is wise to compare several answers to find what’s relevant to your own circumstances.</p>
<p><a href="http://www.railshotline.com/">Rails Hotline</a> is a free telephone hotline for Rails questions staffed by volunteers. You’ll need to carefully think about and describe your problem but sometimes there’s no better help than a live expert.</p>
<h3 id="meetups-hack-nights-and-workshops">Meetups, Hack Nights, and Workshops</h3>
<p>Most large urban areas have meetups or user group meetings for Rails developers. Try <a href="http://www.meetup.com/">Meetup.com</a> or google “ruby rails (my city)”. The community of Rails developers is friendly and eager to help beginners. If you are near a Rails meetup, it is really worthwhile to connect to other developers for help and support.</p>
<p>Local user groups often sponsor hack nights or <a href="http://en.wikipedia.org/wiki/Hackathon">hackathons</a> which can be evening or weekend collaborative coding sessions. You don’t have to be an expert. Beginners are welcome. You can bring your own project which can be as simple as completing a tutorial. You will likely find a study partner at your level or a mentor to help you learn.</p>
<p>If you are a woman learning Rails, look for one of the free workshops from <a href="http://workshops.railsbridge.org/">RailsBridge</a> or <a href="http://railsgirls.com/">Rails Girls</a>. These are not exclusively for women; everyone considered a “minority” in the tech professions is encouraged to participate; and men are included when invited by a woman colleague or friend.</p>
<h3 id="pair-programming">Pair Programming</h3>
<p>Learning to code is challenging, especially if you do it alone. Make it social and you’ll learn faster and have more fun.</p>
<p>There’s a popular trend in the workplace for programmers to work side-by-side on the same code, sharing a keyboard and screen. It’s effective, both to increase productivity and to share knowledge, and many coders love it. When programmers are not in the same office, they share a screen remotely and communicate with video chat.</p>
<p>Look for opportunities to pair program. It’s the best way to learn to code, even if your pairing partner is only another beginner. Learn more about pair programming on the site <a href="http://www.pairprogramwith.me/">pairprogramwith.me</a> and find a pairing partner at <a href="http://rubypair.com/">rubypair.com</a> or <a href="http://www.letspair.net/">letspair.net</a>.</p>
<p>Let’s look at some social aspects of product development before we get into building an application.</p>
</section>
<section class='chapter' id='product-planning'><h2>Product Planning</h2>
<p>Tutorials from other authors focus only on coding. But Rails developers do more than code. Software development is a processs that begins with planning and ends with analysis. Coding, testing, and deployment is at the core but you’ll need to learn about the entire process to succeed professionally. That’s why we look at product planning and project management.</p>
<p>For this beginning tutorial, we’ll introduce concepts about product planning and project management that you will encounter as a Rails developer. If you are interested in diving deeper, see the article <a href="http://railsapps.github.io/rails-project-management.html">Rails and Product Planning</a>.</p>
<h3 id="product-owner">Product Owner</h3>
<p>On your project, who is the <em>product owner</em>?</p>
<p>If you are a solo operator, you are the only one who will decide what features and functionality will be included in your application. But if you’re part of a team, either in a startup, as a consultant, or in a corporate setting, it may not be clear who has responsibility for looking at the application from the point of view of the application user. Someone must decide which features and functionality are essential for the user and which must be left out.</p>
<p>It’s important to assign a product owner. Without a product owner in charge, tasks remain vague and developers have difficulty making progress. A product owner doesn’t have to be a management executive (and usually isn’t). But everyone on the team — including management, developers, and stakeholders — should agree to designate one person as the product owner with responsibility for defining requirements and features.</p>
<h3 id="user-stories">User Stories</h3>
<p>A product owner’s principal tool for product planning is the <em>user story</em>.</p>
<p><a href="http://en.wikipedia.org/wiki/User_story">User stories</a> are a way to discuss and describe the requirements for a software application. The process of writing user stories helps a product owner identify all the features that are needed for an application. Breaking down the application’s functionality into discrete user stories helps organize the work and track progress toward completion.</p>
<p>User stories are often expressed in the following format:</p>
<div class="highlight"><pre><span class="nf">As a </span><span class="nv">&lt;role&gt;</span><span class="nf"></span>
<span class="k">I </span><span class="nf">want </span><span class="nv">&lt;goal&gt;</span><span class="nf"></span>
<span class="nf">so that </span><span class="nv">&lt;benefit&gt;</span><span class="nf"></span>
</pre></div><p>Here is an example:</p>
<div class="highlight"><pre><span class="nf">*Join Mailing List*</span>
<span class="nf">As a visitor to the website</span>
<span class="k">I </span><span class="nf">want to join a mailing list</span>
<span class="nf">so I can receive news and announcements</span>
</pre></div><p>A typical application has dozens of user stories, from basic sign-in requirements to the particular functionality that makes the application unique.</p>
<h3 id="wireframes-and-mockups">Wireframes and Mockups</h3>
<p>Often, before writing user stories, a product owner will make rough sketches of various web pages. Sketching is a phase where you try out ideas to clarify your vision for the application. Sketching can lead to a wireframe or a mockup. These terms are often used interchangeably but there are differences in meaning.</p>
<p>A <em>wireframe</em> is a drawing showing all functional elements of a web page. It should not depict a proposed graphic design for a website, rather it should be a diagram of a web page, without color or graphics.</p>
<p>A <em>mockup</em> adds graphic design to a wireframe; including branding devices, color, and placeholder content. A mockup gives an impression of the web site’s “personality” as well as proposed functionality.</p>
<h3 id="graphic-design">Graphic Design</h3>
<p>Graphic design is a process that often runs in parallel to application development. Very few people have skills as both a visual designer and a programmer. The tools are different; graphic designers typically use Adobe Photoshop, though web-savvy designers now often create designs directly in <span class="caps">HTML</span> and <span class="caps">CSS</span>.</p>
<p>If you’re lucky, you will have help from a skilled graphic designer as you build your web application. If you are very lucky, you may work with someone who is a <em>user experience</em> (UX) designer or <em>interaction designer</em> (IxD).</p>
<p>If you’re working with a graphic designer you might collaborate on a <em>moodboard</em> or a <em>design brief</em> to define the look and feel of your application. If the designer works in Photoshop, you’ll face the challenge of converting design layouts from Photoshop to <span class="caps">HTML</span> and <span class="caps">CSS</span>. There are service firms that do this for a fee but obviously it’s easier to work with a designer who can implement a layout directly in <span class="caps">HTML</span> and <span class="caps">CSS</span>.</p>
<p>Rails can be particularly challenging when it comes to integrating graphic design with code. Rails uses a hybrid of <span class="caps">HTML</span> markup mixed with Ruby programming code in its <em>view</em> files (depending on the stack you’ve selected, the view files can use <em><span class="caps">ERB</span></em>, <em>Haml</em>, or other syntaxes for mixing <span class="caps">HTML</span> and Ruby). Few designers are comfortable with Ruby code mixed with <span class="caps">HTML</span> so you may end up doing integration yourself.</p>
<p>If you don’t have a skilled graphic designer available to help, you can always use <a href="http://twitter.github.io/bootstrap/">Twitter Bootstrap</a> or other front-end frameworks such as <a href="http://foundation.zurb.com/">Zurb Foundation</a> to quickly add an attractive design to your application.</p>
<h3 id="behavior-driven-development">Behavior-Driven Development</h3>
<p>Behavior-Driven Development (<span class="caps">BDD</span>) is a software development methodology that uses user stories as a basis for automated testing. User stories are turned into scenarios that are accompanied by tests. With automated tests, a product owner can determine if developers have succeeded in implementing the required features. This process is called <em>acceptance testing</em>. Automated tests also make it easy for developers to determine if the application still works as they add features, fix bugs, or reorganize code. This process is called <em>integration testing</em>.</p>
<p>The article <a href="http://railsapps.github.io/rails-project-management.html">Rails and Product Planning</a> goes into greater detail about these topics.</p>
</section>
<section class='chapter' id='project-management'><h2>Project Management</h2>
<p>How do you know you’re making progress? Are you taking care of everything that needs to be done? These questions are at the center of project management. Whether you are working alone or as part of a team, you need to define your tasks and track progress toward your goal.</p>
<p>The previous chapter on product planning showed how <em>user stories</em> can be used to break down an application into discrete features. User stories can be the basis for a list of tasks.</p>
<h3 id="to-do-list">To-Do List</h3>
<p>You can track your tasks with a simple to-do list. Some entrepreneurs like the discipline of the <span class="caps">GTD</span> system (<a href="http://en.wikipedia.org/wiki/Getting_Things_Done">Getting Things Done</a>)  for personal productivity and time management. Our article on <a href="http://railsapps.github.io/rails-project-management.html">Rails and Project Management</a> offers a list of popular to-do list applications, either for personal task management or team-oriented task management.</p>
<h3 id="kanban">Kanban</h3>
<p><a href="http://en.wikipedia.org/wiki/Kanban_(development)">Kanban</a> is a method of managing projects that has been adapted from <a href="http://en.wikipedia.org/wiki/Lean_manufacturing">lean manufacturing</a> for use in software development. In Japanese, “Kan” means visual, and “ban” means card or board.</p>
<p>Imagine putting a big whiteboard on your wall and creating columns for a series of to-do lists. The columns, called <a href="http://en.wikipedia.org/wiki/Swim_lane">swimlanes</a>), are labelled: Backlog, Ready, Coding, Testing, Done. Each swimlane contains index cards that describe a user story or other task. To plan your work and track progress, you’ll move the index cards across the board from column to column. To stay focused and avoid overwhelm, you’ll only pick the most important user stories or tasks from the backlog column and you’ll limit the number of items in each column to what can be realistically accomplished in the time available. That’s the essence of kanban as it used for software development.</p>
<p>See the article on <a href="http://railsapps.github.io/rails-project-management.html">Rails and Project Management</a> for a list of kanban web applications. <a href="https://trello.com/">Trello</a> is particularly popular for task management.</p>
<h3 id="agile-methodologies">Agile Methodologies</h3>
<p>For a solo project or a small team, you’ll do fine with a simple to-do list or (even better) a kanban web application for managing your software development process.</p>
<p>If you’ve got enough people to need to hire a project manager, you should look at project management software that supports teams using <a href="http://en.wikipedia.org/wiki/Agile_software_development">Agile software development</a> methodologies. <a href="http://www.pivotaltracker.com/">Pivotal Tracker</a> is the best known tool but there are many other <a href="http://agilescout.com/best-agile-scrum-tools/">agile tools</a>.</p>
<p>If you are working on your own, it’s interesting to learn about Agile techniques but you’ll find they are most useful for teams. Learn more about Agile if you’re going hire developers for a startup or if you are going to work for an established company. In most successful companies, Agile processes have replaced the much-maligned <a href="http://en.wikipedia.org/wiki/Waterfall_model">waterfall process</a> that was once the norm for software development.</p>
<p>Our article on <a href="http://railsapps.github.io/rails-project-management.html">Rails and Project Management</a> goes into more detail.</p>
</section>
<section class='chapter' id='accounts-you-may-need'><h2>Accounts You May Need</h2>
<p>This tutorial will show you how to save your work using <a href="https://github.com/">GitHub</a>. You can sign up for a GitHub account for free.</p>
<p>We’ll also send email from the application, which will require a <a href="https://accounts.google.com/SignUp?service=mail">Gmail</a> account. A Gmail account is free.</p>
<p>Finally, we’ll create a form that allows website visitors to “opt-in” to a mailing list. You’ll need a <a href="http://mailchimp.com/">MailChimp</a> account, which is free.</p>
<h3 id="github">GitHub</h3>
<p>Rails developers use <a href="https://github.com/">GitHub</a> for collaboration and remote backup of projects.</p>
<p>For this tutorial, I suggest you get a <a href="https://github.com/signup/free">free personal GitHub account</a> if you don’t already have one. As a developer, your GitHub account establishes your reputation in the open source community. If you’re seeking a job as a developer, employers will look at your GitHub account. When you work with other developers, they may check to see what you’ve worked on recently. Don’t be reluctant to set up a GitHub account, even if you’re a beginner. It shows you are serious about learning Rails.</p>
<p>You’ll be asked to provide a username. This can be a nickname or short version of your real name (for example, your Twitter username).</p>
<p>You’ll be asked to provide an email address. It’s very important that you use the same email address for your GitHub account that you use to configure Git locally (there will be more about configuring Git later). If you create a Heroku account to deploy and host your Rails applications, you should use the same email address.</p>
<p>After you create your GitHub account, log in and look for the button “Edit Your Profile.” Take a few minutes to add some public information to your account. It is really important to provide your real name and a public email address. Displaying your real name on your GitHub account makes it easy for people to associate you with your work when they meet you in real life, for example at a meetup, a hackathon, or a conference. Providing a public email address makes it possible for other developers to reach you if you ask questions or submit issues. If you can, provide a website address (even just your Twitter or Facebook page). In general, you won’t be exposed to stalkers or spammers (except some recruiters) if you are open about yourself on GitHub.</p>
<p>Later I’ll show you how to set up and use Git and GitHub.</p>
<h3 id="gmail">Gmail</h3>
<p>The tutorial shows how the application can connect to a Gamil account to send email. We use Gmail as our example because many people already have a Gmail account. You can get a free <a href="https://accounts.google.com/SignUp?service=mail">Gmail</a> account if you don’t already have one.</p>
<p>Other services, such as <a href="http://mandrill.com/">Mandrill</a>, can be used to send email from the application. Or you can connect directly to an <span class="caps">SMTP</span> mail server to send email. The tutorial won’t show the details but I’ll provide links for more information if you don’t want to use Gmail.</p>
<h3 id="mailchimp">MailChimp</h3>
<p>This tutorial shows how website visitors who want to receive a newsletter can be assigned to a <a href="http://mailchimp.com/">MailChimp</a> mailing list. MailChimp allows you to send up to 12,000 emails/month to list of 2000 or fewer subscribers for free. There is no cost to set up an account. After you sign up for a MailChimp account, get your <span class="caps">API</span> key. Look under “Account” for “<span class="caps">API</span> Keys and Authorized Apps.” Make a note of the <span class="caps">API</span> key for later.</p>
<p>After you have set up a MailChimp account, create a new mailing list where you can collect email addresses of visitors who have asked to subscribe to a newsletter. The MailChimp “Lists” page has a button for “Create List.” The list name and other details are up to you. You’ll need to obtain the list ID for use later in the tutorial when we add code to subscribe visitors to the MailChimp list. To find the list ID, on the MailChimp “Lists” page, look for the dropdown “gear” menu and click “List Settings and Unique ID.” At the bottom of the List Settings page, you’ll find the unique ID for the mailing list. Make a note of the list ID for later.</p>
</section>
<section class='chapter' id='getting-started'><h2>Getting Started</h2>
<h3 id="before-you-start">Before You Start</h3>
<p>If you follow this tutorial closely, you’ll have a working application that closely matches the example app in the <a href="http://github.com/RailsApps/learn-rails/">learn-rails</a> GitHub repository. If your application doesn’t work after following the tutorial, compare the code to the example app in the GitHub repository, which is known to work.</p>
<p>If you find problems or wish to suggest improvements, please create a <a href="http://github.com/RailsApps/learn-rails/issues">GitHub issue</a>. It’s best to download and check the example application from the GitHub repository before you report an issue, just to make sure the error isn’t a result of your own mistake.</p>
<p>The online edition of this tutorial contains a <a href="#comments">comments section</a> at the end of the tutorial. I encourage you to offer feedback to improve this tutorial.</p>
<h3 id="your-computer">Your Computer</h3>
<h4 id="mac-os-x-linux-or-windows">Mac OS X, Linux, or Windows</h4>
<p>You can develop web applications with Rails on computers running Mac OS X, Linux, or Microsoft Windows operating systems. Most Rails developers use Mac OS X or Linux because the underlying Unix operating system has long been the basis for open source programming.</p>
<p>Developing with Rails on Windows can be painful at times. You can get started learning Rails with a Windows laptop. You’ll be able to complete this tutorial but later you may wish to look at other choices for your development platform, included hosted computing such as <a href="https://www.nitrous.io/">Nitrous.io</a>.</p>
<h4 id="hosted-computing">Hosted Computing</h4>
<p>You don’t need your own computer to develop web applications with Rails if you use a browser-based development environment. <a href="https://www.nitrous.io/">Nitrous.io</a> provides a hosted development environment including a Unix shell with Ruby pre-installed, plus a browser-based file manager and text editor. Any device that runs a web browser will give you access to Nitrous.io, including a tablet or smartphone, though you need a broadband connection, a sizeable screen, and a keyboard to be productive. If you are using Windows, or have difficulty installing Ruby on your computer, try using Nitrous.io.</p>
<h3 id="text-editor">Text Editor</h3>
<p>You’ll need a <a href="http://en.wikipedia.org/wiki/Text_editor">text editor</a> for writing code and editing files. I recommend <a href="http://www.sublimetext.com/">Sublime Text 2</a> for Mac OS X, Windows, or Linux.</p>
<p>Word processing programs, such as Microsoft Word, TextEdit or Notepad, will not work because they introduce hidden formatting codes into text files.</p>
<p>If you don’t have a text editor, install Sublime Text now. You can find tutorials for Sublime Text on YouTube, including a popular <a href="http://www.youtube.com/watch?v=TZ-bgcJ6fQo">Sublime Text 2</a> video from NetTutsPlus.</p>
<h3 id="terminal">Terminal</h3>
<p>You’ll need an application called a console or terminal emulator to run programs from your computer’s command line. We call the command line the <em>shell</em> because it is the outer layer of the operating system’s internal mechanisms (which we call the <em>kernel</em>).</p>
<p>On Mac OS X, you can use the <a href="http://en.wikipedia.org/wiki/Terminal.app">Terminal application</a>. Experienced developers often upgrade to the more powerful <a href="http://www.iterm2.com/#/section/home">iTerm2</a> application. On Windows, use the <a href="http://en.wikipedia.org/wiki/Windows_PowerShell">PowerShell</a> application.</p>
<p><a href="http://cli.learncodethehardway.org/book/">The Command Line Crash Course</a> explains <a href="http://cli.learncodethehardway.org/book/ex1.html">how to launch a terminal application</a>.</p>
<p>If you haven’t used the computer’s command line interface (<span class="caps">CLI</span>) before, spend some time with <a href="http://cli.learncodethehardway.org/book/">The Command Line Crash Course</a> to become comfortable with Unix (or Windows) shell commands.</p>
<p>Launch your terminal application now.</p>
<p>Try out the terminal application by entering a shell command.</p>
<div class="highlight"><pre><span class="gp">$</span> whoami
</pre></div><p>The Unix shell command <code>whoami</code> returns your username.</p>
<p>The <code>$</code> character is a cue that you should enter a shell command. This is a longtime convention that indicates you should enter a command in the terminal application or console.</p>
<p>Don’t type the <code>$</code> prompt.</p>
<p>You might see:</p>
<div class="highlight"><pre><span class="go">command not found: $</span>
</pre></div><p>which indicates you typed the <code>$</code> character by mistake.</p>
<p>If you are new to programming, using a text editor and the shell will seem primitive compared to the complexity and sophistication of Microsoft Word or Photoshop. Software developers edit files with simple text editors and run programs in the shell. That’s all we do. We have to remember the commands we need (or consult a cheatsheet) because there are no graphical menus or toolbars. Yet with nothing more than a text editor and the command line interface, programmers have created everything that you use on your computer.</p>
<h4 id="getting-fancy">Getting Fancy</h4>
<p>If you watch experienced developers at work, you may see their consoles are colorful, with lots of information shown in the prompt. You’ll see Git status, current directory, and <span class="caps">RVM</span> gemset or Ruby version. Many developers replace the standard <a href="http://en.wikipedia.org/wiki/Bash_(Unix_shell)">Bash shell</a> with the <a href="http://en.wikipedia.org/wiki/Z_shell">Z shell</a> and <a href="https://github.com/robbyrussell/oh-my-zsh">Oh-my-zsh</a>. You don’t have to install the Z shell to get a fancy prompt; the <a href="https://github.com/revans/bash-it">Bash-it</a> utility is easy to install and gives you much of the functionality. A fancy prompt is helpful but requires some Unix skills to install. Don’t worry about getting fancy now; you can try it down the road.</p>
<h3 id="installing-ruby">Installing Ruby</h3>
<p>Your first challenge in learning Rails is installing Ruby on your computer.</p>
<p>Frankly, this can be the most difficult step in learning Rails because no tutorial can sort out the specific configuration of your computer. Get over this hump and everything else becomes easy.</p>
<p>You have three options to get Ruby on your computer.</p>
<p><em>1)</em> You can use <span class="caps">RVM</span>, the <a href="https://rvm.io/">Ruby Version Manager</a>, to install Ruby. I recommend this approach for almost everyone who is running Mac OS X or Ubuntu Linux. This approach installs the newest versions of the software packages you need. For complete instructions, see the article <a href="http://railsapps.github.io/installing-rails.html">Installing Rails</a> from the RailsApps project. Keep in mind that the article is written for experienced developers. Beginners can follow it step-by-step. If you find it is overwhelming, try the next alternative.</p>
<p><em>2)</em> You can use a pre-assembled installation package. <a href="http://railsinstaller.org/">RailsInstaller</a> is the best known. This approach is (almost) a one-click install and dead simple. However, this approach will not install the newest versions. And it installs Ruby and gems in a multi-user configuration that can cause conflicts if you install <span class="caps">RVM</span> again. For instructions, see the <a href="http://installfest.railsbridge.org/installfest/">RailsBridge Installfest</a> document. I recommend this approach if professional development is not your career path.</p>
<p><em>3)</em> Your third choice is to use <a href="https://www.nitrous.io/">Nitrous.io</a>, the browser-based development environment. If you have a fast broadband connection to the Internet, this is your best choice for developing Rails on Windows. And it is a good option if you have any trouble installing Ruby on Mac or Linux because the Nitrous.io hosted environment provides everything you need, including a Unix shell with Ruby and <span class="caps">RVM</span> pre-installed, plus a browser-based file manager and text editor. Using a hosted development environment is unconventional but leading developers do so and it may be the wave of the future.</p>
<h3 id="ruby-2-0-and-rails-4-0">Ruby 2.0 and Rails 4.0</h3>
<p>The instructions in the article <a href="http://railsapps.github.io/installing-rails.html">Installing Rails</a> will help you install Ruby 2.0 and Rails 4.0, the newest versions of Ruby and Rails. The article will also guide you to update various supporting gems and utilities as needed. If you’ve used <a href="http://railsinstaller.org/">RailsInstaller</a>, you can use the article <a href="http://railsapps.github.io/installing-rails.html">Installing Rails</a> to update Ruby and Rails as needed.</p>
<p>Check that appropriate versions of Ruby and Rails are installed in your development environment. You’ll need:</p>
<ul>
  <li>The Ruby language (version 2.0.0 or newer)</li>
  <li>The Rails gem (version 4.0 or newer)</li>
</ul>
<p>Rails (and to some extent, Ruby) follows a convention named “semantic versioning.” The first number denotes a major version (Rails 4). The second number denotes a minor release (Rails 4.0). A third number (Rails 4.0.1) denotes a “patch level” release which fixes bugs but doesn’t introduce significant features.</p>
<p>Open your terminal application and enter:</p>
<div class="highlight"><pre><span class="gp">$</span> ruby -v
</pre></div><p>You might see:</p>
<div class="highlight"><pre><span class="go">ruby 2.0.0p0 (...)</span>
</pre></div><p>You’ve got Ruby version 2.0.0, patch level “p0” (Ruby versions add an extra patch level to semantic versioning). Newer minor releases or patch levels are good, as this tutorial will remain compatible.</p>
<p>Try:</p>
<div class="highlight"><pre><span class="gp">$</span> rails -v
</pre></div><p>You might see:</p>
<div class="highlight"><pre><span class="go">Rails 4.0.0</span>
</pre></div><p>Versions such as <code>4.0.0.beta1</code> or <code>4.0.0.rc1</code> are beta versions or “release candidates.”</p>
<p>If you find you’ve installed Rails 4.0.1 or newer (a patch release), that’s good. It means minor bugs have been fixed since this was written. If you find you have Rails 4.1.0 or newer (a minor release), check for a newer version of this tutorial. Minor features may have changed.</p>
<p>You can check for the <a href="http://rubygems.org/gems/rails">current version of Rails</a> here.</p>
<p>If you are running older versions or Ruby or Rails on your computer, you must install newer versions to avoid unexpected problems.</p>
<h3 id="rvm"><span class="caps">RVM</span></h3>
<p>If you’ve followed the instructions in the article <a href="http://railsapps.github.io/installing-rails.html">Installing Rails</a> and installed <span class="caps">RVM</span>, you’ll have multiple versions of Ruby, and multiple versions of Rails. That’s as it should be. Most professional Rails developers have more than one version or Ruby or Rails, and <span class="caps">RVM</span> makes it easy to switch. Rails changes frequently and it is not unusual to have older Rails applications that have not been updated.</p>
<p>You can see a list of available Ruby versions:</p>
<div class="highlight"><pre><span class="gp">$</span> rvm list
</pre></div><p><span class="caps">RVM</span> lets you create collections of gems, called <em>gemsets</em>. It’s common to create a new gemset for each project, since each Rails application often requires a particular set of gems.</p>
<p>You can see a list of available gemsets associated with the default Ruby version:</p>
<div class="highlight"><pre><span class="gp">$</span> rvm gemset list
</pre></div><p>You will see a <code>global</code> gemset as well as any others you have created, such as a gemset for <code>Rails4.0.0</code>. After you’ve worked on a few Rails applications, you’ll see more project-specific gemsets if you are using <span class="caps">RVM</span> in the way most developers do.</p>
<p><span class="caps">RVM</span> is not the only utility you can use to manage multiple Ruby versions. Some developers like <a href="https://github.com/postmodern/chruby">Chruby</a>, <a href="https://github.com/sstephenson/rbenv">rbenv</a>, or <a href="https://github.com/wayneeseguin/rvm/blob/master/help/alt.md">others</a>. Don’t be worried if you hear debates about <span class="caps">RVM</span> versus Chruby or rbenv; developers love to compare the merits of their tools. <span class="caps">RVM</span> is popular, well-supported, and an excellent utility to help a developer install Ruby and manage gemsets; that’s why we use it.</p>
<h3 id="project-specific-gemset">Project-Specific Gemset</h3>
<p>For our learn-rails application, we’ll create a project-specific gemset using <span class="caps">RVM</span>. We’ll give the gemset the same name as our application.</p>
<p>After we create a the project-specific gemset, we’ll install the Rails gem into the gemset. Enter these commands:</p>
<div class="highlight"><pre><span class="gp">$</span> rvm use ruby-2.0.0@learn-rails --create
<span class="gp">$</span> gem install rails --version<span class="o">=</span>4.0.0.rc1
</pre></div><p>We’ll specify Rails version 4.0.0.rc1 since it is the newest at the time of this writing.</p>
<p>Let’s make sure Rails is ready to run. Open a terminal and type:</p>
<div class="highlight"><pre><span class="gp">$</span> rails -v
</pre></div><p>You should see the message “Rails 4.0.0.rc1” (or something similar).</p>
</section>
<section class='chapter' id='create-the-application'><h2>Create the Application</h2>
<p>In previous chapters you’ve gained a conceptual background. In this chapter you’ll begin building a Rails application.</p>
<h3 id="how">How?</h3>
<p>The most obvious way to get the code into your text editor is to copy and paste from this tutorial, assuming you are reading this on your computer (not a tablet or printed pages). It’s a bit tedious and error-prone but you’ll have a good opportunity to examine the code closely.</p>
<p>Some students like to type in the code, character by character. If you have patience, it’s a worthwhile approach because you’ll become more familiar with the code than by copying and pasting. Either way, don’t feel shy about copying the code; it’s how you will learn.</p>
<h3 id="starter-applications">Starter Applications</h3>
<p>Rails provides a <em>framework</em>; that is, a software library that provides utilities, conventions, and organizing principles to allow us to build complex web applications. Without a framework, we’d have to code everything from scratch. Rails gives us the basics we need for many websites.</p>
<p>Still, the framework doesn’t give us all the features we need for many common types of websites. For example, we might want users to register for an account and log in to access the website (“user management and authentication”). We might want to restrict portions of our website to just administrators (“authorization”). We also might want to add gems that enhance Rails to aid development (gems for testing, for example) or improve the look and feel of our application (Twitter Bootstrap). Developers often mix and match components to make a customized Rails stack.</p>
<p>Developers often use a <em>starter application</em> instead of assembling an application from scratch. You might call this a “template” but we use that term to refer to the <em>view files</em> that combine <span class="caps">HTML</span> with Ruby code to generate web pages. Most experienced developers have one or more starter applications that save time when beginning  a new project. The <a href="http://railsapps.github.io/">RailsApps project</a> was launched to provide open source starter applications so developers could collaborate on their starter applications and avoid duplicated effort. After you gain some skill with this tutorial, you might use the RailsApps starter apps to instantly generate a Rails application with feaures like authentication, authorization, and Twitter Bootstrap.</p>
<p>For now, we’ll begin with the Rails default starter application.</p>
<h3 id="rails-new-command">“Rails New” Command</h3>
<p>Rails provides the <code>rails new</code> command to create a basic Rails application.</p>
<p>We already created a project-specific gemset using <span class="caps">RVM</span>. Make sure it’s ready to use:</p>
<div class="highlight"><pre><span class="gp">$</span> rvm use ruby-2.0.0@learn-rails
</pre></div><p>First, let’s see our options. Type:</p>
<div class="highlight"><pre><span class="gp">$</span> rails new --help
</pre></div><p>You’ll see a help message that shows all the options for the “rails new” command.</p>
<p>It’s important to know that help messages are available for Rails commands.</p>
<p>You’ll see a summary of the command syntax:</p>
<div class="highlight"><pre><span class="go">Usage:</span>
<span class="go">  rails new APP_PATH [options]</span>
</pre></div><p>You’ll see a list of command options and an explanation of what the “rails new” command will do:</p>
<div class="highlight"><pre><span class="go">The 'rails new' command creates a new Rails application with a default</span>
<span class="go">directory structure and configuration at the path you specify.</span>
</pre></div><p>In the example, <em>APP_PATH</em>, or “the path you specify,” is the name of your project and will appear in your code as the name of the application. The “rails new” command creates a directory (project folder) and generates subfolders and files within it.</p>
<p>Of all the options, the only one we’ll use right now is the <code>-T</code> option which tells the “rails new” command not to generate a set of files for the <code>Test::Unit</code> testing framework. This is an example of customizing our Rails stack. In its default configuration, Rails uses the <code>Test::Unit</code> testing framework. Like many Rails developers, the RailsApps project uses the RSpec framework instead. I won’t be showing you how to write tests in this introductory tutorial but I will show you how to download and run pre-written tests from our GitHub repository. The <code>-T</code> option will prepare us for that.</p>
<h3 id="where-are-you">Where Are You?</h3>
<p>Take a moment to think about where on your computer you’ll do your work and store your files. You may have a <strong>documents</strong> folder. You could make a similar folder named <strong>projects</strong> or <strong>code</strong> or <strong>webapps</strong> for your programming projects.</p>
<p>Open a terminal and navigate to a folder where you want to work on your projects. Use the Unix <code>cd</code> command to change directories. Use the <code>pwd</code> command to see where you are. You can use the <code>ls</code> command to show the folders and files in a directory.</p>
<p>Let’s get started building the application.</p>
<h3 id="building-the-application">Building the Application</h3>
<p>To create the Rails default starter application, type:</p>
<div class="highlight"><pre><span class="gp">$</span> rails new learn-rails -T
</pre></div><p>This will create a new Rails application named “learn-rails.”</p>
<p>You may give the app a different name if you are building it for another purpose. For this tutorial, we’ll assume the name is “learn-rails.” It will save you trouble to use this name.</p>
<p>Use the <code>-T</code> flag to skip Test::Unit files. Later in the tutorial, we’ll download and run test files that use the RSpec testing framework so we don’t want Test::Unit files in our way.</p>
<p>The <code>rails new</code> command will create nine folders and 53 files.</p>
<p>It will install 44 gems into your gemset.</p>
<p>After you create the application, switch to its folder to continue work directly in the application:</p>
<div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd </span>learn-rails
</pre></div><p>This is your project directory. It is also called the application root directory.</p>
<p>Type the <code>ls</code> command to show the folders and files in a directory. Soon we’ll learn more about each of these folders and files.</p>
<h3 id="setting-rvm">Setting <span class="caps">RVM</span></h3>
<p><span class="caps">RVM</span> gives us a convenient technique to make sure we are always using the correct gemset when we enter the project directory. It will create hidden files to designate the correct Ruby version and project-specific gemset. Enter this command to create the hidden files:</p>
<div class="highlight"><pre><span class="gp">$</span> rvm use ruby-2.0.0@learn-rails --ruby-version
</pre></div><p>The command creates two files, <strong>.ruby-version</strong> and <strong>.ruby-gemset</strong>, that set <span class="caps">RVM</span> every time we <code>cd</code> to the project directory. Without these two hidden files, you’d need to remember to enter <code>rvm use ruby-2.0.0</code>learn-rails@ every time you start work on your project after closing the console.</p>
<p>You can confirm you’ve created the two hidden files:</p>
<div class="highlight"><pre><span class="gp">$</span> ls -1pa
<span class="go">./</span>
<span class="go">../</span>
<span class="go">.gitignore</span>
<span class="go">.ruby-gemset</span>
<span class="go">.ruby-version</span>
<span class="go">Gemfile</span>
<span class="go">Gemfile.lock</span>
<span class="go">README.rdoc</span>
<span class="go">Rakefile</span>
<span class="go">app/</span>
<span class="go">bin/</span>
<span class="go">config/</span>
<span class="go">config.ru</span>
<span class="go">db/</span>
<span class="go">lib/</span>
<span class="go">log/</span>
<span class="go">public/</span>
<span class="go">tmp/</span>
<span class="go">vendor/</span>
</pre></div><p>The “a” flag in the the Unix <code>ls -1pa</code> command displays hidden files. Each hidden file is listed with a dot (period or full stop) at the beginning of the filename. You’ll notice <code>.ruby-gemset</code> and <code>.ruby-version</code>.</p>
<p>You’ll also see two “special files” which are not files at all:</p>
<ul>
  <li><code>./</code> – an alias that represents the current directory</li>
  <li><code>../</code> – an alias that represents the parent directory</li>
</ul>
<p>That’s a brief diversion into Unix; let’s try running our new Rails application.</p>
<h3 id="test-the-application">Test the Application</h3>
<p>You’ve created a simple default web application. It’s ready to run.</p>
<h4 id="launching-the-web-server">Launching the Web Server</h4>
<p>You can launch the application by entering the command:</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>You’ll see:</p>
<div class="highlight"><pre><span class="go">=&gt; Booting WEBrick</span>
<span class="go">=&gt; Rails 4.0.0.rc1 application starting in development on http://0.0.0.0:3000</span>
<span class="go">=&gt; Run `rails server -h` for more startup options</span>
<span class="go">=&gt; Ctrl-C to shutdown server</span>
<span class="go">[...] INFO  WEBrick 1.3.1</span>
<span class="go">[...] INFO  ruby 2.0.0 (2013-02-24) [x86_64-darwin12.2.0]</span>
<span class="go">[...] INFO  WEBrick::HTTPServer#start: pid=38534 port=3000</span>
</pre></div><p>The <code>rails server</code> command launches the default <a href="http://en.wikipedia.org/wiki/WEBrick">WEBrick web server</a> that is provided with Ruby.</p>
<h4 id="viewing-in-the-web-browser">Viewing in the Web Browser</h4>
<p>To see your application in action, open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>. You’ll see the Rails default information page.</p>
<h4 id="watching-log-messages">Watching Log Messages</h4>
<p>Notice that messages scroll in the console window when your browser requests the Rails default web page.</p>
<p>Open the file <strong>log/development.log</strong> and you’ll see the same messages. When a browser sends requests to the WEBrick web server, diagnostic messages are written to the console and to the <strong>log/development.log</strong> file. These diagnostic messages are an important tool for troubleshooting when you are developing.</p>
<p>You can keep more than one terminal window open. Your tab key will open additional terminal windows. For convenience, you may want to keep a terminal window open for running the web server and watching diagnostic messages.</p>
<h4 id="stopping-the-web-server">Stopping the Web Server</h4>
<p>You can stop the server with Control-c to return to the command prompt.</p>
<p>Most of the time you’ll keep the web server running as you add or edit files in your project. Changes will automatically appear when you refresh the browser or request a new page. There is a tricky exception, however. If you make changes to the Gemfile, or changes to configuration files, the web server must be shut down and relaunched for changes to be activated.</p>
<h3 id="getting-organized-for-efficiency">Getting Organized for Efficiency</h3>
<p>Before we learn about the Rails directory structure, take a minute to organize your screen real estate. During development, you’ll jump between the console in a terminal application, your text editor, and a web browser window. As a Rails developer, you’ll do this constantly, so think about how you can do this efficiently. Multiple screens make it easy, but even on a laptop you can get organized for efficiency.</p>
<p>Here’s some ideas. Open a window in the terminal application, place it on the left side of your screen, and stretch it to the maximum vertical height of your screen. You can open multiple windows in the terminal application with the tab key. Keep one terminal window open for entering shell commands (like <code>cd</code> or <code>ls</code>) and another terminal window open for running the <code>rails server</code> command and viewing the log output.</p>
<p>Place your text editor window next to the terminal window and stretch it to full vertical height. If you are using Sublime Text, you can open two editor panels side-by-side. Some developers find it helpful to leave the file browser panel open to navigate the project directory; others hide the file browser panel to save space.</p>
<p>If you have enough screen space, leave your web browser open and place it next to your text editor. If your screen space is limited, you may have to overlap the web browser with the text editor, but position your web browser window so you can bring it to the front with a single click. You’ll need multiple tabs open in your web browser. Unless you like constant distraction, close Gmail, Facebook, Twitter, and Hacker News. Open tabs for <a href="http://localhost:3000/">http://localhost:3000/</a>, this tutorial, and additional references or documentation.</p>
<p>This is just a guide; I’m sure you can improve upon these suggestions.</p>
</section>
<section class='chapter' id='rails-directory-structure'><h2>Rails Directory Structure</h2>
<p>We’ve created the default Rails starter application.</p>
<p>Let’s see what the <code>rails new</code> command created for us.</p>
<p>Use the Unix <code>ls</code> command to list the contents of the project directory. For a one-column list that shows each subdirectory (marked with a slash), we’ll add the <code>-1p</code> option to the command.</p>
<div class="highlight"><pre><span class="gp">$</span> ls -1p
</pre></div><p>You’ll see:</p>
<div class="highlight"><pre><span class="go">Gemfile</span>
<span class="go">Gemfile.lock</span>
<span class="go">README.rdoc</span>
<span class="go">Rakefile</span>
<span class="go">app/</span>
<span class="go">bin/</span>
<span class="go">config/</span>
<span class="go">config.ru</span>
<span class="go">db/</span>
<span class="go">lib/</span>
<span class="go">log/</span>
<span class="go">public/</span>
<span class="go">tmp/</span>
<span class="go">vendor/</span>
</pre></div><p>Now is a good time to open a file browser window and look at the contents of the project directory. On the Mac, there’s a command you can use to open the graphical file browser from the console. If you’re in the project directory, type <code>open .</code>. The period (or “dot”) is a Unix symbol that means “the directory I’m in.”</p>
<div class="highlight"><pre><span class="gp">$</span> open .
</pre></div><p>You’ll learn more about each file and folder as you proceed through the tutorial. To get you started, here are two tables. The first describes the files and folders that are important for every beginner. The second table describes the files and folders that you can ignore.</p>
<h3 id="important-folders-and-files">Important Folders and Files</h3>
<p>These folders and files are important to beginners.</p>
<table>
  <tr>
    <td> Gemfile </td>
    <td> Lists all the gems used by the application. </td>
  </tr>
  <tr>
    <td> Gemfile.lock </td>
    <td> Lists gem versions and dependencies. </td>
  </tr>
  <tr>
    <td> <span class="caps">README</span>.rdoc </td>
    <td> A page for documentation. </td>
  </tr>
  <tr>
    <td> app/ </td>
    <td> Application folders and files. </td>
  </tr>
  <tr>
    <td> config/ </td>
    <td> Configuration folders and files. </td>
  </tr>
  <tr>
    <td> db/ </td>
    <td> Database folders and files. </td>
  </tr>
  <tr>
    <td> public/ </td>
    <td> Files for web pages that do not contain Ruby code, such as error pages. </td>
  </tr>
</table>
<h3 id="not-so-important-folders-and-files">Not-So-Important Folders and Files</h3>
<p>These folders and files are important to Rails but not important to beginners.</p>
<table>
  <tr>
    <td> Rakefile </td>
    <td> Directives for the Rake utility program. </td>
  </tr>
  <tr>
    <td> bin/ </td>
    <td> Folder for binary (executable) programs. </td>
  </tr>
  <tr>
    <td> config.ru </td>
    <td> Configuration file for Rack (a software library for web servers). </td>
  </tr>
  <tr>
    <td> lib/ </td>
    <td> Folder for miscellaneous Ruby code. </td>
  </tr>
  <tr>
    <td> log/ </td>
    <td> Folder for application server logfiles. </td>
  </tr>
  <tr>
    <td> tmp/ </td>
    <td> Temporary files created when your application is running. </td>
  </tr>
  <tr>
    <td> vendor/ </td>
    <td> Folder for Ruby software libraries that are not gems. </td>
  </tr>
</table>
<h3 id="the-app-directory">The App Directory</h3>
<p>Take time to drill down into the <strong>app/</strong> folder in the project directory. This is easiest using the file browser. You can also use your text editor. Or you can do it with Unix commands:</p>
<div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd </span>app
<span class="gp">$</span> ls -1p
<span class="go">assets/</span>
<span class="go">controllers/</span>
<span class="go">helpers/</span>
<span class="go">mailers/</span>
<span class="go">models/</span>
<span class="go">views/</span>
<span class="gp">$</span> <span class="nb">cd</span> ..
</pre></div><p>We enter the app folder, list the contents, and then use the <code>cd ..</code> command (change directory dot dot) to return to the project directory.</p>
<p>Most of the work of developing a Rails application happens in the <strong>app/</strong> folder.</p>
<p>Earlier we described Rails as “a set of files organized with a specific structure.” We said the structure is the same for every Rails application. The <strong>app/</strong> directory is a good example. The six folders in the <strong>app/</strong> directory are the same in every Rails application. This makes it easy to collaborate with other Rails developers, providing consistency and predictablity.</p>
<p>You may recall our earlier description of Rails from the perspective of a software architect. In this folder, you’ll see evidence of the <a href="http://en.wikipedia.org/wiki/Model%E2%80%93View%E2%80%93Controller">model–view–controller</a> design pattern. Three folders named <strong>models/</strong>, <strong>views/</strong>, and <strong>controllers/</strong> enforce the software architect’s “separation of concerns” and impart structure to our code. As you build the application, we’ll explain the role of the <span class="caps">MVC</span> components in greater detail.</p>
<p>Two folders, <strong>mailers/</strong> and <strong>helpers/</strong>, play supporting roles.</p>
<p>The mailers folder is for code that sends email messages.</p>
<p>The helpers folder is for Rails <em>view helpers</em>, snippets of reusable code that generate <span class="caps">HTML</span>. Later, when we learn more about <em>views</em>, we’ll say view helpers are like “macros” that expand a short command into a longer string of <span class="caps">HTML</span> tags and content.</p>
<p>As a Rails developer, you’ll spend most of your time navigating this heirarchy of folders as you create and edit files. And because Rails provides a consistent structure, you’ll quickly find your way on any unfamiliar project.</p>
</section>
<section class='chapter' id='source-control-with-git'><h2>Source Control with Git</h2>
<p>Now that we’ve looked at our Rails project directory from the viewpoint of a programmer and software architect, let’s consider the viewpoint of the time traveler.</p>
<p>We use <a href="http://en.wikipedia.org/wiki/Git_(software)">Git</a> for version control to record a series of snapshots of our project’s filesystem. Git makes it easy to back up and recover files; more importantly, Git lets you make exploratory changes, trying out code you may decide to discard, without disturbing work you’ve done earlier. And when you collaborate with others, Git (with <a href="https://github.com/">GitHub</a>) makes it easy to share and merge code. Wide-scale distributed open source software development would not be possible without Git and previous version control systems such as <a href="http://en.wikipedia.org/wiki/Apache_Subversion">svn</a>.</p>
<p>Practically speaking, there’s no need to set up Git for a throwaway project such as this. But you’ll use Git for every real application you build, so I’ll show you the basics of setting up and using Git.</p>
<p>Before I show you Git commands, I want to mention that you can install graphical client applications to manage Git. Mac OS X has <a href="http://www.git-tower.com/">Git Tower</a> and other <a href="http://list.ly/list/FO-mac-git-clients">Mac Git clients</a>. Graphical applications for Git are useful for colleagues who don’t use a Terminal application, such as graphic designers or writers. Every developer I’ve met uses Git from the command line. Git is arcane and the commands are not intuitive. It will takes effort to master Git. But it is absolutely necessary to become familiar with Git basics.</p>
<h3 id="is-git-installed">Is Git Installed?</h3>
<p>As a first step, make sure Git is installed on your computer:</p>
<div class="highlight"><pre><span class="gp">$</span> which git
<span class="go">/usr/local/bin/git</span>
<span class="gp">$</span> git version
<span class="go">git version ...</span>
</pre></div><p>If Git is not found, install Git. GitHub provides instructions to <a href="https://help.github.com/articles/set-up-git">Set Up Git</a>. For Mac OS X, I recommend using <a href="http://mxcl.github.io/homebrew/">Homebrew</a> to install Git. See <a href="http://www.moncefbelyamani.com/how-to-install-xcode-homebrew-git-rvm-ruby-on-mac/">How to Install Xcode, Homebrew, Git…</a> from Moncef Belyamani.</p>
<h3 id="is-git-configured">Is Git Configured?</h3>
<p>Make sure Git knows who you are. Every time you update your Git repository with the <code>git commit</code> command, Git will identify you as the author of the changes.</p>
<div class="highlight"><pre><span class="gp">$</span> git config --get user.name
<span class="gp">$</span> git config --get user.email
</pre></div><p>You should see your name and email address. If not, configure Git:</p>
<div class="highlight"><pre><span class="gp">$</span> git config --global user.name <span class="s2">"Real Name"</span>
<span class="gp">$</span> git config --global user.email <span class="s2">"me@example.com@"</span>
</pre></div><p>Use your real name so people will associate you with your work when they meet you in real life. There’s no reason to use a clever name unless you have something to hide.</p>
<p>Use the same email address for Git, your GitHub account, and Heroku to avoid headaches.</p>
<h3 id="create-a-repository">Create a Repository</h3>
<p>Now we’ll add a Git repository to our project. It’s a basic step you’ll repeat every time you create a new Rails project.</p>
<p>Extending the time traveler analogy, initializing a Git repository is equivalent to setting up the time machine.</p>
<p>The <code>git init</code> command sets up a Git repository (a “repo”) in the project directory. We add the Unix symbol that indicates Git should be initialized in the current directory (git init dot):</p>
<div class="highlight"><pre><span class="gp">$</span> git init .
<span class="go">Initialized empty Git repository in ...</span>
</pre></div><p>It creates a hidden folder named <strong>.git/</strong> in the project directory. You can peek at the contents:</p>
<div class="highlight"><pre><span class="go">ls -1p .git</span>
<span class="go">HEAD</span>
<span class="go">config</span>
<span class="go">description</span>
<span class="go">hooks/</span>
<span class="go">info/</span>
<span class="go">objects/</span>
<span class="go">refs/</span>
</pre></div><p>All Git commands operate on the hidden files. The hidden files record the changing state of your project files each time you run the <code>git commit</code> command. There is no reason to ever edit files inside the hidden <strong>.git/</strong> folder (doing so could break your time machine).</p>
<h3 id="gitignore">GitIgnore</h3>
<p>Not every file should be included in a Git snapshot. Here are some types of files that should be ignored:</p>
<ul>
  <li>log files created by the web server</li>
  <li>database files</li>
  <li>configuration files that include passwords or <span class="caps">API</span> keys</li>
</ul>
<p>Git gives us an easy way to ignore files. A hidden file in the project directory named <strong>.gitignore</strong> can specify a list of files that are never seen by Git. The <code>rails new</code> command creates a <strong>.gitignore</strong> file with defaults that include log files and database files. Later, when we add configuration files that include secrets, we’ll update the <strong>.gitignore</strong> file.</p>
<p>Take a look at the contents of the <strong>.gitignore</strong> file. We use the Unix <code>cat</code> command to display the contents of the file:</p>
<div class="highlight"><pre><span class="gp">$</span> cat .gitignore
<span class="gp">#</span> See http://help.github.com/ignore-files/ <span class="k">for </span>more about ignoring files.
<span class="gp">#</span>
<span class="gp">#</span> If you find yourself ignoring temporary files generated by your text editor
<span class="gp">#</span> or operating system, you probably want to add a global ignore instead:
<span class="gp">#</span>   git config --global core.excludesfile <span class="s1">'~/.gitignore_global'</span>

<span class="gp">#</span> Ignore bundler config.
<span class="go">/.bundle</span>

<span class="gp">#</span> Ignore the default SQLite database.
<span class="go">/db/*.sqlite3</span>
<span class="go">/db/*.sqlite3-journal</span>

<span class="gp">#</span> Ignore all logfiles and tempfiles.
<span class="go">/log/*.log</span>
<span class="go">/tmp</span>
</pre></div><p>For a <strong>.gitignore</strong> file that ignores more, see an <a href="https://github.com/RailsApps/rails-composer/blob/master/files/gitignore.txt">example .gitignore file</a> from the RailsApps project.</p>
<h3 id="git-workflow">Git Workflow</h3>
<p>Your workflow with Git will move through four distinct phases as you add or edit files.</p>
<h4 id="untracked-files">Untracked Files</h4>
<p>The first phase is a “dirty” state of untracked and changed files, before any snapshot. The <code>git status</code> command lists all folders or files that are not checked into the repository.</p>
<div class="highlight"><pre><span class="gp">$</span> git status
<span class="gp">#</span> On branch master
<span class="gp">#</span>
<span class="gp">#</span> Initial commit
<span class="gp">#</span>
<span class="gp">#</span> Untracked files:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">"git add &lt;file&gt;..."</span> to include in what will be committed<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span> .gitignore
<span class="gp">#</span> Gemfile
<span class="gp">#</span> Gemfile.lock
<span class="gp">#</span> README.rdoc
<span class="gp">#</span> Rakefile
<span class="gp">#</span> app/
<span class="gp">#</span> bin/
<span class="gp">#</span> config.ru
<span class="gp">#</span> config/
<span class="gp">#</span> db/
<span class="gp">#</span> lib/
<span class="gp">#</span> log/
<span class="gp">#</span> public/
<span class="gp">#</span> vendor/
<span class="go">nothing added to commit but untracked files present (use "git add" to track)</span>
</pre></div><p>Here the <code>git status</code> command tells us that we have many untracked files. We have created new files and they are saved on the computer’s hard disk but nothing has been recorded in the Git repository.</p>
<h4 id="staging">Staging</h4>
<p>Recording files in the Git repository takes two steps: staging and committing. There will be times when you change many files at one. For example, you may fix a bug, add a new graphic, and change a form. You might think you’d like to have Git automatically record all the changes as you save each file. But the story of your project would be confusing and overly detailed. Git requires you to mark one or more files (“staging”) before recording the changes (“committing”). This gives you fine-grained control over the recorded history of your project.</p>
<p>You can mark individual files to be staged:</p>
<div class="highlight"><pre><span class="gp">$</span> git add Gemfile
</pre></div><p>Adding individual files allows you to selectively record the history of your project. For example, you might stage and commit a series of bug fixes before you stage and commit new features. Applying the time traveler analogy, it will easier to travel back to look at bug fixes if they are not mixed in with new features.</p>
<p>More often, you’ll mark all the files to be staged. Do so now:</p>
<div class="highlight"><pre><span class="gp">$</span> git add -A
</pre></div><p>Running <code>git status</code> will show you a long list of files that are staged and ready to commit.</p>
<p>There are three forms of the <code>git add</code> command:</p>
<ul>
  <li><code>git add foo.txt</code> adds a file named <strong>foo.txt</strong></li>
  <li><code>git add .</code> adds all new files and changed files, except deleted files</li>
  <li><code>git add -A</code> adds everything, including deletions</li>
</ul>
<p>If it seems nonsensical that the command “adds deletions,” don’t worry, like time travel, Git will stretch your understanding of what makes sense.</p>
<p>Most often, you can simple use the <code>git add -A</code> form of the command.</p>
<h4 id="committing">Committing</h4>
<p>Staging gives you an opportunity to organize your changes in groups before you commit. If you’ve only worked on one feature, you’ll likely stage and commit everything at once.</p>
<p>When you “make a commit”, you include a message that describes the work you’ve done. For a time traveler, the “commit message” is important; you are leaving a trail to help you find your way into the past. Google will show you dozens of blog posts about “writing better commit messages” but common sense can be your guide. Writing “fix registration form to catch blank email addresses” will be more helpful than merely writing “fix bugs.” And if you wonder why commit messages are commonly written in the imperative not past tense (“fix” not “fixed”), it’s a time traveler convention.</p>
<p>Now commit your project to the repository:</p>
<div class="highlight"><pre><span class="gp">$</span> git commit -m <span class="s2">"Initial commit"</span>
</pre></div><p>The -m flag lets you add a message for the commit.</p>
<p>The pristine state of your new Rails application is now recorded in the repo.</p>
<p>Running <code>git status</code> will tell you “nothing to commit (working directory clean).”</p>
<p>You can use the <code>git log</code> command to see your project history:</p>
<div class="highlight"><pre><span class="gp">$</span> git log
</pre></div><p>If you get “stuck” in <code>git log</code>, type <code>q</code> to return to the command prompt.</p>
<h4 id="pushing-to-github">Pushing to GitHub</h4>
<p>We’ve seen three phases of the Git workflow: <em>untracked</em>, <em>staged</em>, and <em>committed</em>.</p>
<p>A fourth stage is important when you work with others: <em>pushing</em> to GitHub. It’s also important when you access your project from more than one computer or you want an offsite backup of your work.</p>
<p>The repositories hosted on your GitHub account establish your reputation as a Rails developer for employers and developers you may work with. Even if your first project is copied from a tutorial, it shows you are serious about learning Rails and studying conscientiously.</p>
<p>Did you create a GitHub account? Now would be a good time to add your repo to GitHub.</p>
<p>Go to GitHub and <a href="https://github.com/repositories/new">create a new empty repository</a> for your project. Name the repository “learn-rails” and give it a description. If the repository is public, hosting on GitHub is free. Don’t be reluctant to go public with an unfinished or half-baked project; everyone expects projects on GitHub to be works in progress.</p>
<p>Add GitHub as a remote repository for your project and push your local project to GitHub. Before you copy and paste the command, notice that you need to insert your own GitHub account name:</p>
<div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:YOUR_GITHUB_ACCOUNT/learn-rails.git
<span class="go">git push -u origin master</span>
</pre></div><p>Now you can view your project repository on GitHub at:</p>
<ul>
  <li><a href="https://github.com/YOUR_GITHUB_ACCOUNT/learn-rails">https://github.com/YOUR_GITHUB_ACCOUNT/learn-rails</a></li>
</ul>
<p>Take a look. It’s an exact copy of the project on your local computer.</p>
<p>If you haven’t used GitHub before, take some time to explore. GitHub is absolutely essential to all open source Rails development.</p>
<p>You may notice that the <strong><span class="caps">README</span>.rdoc</strong> file is automatically incorporated into the home page of the project repository on GitHub. For our next step, we’ll update the <span class="caps">README</span> file, commit it to the local repo, and push it up to GitHub.</p>
<h3 id="the-readme">The <span class="caps">README</span></h3>
<p>Changing the <span class="caps">README</span> file is a good way to practice with Git. It’s also a good habit to edit the <span class="caps">README</span> file whenever you create a new project. It’s easy to neglect the <span class="caps">README</span> for little projects that you’ve just started. But replacing a default <span class="caps">README</span> file shows you are a disciplined, conscientious developer who will be a good collaborator.</p>
<p>The new <span class="caps">README</span> file can be brief. Just state your intentions and acknowledge any code you’ve borrowed. For this project you could say, “Excited to learn Rails with help from the RailsApps project!”</p>
<p>In your text editor, open the file <strong><span class="caps">README</span>.rdoc</strong> and replace the contents:</p>
<div class="highlight"><pre>Learning Rails
==

Learning Rails with a tutorial from the RailsApps project.
</pre></div><p>GitHub lets you add formatting using your choice of markup syntax, depending on the file extension you add to the filename:</p>
<ul>
  <li><span class="caps">README</span>.rdoc uses the <a href="http://rdoc.rubyforge.org/RDoc.html">rdoc</a> syntax</li>
  <li><span class="caps">README</span>.md uses the <a href="https://help.github.com/articles/github-flavored-markdown">GitHub Flavored Markdown</a> syntax</li>
  <li><span class="caps">README</span>.textile uses the <a href="http://redcloth.org/hobix.com/textile/">Textile</a> syntax</li>
</ul>
<p>We’ll use Markdown syntax by adding the <code>==</code> characters after the first line of text to force a headline.</p>
<p>Rename the file to <strong><span class="caps">README</span>.md</strong> and save it.</p>
<div class="highlight"><pre><span class="gp">$</span> mv README.rdoc README.md
</pre></div><p>Use <code>git status</code> to see what has changed:</p>
<div class="highlight"><pre><span class="gp">$</span> git status
<span class="gp">#</span> On branch master
<span class="gp">#</span> Changes not staged <span class="k">for </span>commit:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">"git add/rm &lt;file&gt;..."</span> to update what will be committed<span class="o">)</span>
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">"git checkout -- &lt;file&gt;..."</span> to discard changes in working directory<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span> deleted:    README.rdoc
<span class="gp">#</span>
<span class="gp">#</span> Untracked files:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">"git add &lt;file&gt;..."</span> to include in what will be committed<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span> README.md
<span class="go">no changes added to commit (use "git add" and/or "git commit -a")</span>
</pre></div><p>In Git, renaming the file has deleted the <strong><span class="caps">README</span>.rdoc</strong> file and created a new, untracked <strong><span class="caps">README</span>.md</strong> file.</p>
<p>Here’s our typical workflow. We’ll stage, commit, and push the change to GitHub:</p>
<div class="highlight"><pre><span class="gp">$</span> git add -A
<span class="gp">$</span> git commit -m <span class="s2">"update README"</span>
<span class="gp">$</span> git push origin master
</pre></div><p>Take a look at your GitHub repository (refresh the web page). Very cool! The <span class="caps">README</span> file has been updated.</p>
<p>The <code>git log</code> command will display your project history:</p>
<div class="highlight"><pre><span class="gp">$</span> git log
</pre></div><p>You can read more about <a href="http://railsapps.github.io/rails-git.html">Git and Rails</a> if you need more information about working with Git and GitHub for code source control.</p>
<p>Now that you’re comfortable with Git, we can begin customizing our new Rails application.</p>
</section>
<section class='chapter' id='gems'><h2>Gems</h2>
<p>The art of selecting gems is at the heart of Rails development. I explained earlier that gems are packages of code, “software libraries,” that have been developed and tested by other developers. Some gems add functionality or features to a website. Other gems play a supporting role, making development easier or implementing basic infrastructure. Gems are open source. They are available at no charge and can be freely copied and modified.</p>
<p>It is a mark of honor to release a gem for public use, and a developer’s reputation can be established when a gem becomes popular and widely used. Gems are often created when a developer has used the same code as a component in more than one web application. He or she will take time to release the code as a gem. That’s how the Rails ecosystem was built, gem by gem since 2004.</p>
<p>There is no evaluation or review process in publishing gems. Gems are hosted on a public server, <a href="https://rubygems.org/">rubygems.org</a>. Gems are mostly text files (like any other Ruby code), organized in a particular format with some descriptive information (in a <strong>gemspec</strong> file), and compressed and archived as a single file. A single command, <code>gem push</code>, uploads a gem to the rubygems.org server for anyone to use.</p>
<p>Over 50,000 gems have been released since rubygems.org was established. Some of these gems are used by one or two developers on their own projects. Many others have been neglected and abandoned due to lack of interest. Only a few thousand gems are popular and widely used. As a Rails developer, you must master the art of finding and evaluating gems so you can base your applications on the tried-and-true work of others.</p>
<p>There is no single authoritative source of recommendations for gems. The <a href="http://ruby-toolbox.com/">Ruby Toolbox</a> website categorizes and ranks many gems by popularity, and it is a good place to begin hunting for useful gems. Other than that, it’s useful to study example applications and search for blog posts to find which gems are most often recommended. When you find an interesting gem, search <a href="http://stackoverflow.com/questions/tagged/ruby-on-rails-3">Stack Overflow</a> or Google to see what people are saying. Look at the gem’s GitHub repository and check:</p>
<ul>
  <li>how many issues are open?</li>
  <li>how recent are the commits of patches or updates?</li>
  <li>is there a <span class="caps">CHANGELOG</span> file?</li>
  <li>is the gem well-documented?</li>
  <li>how many “stars” (people watching) or “forks” (people hacking)?</li>
</ul>
<p>As a beginner, tutorials like this are the best place to learn about the gems you should use for your projects.</p>
<h3 id="rails-gems">Rails Gems</h3>
<p>Rails itself is a gem that, in turn, requires a collection of other gems. This becomes clear if you look at the <a href="https://rubygems.org/gems/rails">summary page for Rails</a> on the rubygems.org site. On that page, you’ll see photos of the Rails core team. More importantly, you’ll see a list of gems that are required to use Rails:</p>
<ul>
  <li><a href="https://github.com/rails/rails/tree/master/actionmailer">actionmailer</a> – framework for email delivery and testing</li>
  <li><a href="https://github.com/rails/rails/tree/master/actionpack">actionpack</a> – framework for routing and responding to web requests</li>
  <li><a href="https://github.com/rails/rails/tree/master/activerecord">activerecord</a> – framework for connections to databases</li>
  <li><a href="https://github.com/rails/activeresource">activeresource</a> – framework for manipulating data</li>
  <li><a href="https://github.com/rails/rails/tree/master/activesupport">activesupport</a> – utility classes and Ruby library extensions</li>
  <li><a href="http://gembundler.com/">bundler</a> – utility to manage gems</li>
  <li><a href="https://github.com/rails/rails/tree/master/railties">railties</a> – console commands and generators</li>
</ul>
<p>These are the “runtime dependencies” for Rails. Each of these gems has its own dependencies as well. When you install Rails, a total of 44 gems are automatically installed in your development environment.</p>
<h3 id="gems-for-a-rails-default-application">Gems for a Rails Default Application</h3>
<p>In addition to the Rails gem and its dependencies, a handful of other gems are included in every <code>rails new</code> default starter application:</p>
<ul>
  <li><a href="https://github.com/luislavena/sqlite3-ruby">sqlite3</a> – adapter for the SQLite database</li>
  <li><a href="https://github.com/rails/sass-rails">sass-rails</a> – enables use of the <span class="caps">SCSS</span> syntax for stylesheets</li>
  <li><a href="https://github.com/lautis/uglifier">uglifier</a> – JavaScript compressor</li>
  <li><a href="https://github.com/rails/coffee-rails">coffee-rails</a> – enables use of the CoffeeScript syntax for JavaScript</li>
  <li><a href="https://github.com/rails/jquery-rails">jquery-rails</a> – adds the <a href="http://jquery.com/">jQuery</a> JavaScript library</li>
  <li><a href="https://github.com/rails/turbolinks">turbolinks</a> – faster loading of webpages</li>
  <li><a href="https://github.com/rails/jbuilder">jbuilder</a> – utility for encoding <span class="caps">JSON</span> data</li>
</ul>
<p>You may not need a SQLite database, <span class="caps">SCSS</span> for stylesheets, jQuery or the others, but many developers use these tools so they are included in the default starter application.</p>
<h3 id="where-do-gems-live">Where Do Gems Live?</h3>
<p>When you run a Rails application, gems are loaded into the computer’s working memory immediately before your own custom code is loaded. Gems are handled by the Ruby interpreter no differently than your own code. It’s all Ruby code, whether you or someone else wrote it.</p>
<p>You’ll know exactly where to find your own code (it’s in your project directory). But where are the gems? Run the <code>gem which</code> command and you’ll see:</p>
<div class="highlight"><pre><span class="gp">$</span> gem which bundler
<span class="go">/Users/me/.rvm/gems/ruby-2.0.0-p0@global/gems/bundler-1.3.5/lib/bundler.rb</span>
<span class="gp">$</span> gem which rails
<span class="go">/Users/me/.rvm/gems/ruby-2.0.0-p0@learn-rails/gems/railties-4.0.0.rc1/lib/rails.rb</span>
</pre></div><p>Gems are files saved to the computer’s disk storage. If you use <span class="caps">RVM</span>, they are saved to a hidden <strong>.rvm</strong> folder in your user directory. A <strong>global</strong> subfolder contains the Bundler gem. A project-specific <strong>learn-rails</strong> subfolder contains the Rails gem. If you use Chruby or Rbenv instead of <span class="caps">RVM</span>, your gems will stored in a different location.</p>
<p>If “learn-rails” is not in the filepath displayed by <code>gem which rails</code>, you may need to reset your <span class="caps">RVM</span> gemset:</p>
<div class="highlight"><pre><span class="gp">$</span> rvm gemset use learn-rails
</pre></div><p>You’ll never move or delete gems directly. Instead you’ll manage gems using the <a href="http://gembundler.com/">Bundler</a> utility. The key to Bundler is the Gemfile.</p>
<h3 id="gemfile">Gemfile</h3>
<p>Every Rails application has a Gemfile. Earlier, I described Rails from the viewpoint of the “gem hunter,” the developer who wants to assemble an application from the best open source components he or she can find. To the gem hunter, the Gemfile is the most important file in the application. It lists each gem that the developer wants to use.</p>
<p>The Gemfile provides the information needed by the <a href="http://gembundler.com/">Bundler</a> utility to manage gems.</p>
<p>Bundler’s <code>bundle install</code> command reads the Gemfile, then downloads and saves each listed gem to the hidden gem folder. Bundler checks to see if the gem is already installed and only downloads gems that are needed. Bundler checks for the newest gem version and records the version number in the <strong>Gemfile.lock</strong> file. Bundler also downloads any gem dependencies and records the dependencies in the <strong>Gemfile.lock</strong> file. Between the Gemfile, with its list of gems that wil be used by the application, and the <strong>Gemfile.lock</strong> file, with its list of dependencies and version numbers, you have a complete specification of every gem required to run the application. More importantly, when other developers install your application, Bundler will automatically install all the gems (including dependencies and correct versions) needed to run the application. When you deploy the application to production for others to use, automated deployment scripts (such as those used by Heroku) install all the required gems.</p>
<p>Bundler provides a <code>bundle update</code> command when we want to replace any gems with newer versions. If you run <code>bundle update</code>, any new gem versions will be downloaded and installed and the <strong>Gemfile.lock</strong> file will be updated. Be aware that updating gems can break your application, so only update gems when you have time to test and resolve any issues. You can run <code>bundle outdated</code> to see which gems are available in newer versions.</p>
<p>If you want to prevent your fellow developers (or yourself) from accidentally updating gems, you can specify a gem version number for any gem in the Gemfile. The Gemfile gives fine-grained control over rules for updating:</p>
<ul>
  <li><code>gem 'rails', '4.0.0'</code> ia “absolute”, only version 4.0.0 will be used</li>
  <li><code>gem 'rails', '&gt;= 4.0.0'</code> is “optimistic”, any version newer than 4.0.0 will be used</li>
  <li><code>gem 'rails', '~&gt; 4.0.0'</code> is “pessimistic”</li>
</ul>
<p>“Pessimistic” versioning needs some explanation. <code>~&gt; 4.0.0</code> means use<br />
any version greater than 4.0.0 and less than 4.1 (any patch version can be used). <code>~&gt; 4.0</code> means use any version greater than 4.0 and less than 5.0 (any minor version can be used).</p>
<p>In general, during development we only lock down any gem versions in the Gemfile if we know newer versions introduce problems. The exception is the Rails gem itself. We always specify the version of Rails we are using for development.</p>
<p>Let’s take a look at the Gemfile created by the <code>rails new</code> command.</p>
<h3 id="gemfile-for-a-rails-default-application">Gemfile for a Rails Default Application</h3>
<p>Open the <strong>Gemfile</strong> with your text editor:</p>
<div class="highlight"><pre><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>

<span class="c1"># Bundle edge Rails instead: gem 'rails', github: 'rails/rails'</span>
<span class="n">gem</span> <span class="s1">'rails'</span><span class="p">,</span> <span class="s1">'4.0.0.rc1'</span>

<span class="c1"># Use sqlite3 as the database for Active Record</span>
<span class="n">gem</span> <span class="s1">'sqlite3'</span>

<span class="c1"># Use SCSS for stylesheets</span>
<span class="n">gem</span> <span class="s1">'sass-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 4.0.0.rc1'</span>

<span class="c1"># Use Uglifier as compressor for JavaScript assets</span>
<span class="n">gem</span> <span class="s1">'uglifier'</span><span class="p">,</span> <span class="s1">'&gt;= 1.3.0'</span>

<span class="c1"># Use CoffeeScript for .js.coffee assets and views</span>
<span class="n">gem</span> <span class="s1">'coffee-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 4.0.0'</span>

<span class="c1"># See https://github.com/sstephenson/execjs#readme for more supported runtimes</span>
<span class="c1"># gem 'therubyracer', platforms: :ruby</span>

<span class="c1"># Use jquery as the JavaScript library</span>
<span class="n">gem</span> <span class="s1">'jquery-rails'</span>

<span class="c1"># Turbolinks makes following links in your web application faster. Read more: https://github.com/rails/turbolinks</span>
<span class="n">gem</span> <span class="s1">'turbolinks'</span>

<span class="c1"># Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder</span>
<span class="n">gem</span> <span class="s1">'jbuilder'</span><span class="p">,</span> <span class="s1">'~&gt; 1.0.1'</span>

<span class="n">group</span> <span class="ss">:doc</span> <span class="k">do</span>
  <span class="c1"># bundle exec rake doc:rails generates the API under doc/api.</span>
  <span class="n">gem</span> <span class="s1">'sdoc'</span><span class="p">,</span> <span class="nb">require</span><span class="p">:</span> <span class="kp">false</span>
<span class="k">end</span>

<span class="c1"># Use ActiveModel has_secure_password</span>
<span class="c1"># gem 'bcrypt-ruby', '~&gt; 3.0.0'</span>

<span class="c1"># Use unicorn as the app server</span>
<span class="c1"># gem 'unicorn'</span>

<span class="c1"># Use Capistrano for deployment</span>
<span class="c1"># gem 'capistrano', group: :development</span>

<span class="c1"># Use debugger</span>
<span class="c1"># gem 'debugger', group: [:development, :test]</span>
</pre></div><p>The first line, <code>source 'https://rubygems.org'</code>, directs Bundler to use the <a href="https://rubygems.org/">rubygems.org</a> server as a source for any gems.</p>
<p>Notice that the second uncommented line directs Bundler to use Rails and specifies the version number. It’s important to specify which version of Rails we are using. Rails changes frequently and newer versions may not work as we expect.</p>
<p>It’s also wise to specify the Ruby version we’re using. This is needed for automated deployment scripts such as those used by Heroku. We can add that to the Gemfile:</p>
<div class="highlight"><pre><span class="go">ruby '2.0.0'</span>
</pre></div><p>In the Gemfile you’ll see the gems for a Rails default application, such as sqlite3, which we described earlier. Other gems are commented out (the lines begin with the # character). These are suggestions and we can ignore them or remove them.</p>
<p>We won’t use a database for our application but we’ll keep the <code>gem 'sqlite3'</code> entry. Configuring Rails for no database is complicated; it is easier to keep the sqlite3 gem and not use it.</p>
<p>The <code>gem 'sdoc'</code> line is useful only when using <code>rake doc:rails</code> command to generate <span class="caps">API</span> documentation so we can remove it.</p>
<p>If you are developing your application on a computer using the Linux operating system, you may need to uncomment and use the statement <code>gem 'therubyracer', platforms: :ruby</code>. Linux doesn’t have a built-in JavaScript interpreter so you must install Node.js in your environment or else add the therubyracer gem to each project Gemfile.</p>
<p>If you remove the extra clutter in the <strong>Gemfile</strong> it will look like this:</p>
<div class="highlight"><pre><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>
<span class="n">ruby</span> <span class="s1">'2.0.0'</span>
<span class="n">gem</span> <span class="s1">'rails'</span><span class="p">,</span> <span class="s1">'4.0.0.rc1'</span>

<span class="c1"># Rails defaults</span>
<span class="n">gem</span> <span class="s1">'sqlite3'</span>
<span class="n">gem</span> <span class="s1">'sass-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 4.0.0.rc1'</span>
<span class="n">gem</span> <span class="s1">'uglifier'</span><span class="p">,</span> <span class="s1">'&gt;= 1.3.0'</span>
<span class="n">gem</span> <span class="s1">'coffee-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 4.0.0'</span>
<span class="n">gem</span> <span class="s1">'jquery-rails'</span>
<span class="n">gem</span> <span class="s1">'turbolinks'</span>
<span class="n">gem</span> <span class="s1">'jbuilder'</span><span class="p">,</span> <span class="s1">'~&gt; 1.0.1'</span>
</pre></div><p>This is our uncluttered default Gemfile.</p>
<h3 id="adding-gems">Adding Gems</h3>
<p>I’ve identified several gems that will be useful for our tutorial application. I’ve used these gems on previous projects and I recommend them.</p>
<p>We’re adding these gems at the beginning of our development process since we already know which gems we’ll need. On a real project, you’ll often discover useful gems and add them to the Gemfile during the ongoing process of development.</p>
<p>Here are the gems we’ll add to the Gemfile:</p>
<ul>
  <li><a href="https://github.com/softace/activerecord-tableless">activerecord-tableless</a> – helps to use Rails without a database</li>
  <li><a href="https://github.com/laserlemon/figaro">figaro</a> – configuration framework</li>
  <li><a href="https://github.com/thomas-mcdonald/bootstrap-sass">bootstrap-sass</a> – Twitter Bootstrap for <span class="caps">CSS</span> and JavaScript</li>
  <li><a href="http://simple-form.plataformatec.com.br/">simple_form</a> – forms made easy</li>
  <li><a href="https://github.com/thoughtbot/high_voltage">high_voltage</a> – for static pages like “about”</li>
  <li><a href="https://github.com/amro/gibbon">gibbon</a> – access to the MailChimp <span class="caps">API</span></li>
</ul>
<p>We’ll also add a utility that makes development easier:</p>
<ul>
  <li><a href="https://github.com/charliesome/better_errors">better_errors</a> – helps when things go wrong</li>
</ul>
<p>Open your <strong>Gemfile</strong> and replace the contents with the following:</p>
<p><strong>Gemfile</strong></p>
<div class="highlight"><pre><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>
<span class="n">ruby</span> <span class="s1">'2.0.0'</span>
<span class="n">gem</span> <span class="s1">'rails'</span><span class="p">,</span> <span class="s1">'4.0.0.rc1'</span>

<span class="c1"># Rails defaults</span>
<span class="n">gem</span> <span class="s1">'sqlite3'</span>
<span class="n">gem</span> <span class="s1">'sass-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 4.0.0.rc1'</span>
<span class="n">gem</span> <span class="s1">'uglifier'</span><span class="p">,</span> <span class="s1">'&gt;= 1.3.0'</span>
<span class="n">gem</span> <span class="s1">'coffee-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 4.0.0'</span>
<span class="n">gem</span> <span class="s1">'jquery-rails'</span>
<span class="n">gem</span> <span class="s1">'turbolinks'</span>
<span class="n">gem</span> <span class="s1">'jbuilder'</span><span class="p">,</span> <span class="s1">'~&gt; 1.0.1'</span>

<span class="c1"># learn-rails</span>
<span class="n">gem</span> <span class="s1">'activerecord-tableless'</span>
<span class="n">gem</span> <span class="s1">'figaro'</span>
<span class="n">gem</span> <span class="s1">'bootstrap-sass'</span>
<span class="n">gem</span> <span class="s1">'simple_form'</span>
<span class="n">gem</span> <span class="s1">'high_voltage'</span>
<span class="n">gem</span> <span class="s1">'gibbon'</span>
<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'better_errors'</span>
<span class="k">end</span>
</pre></div><p>Notice that we’ve placed the better_errors gem inside a “group.” Specifying a group for development or testing insures a gem isnot loaded in production, reducing the application’s memory footprint.</p>
<p>Each time you edit the Gemfile, run <code>bundle install</code> and restart your web server.</p>
<h3 id="install-the-gems">Install the Gems</h3>
<p>Now that you’ve edited the Gemfile, you need to install the required gems on your computer:</p>
<div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div><p>We’ll see all the gems and their dependencies:</p>
<div class="highlight"><pre><span class="go">Fetching gem metadata from https://rubygems.org/........</span>
<span class="go">Fetching gem metadata from https://rubygems.org/..</span>
<span class="go">Resolving dependencies...</span>
<span class="go">Using rake (10.0.4)</span>
<span class="go">Using i18n (0.6.4)</span>
<span class="go">Installing minitest (4.7.4)</span>
<span class="go">Using multi_json (1.7.6)</span>
<span class="go">Using atomic (1.1.9)</span>
<span class="go">Using thread_safe (0.1.0)</span>
<span class="go">Using tzinfo (0.3.37)</span>
<span class="go">Using activesupport (4.0.0.rc1)</span>
<span class="go">Using builder (3.1.4)</span>
<span class="go">Using erubis (2.7.0)</span>
<span class="go">Using rack (1.5.2)</span>
<span class="go">Using rack-test (0.6.2)</span>
<span class="go">Using actionpack (4.0.0.rc1)</span>
<span class="go">Using mime-types (1.23)</span>
<span class="go">Using polyglot (0.3.3)</span>
<span class="go">Using treetop (1.4.14)</span>
<span class="go">Using mail (2.5.4)</span>
<span class="go">Using actionmailer (4.0.0.rc1)</span>
<span class="go">Using activemodel (4.0.0.rc1)</span>
<span class="go">Using activerecord-deprecated_finders (1.0.2)</span>
<span class="go">Using arel (4.0.0)</span>
<span class="go">Using activerecord (4.0.0.rc1)</span>
<span class="go">Installing activerecord-tableless (1.2.0)</span>
<span class="go">Installing coderay (1.0.9)</span>
<span class="go">Installing better_errors (0.9.0)</span>
<span class="go">Installing sass (3.2.9)</span>
<span class="go">Installing bootstrap-sass (2.3.1.3)</span>
<span class="go">Using bundler (1.3.5)</span>
<span class="go">Installing coffee-script-source (1.6.2)</span>
<span class="go">Installing execjs (1.4.0)</span>
<span class="go">Installing coffee-script (2.2.0)</span>
<span class="go">Using thor (0.18.1)</span>
<span class="go">Using railties (4.0.0.rc1)</span>
<span class="go">Installing coffee-rails (4.0.0)</span>
<span class="go">Using hike (1.2.2)</span>
<span class="go">Using tilt (1.4.1)</span>
<span class="go">Using sprockets (2.10.0)</span>
<span class="go">Using sprockets-rails (2.0.0.rc4)</span>
<span class="go">Using rails (4.0.0.rc1)</span>
<span class="go">Installing figaro (0.6.4)</span>
<span class="go">Installing multi_xml (0.5.4)</span>
<span class="go">Installing httparty (0.11.0)</span>
<span class="go">Installing gibbon (0.4.6)</span>
<span class="go">Installing high_voltage (1.2.2)</span>
<span class="go">Installing jbuilder (1.0.2)</span>
<span class="go">Installing jquery-rails (3.0.0)</span>
<span class="go">Installing sass-rails (4.0.0.rc1)</span>
<span class="go">Installing simple_form (1.4.1)</span>
<span class="go">Installing sqlite3 (1.3.7)</span>
<span class="go">Installing turbolinks (1.2.0)</span>
<span class="go">Installing uglifier (2.1.1)</span>
<span class="go">Your bundle is complete!</span>
<span class="go">Use `bundle show [gemname]` to see where a bundled gem is installed.</span>
</pre></div><p>You can use your text editor to view the contents of <strong>Gemfile.lock</strong> and you will see a detailed listing of every gem and each dependency, with version numbers. There’s no reason to edit a <strong>Gemfile.lock</strong> file; if it is ever in error, delete it and run <code>bundle install</code> to recreate it.</p>
<p>Run <code>gem list</code> to see all the gems that are loaded into the development environment:</p>
<div class="highlight"><pre><span class="gp">$</span> gem list
</pre></div><p>The list of gems loaded in the environment and specified in the <strong>Gemfile.lock</strong> will be the same. Here’s how it works. <span class="caps">RVM</span> makes a place for the gems to be stored (the <span class="caps">RVM</span> gemset); the <strong>Gemfile</strong> lists the gems you want to use; the <strong>Gemfile.lock</strong> file records dependencies and version numbers; <code>bundle install</code> reads the Gemfile and installs the gems into the <span class="caps">RVM</span> gemset; and <code>gem list</code> shows you the gems that are loaded into memory and available for use.</p>
<h3 id="git">Git</h3>
<p>Let’s commit our changes to the Git repository.</p>
<div class="highlight"><pre><span class="gp">$</span> git add -A
<span class="gp">$</span> git commit -m <span class="s2">"add gems"</span>
<span class="gp">$</span> git push origin master
</pre></div><p>If you get a message:</p>
<div class="highlight"><pre><span class="go">fatal: 'origin' does not appear to be a git repository</span>
<span class="go">fatal: The remote end hung up unexpectedly</span>
</pre></div><p>It shows that you can’t connect to GitHub to commit the changes. It is not absolutely necessary to use GitHub for this tutorial. We’re only using it so you’ll be familiar with the workflow of professional development.</p>
<p>We’re ready to configure the application.</p>
</section>
<section class='chapter' id='configuration'><h2>Configuration</h2>
<p>In our tutorial application, we’ll need to save an account name and password for a Gmail account so we can send email from the application.</p>
<p>We’ll also need a store an <span class="caps">API</span> key to access MailChimp, which we’ll use to add visitors’ email addresses to a mailing list.</p>
<p>Rails is known for its “convention over configuration” guiding principle. As applied, the principle reduces the need for many configuration files. It’s not possible to eliminate all configuration files, however. Many applications require configuration of settings such as email account credentials or <span class="caps">API</span> keys for external services.</p>
<p>Remote Git repositories such as GitHub are a place to store and share code. But you shouldn’t save email account credentials or private <span class="caps">API</span> keys to a shared Git repository where others can see them. Operating systems (Linux, Mac OS X, Windows) provide mechanisms to set local <a href="http://en.wikipedia.org/wiki/Environment_variable">environment variables</a>, as does Heroku and other deployment platforms. Environment variables can be accessed from Rails applications and provide an ideal place to set configuration settings that must remain private. With a bit of Unix skill, most developers can set environment variables using the Unix shell. For applications from the RailsApps project, we take a hybrid approach and use the <a href="https://github.com/laserlemon/figaro">figaro gem</a> that lets us set environment variables from the Unix shell or from a simple configuration file.</p>
<p>For our tutorial, we’ll show how to set up configuration settings using the <a href="https://github.com/laserlemon/figaro">figaro gem</a>. You can read the article <a href="http://railsapps.github.io/rails-environment-variables.html">Rails Environment Variables</a> if you’d like learn about the figaro gem or explore other approaches.</p>
<h3 id="configuration-file">Configuration File</h3>
<p>The tutorial application uses the <a href="https://github.com/laserlemon/figaro">figaro gem</a> to set environment variables. We’ve already installed the figaro gem in the Gemfile and run <code>bundle install</code>.</p>
<p>The figaro gem uses a generator to set up the necessary files. Run:</p>
<div class="highlight"><pre><span class="gp">$</span> rails generate figaro:install
</pre></div><p>This generates a <strong>config/application.yml</strong> file and lists it in your <strong>.gitignore</strong> file.</p>
<p>Take a look at the <code>rails generate</code> command. Some gems need to modify Rails files or install configuration files. The <code>rails generate</code> command can be used with any gem to install or modify files.</p>
<p>We’ll set credentials for your Gmail and MailChimp accounts in the <strong>config/application.yml</strong> file. The <strong>.gitignore</strong> file prevents the <strong>config/application.yml</strong> file from being saved in the Git repository so your credentials are kept private.</p>
<p>Use your text editor to replace the file <strong>config/application.yml</strong> with this:</p>
<div class="highlight"><pre><span class="c1"># Add account credentials and API keys here.</span>
<span class="c1"># See http://railsapps.github.io/rails-environment-variables.html</span>
<span class="c1"># This file should be listed in .gitignore to keep your settings secret!</span>
<span class="c1"># Each entry sets a local environment variable and overrides ENV variables in the Unix shell.</span>
<span class="l-Scalar-Plain">GMAIL_USERNAME</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Your_Username</span>
<span class="l-Scalar-Plain">GMAIL_PASSWORD</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Your_Password</span>
<span class="l-Scalar-Plain">MAILCHIMP_API_KEY</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Your_MailChimp_API_Key</span>
<span class="l-Scalar-Plain">MAILCHIMP_LIST_ID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Your_List_ID</span>
</pre></div><p>Replace the placeholders in the <strong>config/application.yml</strong> file with real credentials.</p>
<p>The Gmail username and password are the same credentials you use to log in to Gmail when you check your inbox.</p>
<p>When visitors sign up to receive a newsletter, we’ll add them to a MailChimp list. Add an environment variable for the MailChimp <span class="caps">API</span> key: <code>MAILCHIMP_API_KEY</code>. <a href="https://admin.mailchimp.com/">Log in to MailChimp</a> and find the MailChimp <span class="caps">API</span> key under the tab for “Account” on the MailChimp website. Look for the “API Keys and Authorized Apps” menu item.</p>
<p>We’ll add <code>MAILCHIMP_LIST_ID</code> for the ID of the mailing list we’ll set up in MailChimp. To find the list ID, <a href="https://admin.mailchimp.com/">log in to MailChimp</a> and on the MailChimp “Lists” page, look for the dropdown “gear” menu for the mailing list you’ve created and click “List Settings and Unique ID.” At the bottom of the List Settings page, you’ll find the unique ID for the mailing list.</p>
<p>All configuration values in the <strong>config/application.yml</strong> file are available anywhere in the application as environment variables. Later in the tutorial we’ll see how we use the environment variables.</p>
<h3 id="git-2">Git</h3>
<p>Let’s commit our changes to the Git repository.</p>
<div class="highlight"><pre><span class="gp">$</span> git add -A
<span class="gp">$</span> git commit -m <span class="s2">"add configuration file"</span>
<span class="gp">$</span> git push origin master
</pre></div><p>We’re ready to create a home page for the application.</p>
</section>
<section class='chapter' id='static-pages-and-routing'><h2>Static Pages and Routing</h2>
<p>A Rails application can deliver static web pages just like an ordinary web server. The pages are delivered fast and no Ruby code is required. We’ll look at simple static pages and learn about Rails routing before we explore the complexities of dynamic web pages in Rails.</p>
<h3 id="add-a-home-page">Add a Home Page</h3>
<p>Make sure you are in your project directory.</p>
<p>Start the application server:</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>. You’ll see the Rails default information page.</p>
<p>Use your text editor to create and save a file <strong>public/index.html</strong>:</p>
<div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Hello World<span class="nt">&lt;/h1&gt;</span>
</pre></div><p>Refresh the browser window and you’ll see the “Hello World” message.</p>
<p>The Rails application server looks for any pages in the <strong>public</strong> folder by default.</p>
<p>If no filename is specified in the <span class="caps">URL</span>, the server will attempt to respond with a file named <strong>index.html</strong>. This is a convention that dates to 1993; if no filename was specified, the early <span class="caps">NCSA</span> httpd server would return a list of all files in the directory, unless a file named <strong>index.html</strong> was present. Since then, <strong>index.html</strong> has been the default filename for a home page.</p>
<h3 id="routing-error">Routing Error</h3>
<p>What happens when no file matches the requested web address?</p>
<p>Enter the <span class="caps">URL</span> <a href="http://localhost:3000/about.html">http://localhost:3000/about.html</a> in your browser.</p>
<p>You’ll see an error page that shows a routing error.</p>
<h3 id="add-an-about-page">Add an About Page</h3>
<p>Use your text editor to create and save a file <strong>public/about.html</strong>:</p>
<div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>About<span class="nt">&lt;/h1&gt;</span>
</pre></div><p>Visit the <span class="caps">URL</span> <a href="http://localhost:3000/about.html">http://localhost:3000/about.html</a> in your browser. You’ll see the new “About” page.</p>
<p>By the way, you’ve just done test-driven development. You’ve tested behavior before implementing a feature and seen an error condition. Then you’ve implemented the feature and seen a successful result to your test. Test-driven development with Ruby code is more complex (because you’ll write tests in Ruby) but the principle is the same.</p>
<h3 id="introducing-routes">Introducing Routes</h3>
<p>The guiding principle of “convention over configuration” governs Rails routing. If the web browser requests a page named “index.html”, Rails will deliver the page from the <strong>public</strong> folder by default. No configuration is required. But what if you want to override the default behavior? Rails provides a configuration file to control web request routing.</p>
<p>Remove the <strong>public/index.html</strong> file:</p>
<div class="highlight"><pre><span class="gp">$</span> rm public/index.html
</pre></div><p>Now let’s set the “About” page as the home page.</p>
<p>Open the file <strong>config/routes.rb</strong>. Remove all the comments and replace the file with this:</p>
<div class="highlight"><pre><span class="ss">LearnRails</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">'/about.html'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div><p>Notice the name of the application <code>LearnRails</code> is included in the file. When  you created the application, I suggested you use the name <code>learn-rails</code>. If you gave the project a different name, you’ll have to modify the <strong>config/routes.rb</strong> file accordingly.</p>
<p>This snippet of Rails routing code takes any request to the application root (<a href="http://localhost:3000/">http://localhost:3000/</a>) and redirects it to the <strong>about.html</strong> file (which is expected to be found in the <strong>public</strong> folder).</p>
<p>When you change the <strong>config/routes.rb</strong> file, you must restart your application server to see the new behavior. Use Control-C to stop the server and restart it:</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>Visit the page <a href="http://localhost:3000">http://localhost:3000/</a>. You’ll see the “About” page.</p>
<p>You’ve just seen an example of Rails magic. Some developers complain that the “convention over configuration” principle is black magic. It’s not obvious why pages are delivered from the <strong>public</strong> folder; it just happens. If you don’t know the convention, you could be left scratching your head and looking for the code that maps <a href="http://localhost:3000/">http://localhost:3000/</a> to the <strong>public/index.html</strong> file. The code is buried deep in the Rails framework. However, if you know the convention and the technique for overriding it, you have both convenience and power at your disposal.</p>
<h3 id="remove-the-about-page">Remove the About Page</h3>
<p>In the next chapter we’ll look at ways to implement the home page using the full power of Rails.</p>
<p>For now, delete the file <strong>public/about.html</strong>:</p>
<div class="highlight"><pre><span class="gp">$</span> rm public/about.html
</pre></div><p>Now we’ll build a dynamic home page.</p>
</section>
<section class='chapter' id='dynamic-home-page'><h2>Dynamic Home Page</h2>
<p>In the last chapter, we saw how Rails can deliver simple static web pages.</p>
<p>Here we’ll build a dynamic home page, illustrating basic concepts you’ll need to understand Rails.</p>
<h3 id="user-story">User Story</h3>
<p>We’ll plan our work with a user story:</p>
<div class="highlight"><pre><span class="nf">*Birthday Countdown*</span>
<span class="nf">As a visitor to the website</span>
<span class="k">I </span><span class="nf">want to see the owner's name</span>
<span class="k">I </span><span class="nf">want to see the owner's birthdate</span>
<span class="k">I </span><span class="nf">want to see how many days until the owner's next birthday</span>
<span class="nf">so I can send birthday greetings</span>
</pre></div><p>It will be a silly home page but it will help us explore the power of Rails.</p>
<h3 id="model-view-controller">Model View Controller</h3>
<p>When you read about basic concepts, you learned that from the perspective of a software architect, Rails is organized to conform to the <a href="http://en.wikipedia.org/wiki/Model%E2%80%93View%E2%80%93Controller">model–view–controller</a> software design pattern. The <span class="caps">MVC</span> design pattern originated in the design of desktop applications. “Model” classes manipulated data; “view” classes created the user interface; and a “controller” class responded to user interaction. This design pattern enforces “separation of concerns” to keep code manageable and organized. The <span class="caps">MVC</span> design pattern is useful for web applications and a central organizing principle for Rails.</p>
<p><img src="https://tutorials.railsapps.org/assets/mvc-stack.png" title="Model–View–Controller in Rails" alt="Model–View–Controller in Rails" /></p>
<p>When the web broswer makes a request, a <em>router</em> component will check the <strong>config/routes.rb</strong> file and determine which <em>controller</em> should handle the request, based on the web address and <span class="caps">HTTP</span> protocol. The controller will obtain any needed data from a <em>model</em>. After obtaining data, the controller will render a response combining data from the model with a <em>view</em> component that provides markup and layout. The response is an <span class="caps">HTML</span> file that the controller has assembled for the browser to display.</p>
<p>The model, view, and controller you create are all just files containing Ruby code. Each file has a certain structure and syntax based on foundation model, view, and controller classes defined in the Rails framework. The model, view, and controller classes you create will <em>inherit</em> behavior from parent classes that are part of the framework, so you will have less code to write yourself.</p>
<p>Looking at the process in more detail, the controller can obtain data from any number of models. In most Rails applications, a model obtains data from a database, though some models obtain data from a remote connection to another server. For example, a User model might retrieve a user name and email address from a local database. With permission, a User model could also obtain a user’s recent tweets from Twitter or a user’s hometown from Facebook.</p>
<p>A controller can have more than one <em>action</em>. For example, a User controller might have actions to display a list of users, or add or delete a user from a list. The <strong>config/routes.rb</strong> file analyzes the web request to determine which controller action is approriate. In the software architects’ terminology, each action is a <em>method</em> of the controller <em>class</em>. In practice, Rails developers try to limit controllers to seven standard actions: <code>index</code>, <code>show</code>, <code>new</code>, <code>edit</code>, <code>create</code>, <code>update</code> and <code>destroy</code> actions. A controller that offers these seven actions is said to be “RESTful” (a term that refers to <em>Representational State Transfer</em>, another software design abstraction).</p>
<p>A view file combines Ruby code with <span class="caps">HTML</span> markup. Typically there will be a view file associated with each controller action. An index view might show a list of users. A “show” view might provide details of a user’s profile. View files look much like ordinary <span class="caps">HTML</span> files but typically contain data in the form of Ruby variables. Often you’ll see Ruby statements such as blocks that iterate through lists to create tables. Following the “separation of concerns” principle, it is considered good practice to limit Ruby code in view files to only displaying data; anything else belongs in the model.</p>
<p>This conceptual overview will be easier to grasp when you actually see the code for a model, view, and controller.</p>
<h3 id="naming-the-model-and-controller">Naming the Model and Controller</h3>
<p>Much of the art of programming lies in choosing suitable names for things. I’ve chosen two names that should be obvious:</p>
<ul>
  <li>HomeController – the file will be <strong>app/controllers/home_controller.rb</strong></li>
  <li>Owner – the file will be <strong>app/models/owner.rb</strong></li>
</ul>
<p>The Home controller will render our home page.</p>
<p>The Owner model will be the source for data about the site owner.</p>
<h3 id="routing">Routing</h3>
<p>We’ll create the route before we implement the model and controller.</p>
<p>Open the file <strong>config/routes.rb</strong>. Replace the contents with this:</p>
<div class="highlight"><pre><span class="ss">LearnRails</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s1">'home#index'</span>
<span class="k">end</span>
</pre></div><p>Any request to the application root (<a href="http://localhost:3000/">http://localhost:3000/</a>) will be directed to the HomeController <code>index</code> action.</p>
<p>Don’t be overly concerned about understanding the exact syntax of the code. It will be become familiar soon and you can always look up the details in the reference documentation, <a href="http://guides.rubyonrails.org/routing.html">RailsGuides: Routing from the Outside In</a>.</p>
<p>You’ve changed a configuration file so you must restart your application server to set the new route. Use Control-C to stop the server and restart it:</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>Visit the page <a href="http://localhost:3000">http://localhost:3000/</a>. You’ll see an error message because we haven’t implemented the controller.</p>
<h3 id="model">Model</h3>
<p>Most Rails models obtain data from a database. When you use a database, you can use the <code>rails generate model</code> command to create a model that inherits from the ActiveRecord class and knows how to connect to a database.</p>
<p>Our tutorial application doesn’t need a database. Instead of inheriting from ActiveRecord, we create a Ruby class with methods that return the owner’s name, birthdate, and days remaining until his birthday. This simple class provides an easy introduction to Ruby code.</p>
<p>Create a file <strong>app/models/owner.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Owner</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="s1">'Foobar Kadigan'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">birthdate</span>
    <span class="n">birthdate</span> <span class="o">=</span> <span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">1990</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">countdown</span>
    <span class="n">today</span> <span class="o">=</span> <span class="no">DateTime</span><span class="o">.</span><span class="n">now</span>
    <span class="n">birthday</span> <span class="o">=</span> <span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">birthdate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">birthdate</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
    <span class="n">countdown</span> <span class="o">=</span> <span class="p">(</span><span class="n">birthday</span> <span class="o">-</span> <span class="n">today</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>This is your first close look at Ruby code. The oddest thing you’ll see is the owner’s name, “Foobar Kadigan.” Everything else will make sense with a bit of explanation.</p>
<p>Keep in mind that we’re using a text file to create an abstraction that we can manipulate in the computer’s memory. Software architects call these abstractions <em>objects</em>. In Ruby, everything we create and manipulate is an <em>object</em>. To distinguish one object from another, we define it as a <em>class</em>, give it a <em>class name</em>, and program behavior in the form of <em>methods</em>.</p>
<p>The first line <code>class Owner</code> defines the class and assigns a name. The last <code>end</code> line completes the class definition.</p>
<p>We define three methods, starting with <code>def</code> (for “method definition”) and ending with <code>end</code>.</p>
<ul>
  <li><code>def name</code> … <code>end</code></li>
  <li><code>def birthdate</code> … <code>end</code></li>
  <li><code>def countdown</code> … <code>end</code></li>
</ul>
<p>Each method contains simple Ruby code that assigns data to a variable. Later, we’ll retreive the data for use in our view file by <em>instantiating</em> the class and <em>calling</em> a method. Ruby makes it easy for a method to <em>return</em> data when called; whatever variable was last assigned will be delivered when the method is called. Don’t be discouraged by the software architects’ terminology; the concepts are simple and we’ll soon see everything in action.</p>
<p>Looking more closely at the Ruby code inside the method definitions, you’ll see Ruby uses the <code>=</code> sign to assign values to a variable. The variable is named on the left side of the equals sign; a value is assigned on the right side. We call the equals sign an <em>assignment operator</em>.</p>
<p>We can assign any value to a variable, including a <em>string</em> (a series of characters that can be a word or name) such as “Foobar Kadigan.” Ruby recognizes a string when characters are enclosed in single or double quotes. Not surprisingly, a variable also can be assigned a number, either a whole number (an <em>integer</em>) or a decimal fraction (a <em>float</em>).</p>
<p>More interestingly, any Ruby object can be assigned to a variable. That helps us “move around” any object very easily, giving us access to the object’s class methods anywhere we use the variable. We can create our own objects, as we have by creating the Owner class. Or we can use the library of objects that are supplied with Ruby. Ruby’s prefabricated objects are defined by the Ruby <span class="caps">API</span> (<em>application programming interface</em>); essentially the <span class="caps">API</span> is a catalog of prebuilt classes that are building blocks for any application. The Rails <span class="caps">API</span> gives us additional classes that are useful for web applications. Learning the syntax of Ruby code gets you started with Ruby programming; getting to know the <span class="caps">API</span> classes and when to use them leads to mastery of Ruby.</p>
<p>The <code>Date</code> object is provided by the Ruby <span class="caps">API</span>. It is described in the <a href="http://apidock.com/ruby/Date">Ruby <span class="caps">API</span> reference documentation</a>. The <code>Date</code> object has a <code>Date.new</code> method which <em>instantiates</em> (creates) a new date when supplied with year, month, and day <em>parameters</em>. You can see this syntax when we assign <code>Date.new(1990, 9, 22)</code> to the <code>birthdate</code> variable.</p>
<p>Looking at the <code>Owner.countdown</code> method, we see a <code>Date.now</code> method that creates an object that represents the current date. When the <code>Date.now</code> method is called, Ruby gets the current date from the computer’s system clock and assigns it to the <code>today</code> variable. We also create a <code>birthday</code> by creating a new date that combines today’s year with the month and day of the <code>birthdate</code>.</p>
<p>If we were to look at the code for the <code>Date</code> object (it’s buried deep in the GitHub repository for the Ruby language), we’d see it is far more complex than the simple Owner class we’ve just defined. Among other behaviors, the <code>Date</code> class can perform complex calendar arithmetic. The variables <code>birthdate</code> and <code>today</code> are <em>instances</em> of the <code>Date</code> class. If we subtract <code>today</code> from <code>birthdate</code>, the <code>Date</code> class calculates the number of days remaining until the owner’s birthday. The result might be fractional so we use the utility method <code>to_i</code> to convert the result to a whole number (integer) before assigning it to the <code>countdown</code> variable.</p>
<p>This is an example of the power of progamming in Ruby. Notice that I needed eleven paragraphs and over 600 words to explain nine short lines of code. We used only six Ruby abstractions (class definition, method definition, variable assignment, String class, Date class, and integer conversion) but they represent thousands of lines of code in the Ruby language implementation. With knowledge of Ruby syntax and the Ruby <span class="caps">API</span>, a few short lines of code in a text file gives us amazing ability.</p>
<p>If you want more help with programming concepts and terminology, I recommend the book <a href="http://pine.fm/LearnToProgram/">Learn to Program</a> by Chris Pine.</p>
<p>Let’s see how we can put this functionality to use on a web page.</p>
<h3 id="view">View</h3>
<p>The Owner model provides the data we want to see on the Home page.</p>
<p>We’ll create the markup and layout in a View file and add variables that present the data.</p>
<p>View files go in folders in the <strong>app/views/</strong> directory. In a typical application, one controller can render multiple views, so we make a folder to match each controller. You can make a new folder using your file browser or text editor. Or use the Unix <code>mkdir</code> command:</p>
<div class="highlight"><pre><span class="gp">$</span> mkdir app/views/home
</pre></div><p>Create a file <strong>app/views/home/index.html.erb</strong>:</p>
<div class="highlight"><pre><span class="x">&lt;h3&gt;Home&lt;/h3&gt;</span>
<span class="x">&lt;p&gt;Welcome to the home of </span><span class="cp">&lt;%=</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">.&lt;/p&gt;</span>
<span class="x">&lt;p&gt;I was born on </span><span class="cp">&lt;%=</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">birthdate</span> <span class="cp">%&gt;</span><span class="x">.&lt;/p&gt;</span>
<span class="x">&lt;p&gt;Only </span><span class="cp">&lt;%=</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">countdown</span> <span class="cp">%&gt;</span><span class="x"> days until my birthday!&lt;/p&gt;</span>
</pre></div><p>We’ve created a <strong>home/</strong> folder within the <strong>app/views/</strong> directory. This directory is for any views associated with the Home controller. We have only a single <code>index</code> view but if had more views, they’d go in the <strong>app/views/home/</strong> folder.</p>
<p>By convention, if there’s only one default page in a directory, it’s named <strong>index.html</strong>. We name our View file <strong>index.html.erb</strong>, adding the <strong>.erb</strong> file extension so that Rails will use the <span class="caps">ERB</span> templating engine to interpret the markup.</p>
<p>There are several syntaxes that can be used for a view file. In this tutorial, we’ll use the <span class="caps">ERB</span> syntax that is most commonly used by beginners. Some experienced developers prefer to add gems that provide the <a href="http://railsapps.github.io/rails-haml.html">Haml</a> and <a href="http://slim-lang.com/">Slim</a> templating engines. As you might guess, a View that uses the Haml templating syntax would be named <strong>index.html.haml</strong>.</p>
<p>Our <span class="caps">HTML</span> markup is minimal, using only the <code>&lt;h3&gt;</code> and <code>&lt;p&gt;</code> tags. The only <span class="caps">ERB</span> markup we add are the <code>&lt;%= ... %&gt;</code> delimiters. This markup allows us to insert Ruby code which will be replaced by the result of evaluating the code. In other words, <code>&lt;%= @owner.name %&gt;</code> will appear on the page as Foobar Kadigan.</p>
<p>You may have noticed that we refer to the Owner model with the variable <code>@owner</code>. It will be clear when we create the Home controller why we use this syntax (a variable name that begins with the @ character is called an <em>instance variable</em>).</p>
<p>Obviously, if all we wanted to do was include the owner’s name on the page, it would be easier to simply write the text. The Rails implementation becomes useful if the name is retrieved from a database or created programmatically.</p>
<p>We can better see the usefulness of the Owner model when we look at the use of <code>&lt;%= @owner.countdown %&gt;</code>. There is no way to display a calculation using only static <span class="caps">HTML</span>, so Rails gives us a way to display the birthday countdown calculation.</p>
<p>If you’re a programmer, you might wonder why we only output the variable on the page. Since we can use <span class="caps">ERB</span> to embed any Ruby code, we could perform the calculation right on the page by embedding <code>&lt;%= (Date.new(today.year, @owner.birthdate.month, @owner.birthdate.day) - DateTime.now).to_i %&gt;</code>. If you’ve used JavaScript or <span class="caps">PHP</span>, you may have performed calculations like this, right on the page. Rails would allow us to do so, but the practice violates the “separation of concerns” principle that encourages us to perform complex calculations in the model and only display data in the view.</p>
<p>Before we can display the Home page, we need to create the Home controller.</p>
<h3 id="controller">Controller</h3>
<p>The Home controller is the glue that binds the Owner model with the HomeController#Index view.</p>
<p><em>Note:</em> When we refer to a controller action, we use the notation “HomeController#Index,” joining the controller class name with the action (method) that renders a page. The “#” character is only a documentation convention.</p>
<p><em>Note:</em> <code>HomeController</code> will be the class name and <strong>home_controller.rb</strong> will be the filename. The class name is written in <a href="http://en.wikipedia.org/wiki/CamelCase">camelCase</a> (with a hump in the middle, like a camel) so we can combine two words without a space. Operating systems don’t like filenames to include spaces and some operating systems don’t like capital letters in filenames, so we create a filename that combines two words with an underscore.</p>
<p>Create a file <strong>app/controllers/home_controller.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">HomeController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@owner</span> <span class="o">=</span> <span class="no">Owner</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>We define the class and name it <code>class HomeController</code>, inheriting behavior from the ApplicationController class which is defined in the Rails <span class="caps">API</span>.</p>
<p>We only need to define the <code>index</code> method. We create an <em>instance variable</em> named <code>@owner</code> and assign an instance of the Owner model. Any instance variables (variables named with the @ character) will be available in the corresponding view file.</p>
<p>Controller actions render a template in the <strong>app/views</strong> directory corresponding to the name of the controller and action after executing code in the action. Here the index action of the HomeController renders the template <strong>app/views/home/index.html.erb</strong> after creating the <code>@owner</code> instance variable.</p>
<p>The <code>index</code> method is deceptively simple. Hidden behavior inherited from the ApplicationController does all the work of rendering the view. We can make the hidden code explicit if we wish to. It would look something like this:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">HomeController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@owner</span> <span class="o">=</span> <span class="no">Owner</span><span class="o">.</span><span class="n">new</span>
    <span class="n">render</span> <span class="s1">'home/index'</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>Revealing the hidden code, we see that invoking the <code>index</code> method calls a <code>render</code> method supplied by the ApplicationController parent class. The <code>render</code> method searches in the <strong>app/views/home</strong> directory for a view file named <strong>index</strong> (the file extension <strong>.html.erb</strong> is assumed by default). The code underlying the <code>render</code> method is complex. Fortunately, all we need to do is define the method and instantiate the Owner model. Rails takes care of the rest.</p>
<h3 id="test-the-application-2">Test the Application</h3>
<p>We’ve created a model, view, and controller. Now let’s run the application.</p>
<p>Enter the command:</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>. You’ll see our new home page.</p>
<p><img src="https://tutorials.railsapps.org/assets/learn-rails-42-home.png" title="Home Page" alt="Home Page" /></p>
<p>It’s a very simple web page but it uses Ruby to calculate the countdown to the birthday. And the underlying code conforms to the conventions and stucture of Rails.</p>
<h3 id="git-3">Git</h3>
<p>Let’s commit our changes to the Git repository.</p>
<div class="highlight"><pre><span class="gp">$</span> git add -A
<span class="gp">$</span> git commit -m <span class="s2">"dynamic home page"</span>
<span class="gp">$</span> git push origin master
</pre></div><p>Now let’s take a look at troubleshooting.</p>
</section>
<section class='chapter' id='troubleshooting'><h2>Troubleshooting</h2>
<p>In the last chapter, we built a dynamic home page and learned about the model–view–controller architecture of Rails. There was a lot to learn, but the code was simple, and I hope it worked the first time you tried it.</p>
<p>Before we do any more work on our tutorial application, we need to learn about troubleshooting and debugging. As a software developer, you’ll spend a lot of time with code that doesn’t work. You’ll need tools and techniques to diagnose problems.</p>
<h3 id="git-4">Git</h3>
<p>In this chapter we’ll make changes to the application just for troubleshooting.</p>
<p>Before you get started, make sure the work you’ve done is commited to your git repository. Use the <code>git status</code> command to check:</p>
<div class="highlight"><pre><span class="gp">$</span> git status
</pre></div><p>You should see:</p>
<div class="highlight"><pre><span class="gp">#</span> On branch master
<span class="go">nothing to commit (working directory clean)</span>
</pre></div><p>If <code>git status</code> reports any uncommited changes, go back to the last step in the previous chapter and commit your work to the git repository before continuing. At the end of this chapter, we’re going to throw away the work we’ve done in this chapter. We don’t want to accidentally throw away work from the previous chapter so make sure it is commited to the repository.</p>
<h3 id="interactive-ruby-shell">Interactive Ruby Shell</h3>
<p>There will be times when you want to try a snippet of Ruby code just to see if it works. Your tool will be <span class="caps">IRB</span>, the Interactive Ruby Shell.</p>
<p><span class="caps">IRB</span> is a Ruby interpreter that runs from the command line. It executes any Ruby code and provides an immediate response, allowing you to experiment in real-time.</p>
<p>Let’s try it.</p>
<div class="highlight"><pre><span class="gp">$</span> irb
<span class="go">2.0.0p0 :001 &gt;</span>
</pre></div><p>The command <code>irb</code> launches the program and displays a prompt that show your Ruby version, a line number, and an arrow. If you enter a valid Ruby expression, the interpreter will display the result of evaluting the expression.</p>
<p>Try simple arithmetic:</p>
<div class="highlight"><pre><span class="go">2.0.0p0 :001 &gt; n = 2</span>
<span class="go"> =&gt; 2</span>
<span class="go">2.0.0p0 :002 &gt; n + 2</span>
<span class="go"> =&gt; 4</span>
</pre></div><p>Wow! You are using your computer for simple math. Maybe you can delete the calculator app from your phone.</p>
<p><span class="caps">IRB</span> will evaluate any Ruby expression and helps you quickly determine if syntax and logic is correct.</p>
<p>It can be very frustrating to find you are stuck inside <span class="caps">IRB</span>. Unlike most shell commands, you can’t quit with Control-C. Enter Control-D or type <code>exit</code> to quit <span class="caps">IRB</span>:</p>
<div class="highlight"><pre><span class="gp">$</span> irb
<span class="go">2.0.0p0 :001 &gt; exit</span>
</pre></div><p>Here’s a fun way to learn about <span class="caps">IRB</span>:</p>
<ul>
  <li><a href="http://mislav.uniqpath.com/poignant-guide/book/expansion-pak-1.html" title="with a Basic Introduction to IRB">Why’s (Poignant) Guide to Ruby</a></li>
</ul>
<p>Here’s a boring way to learn about <span class="caps">IRB</span>:</p>
<ul>
  <li><a href="http://ruby-doc.org/docs/ProgrammingRuby/html/irb.html">The Pragmatic Programmer’s Guide</a></li>
</ul>
<h3 id="rails-console">Rails Console</h3>
<p><span class="caps">IRB</span> only evaluates expressions that are defined in the Ruby <span class="caps">API</span>. <span class="caps">IRB</span> doesn’t know Rails.</p>
<p>It’d be great to have a tool like <span class="caps">IRB</span> that evaluates any expression defined in the Rails <span class="caps">API</span>. The tool exists; it’s called the Rails console. It is particularly useful because it loads your entire Rails application. Your application will be running as if the application was waiting to respond to a web request. Then you can expose behavior of any pieces of the web application.</p>
<div class="highlight"><pre><span class="gp">$</span> rails console
<span class="go">Loading development environment (Rails 4.0.0.rc1)</span>
<span class="go">2.0.0p0 :001 &gt;</span>
</pre></div><p>The Rails console behaves like <span class="caps">IRB</span> but loads your Rails development environment. The prompt shows it is ready to evaluate an expression.</p>
<p>Let’s use the Rails console to examine our Owner model:</p>
<div class="highlight"><pre><span class="go">2.0.0p0 :001 &gt; myboss = Owner.new</span>
<span class="go"> =&gt; #&lt;Owner:0x007fe885163aa8&gt;</span>
</pre></div><p>We’ve created a variable named <code>myboss</code> and created a new instance of the Owner class. The Rails console responds by displaying the unique identifier it uses to track the object. The identifier is not particularly useful, except to show that something was created.</p>
<p>If you’re unsure about the difference between an <em>instance</em> and a <em>class definition</em>, we’ve just seen that we can make one or more instances of an object by calling the <code>Owner.new</code> method. When we start the Rails console, the <code>Owner</code> class definition is loaded into the computer’s working memory (our development environment) from the class definition file on disk. Then we can use the <code>Owner.new</code> method to make one or more instances of the <code>Owner</code> class.</p>
<p>Let’s assign the name of our boss to a variable called <code>name</code>:</p>
<div class="highlight"><pre><span class="go">2.0.0p0 :002 &gt; name = myboss.name</span>
<span class="go"> =&gt; "Foobar Kadigan"</span>
</pre></div><p>Our variable <code>myboss</code> is an instance of an <code>Owner</code> class so it responds to the method  <code>Owner.name</code> by returning the owner’s name.</p>
<p>The boss likes to be treated with respect so we’ll perform some <em>string manipulation</em>:</p>
<div class="highlight"><pre><span class="go">2.0.0p0 :003 &gt; name = 'Mr. ' + name</span>
<span class="go"> =&gt; "Mr. Foobar Kadigan"</span>
</pre></div><p>We’re done for now. When we quit the Rails console or shut down the computer the <code>Owner</code> class definition remains stored on disk but the instances disappear. The bits that were organized to create the variable <code>name</code> will evaporate (or whatever happens to unused bits).</p>
<p>Enter Control-D or type <code>exit</code> to quit the Rails console.</p>
<p>You won’t use the Rails console often but it is important to know it is available.</p>
<h3 id="rails-logger">Rails Logger</h3>
<p>As you know, a Rails application sends output to the browser that makes a web request. On every request, it also sends diagnostic output to the <em>server log file</em>. Depending on whether the application is running in the development environment or in production, the log file is here:</p>
<ul>
  <li><strong>log/development.log</strong></li>
  <li><strong>log/production.log</strong></li>
</ul>
<p>In development, everything written to the log file appears in the console window after you run the <code>rails server</code> command. Scrolling the console window is a good way to see diagnostics for every request.</p>
<p>Here’s what you see when you visit the application home page:</p>
<div class="highlight"><pre><span class="go">Started GET "/" for 127.0.0.1 at ...</span>
<span class="go">Processing by HomeController#index as HTML</span>
<span class="go">  Rendered home/index.html.erb within layouts/application (48.8ms)</span>
<span class="go">Completed 200 OK in 233ms (Views: 211.5ms | ActiveRecord: 0.0ms)</span>
</pre></div><p>Here’s the best part. You can add your own messages to the log output by using the Rails logger. Let’s try it out.</p>
<p>Modify the file <strong>app/controllers/home_controller.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">HomeController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: entering index method'</span>
    <span class="vi">@owner</span> <span class="o">=</span> <span class="no">Owner</span><span class="o">.</span><span class="n">new</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: Owner name is '</span> <span class="o">+</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">name</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>Visit the home page again and you’ll see this in the console output:</p>
<div class="highlight"><pre><span class="go">Started GET "/" for 127.0.0.1 at ...</span>
<span class="go">Processing by HomeController#index as HTML</span>
<span class="go">DEBUG: entering index method</span>
<span class="go">DEBUG: Owner name is Foobar Kadigan</span>
<span class="go">  Rendered home/index.html.erb within layouts/application (0.2ms)</span>
<span class="go">Completed 200 OK in 8ms (Views: 4.6ms | ActiveRecord: 0.0ms)</span>
</pre></div><p>If you really needed to do so, you could add a logger statement at every step in the application. You could see how the application behaves, step by step. And you could “print” the value of every variable at every step. You’ll never need diagnostics at this level of detail in Rails, but the logger is extremely useful when you are trying to understand unexpected behavior.</p>
<p>Let’s add logger statements to the <code>Owner</code> model. Modify the file <strong>app/models/owner.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Owner</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="s2">"Foobar Kadigan"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">birthdate</span>
    <span class="n">birthdate</span> <span class="o">=</span> <span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">1990</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">countdown</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: entering Owner countdown method'</span>
    <span class="n">today</span> <span class="o">=</span> <span class="no">DateTime</span><span class="o">.</span><span class="n">now</span>
    <span class="n">birthday</span> <span class="o">=</span> <span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">birthdate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">birthdate</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
    <span class="n">countdown</span> <span class="o">=</span> <span class="p">(</span><span class="n">birthday</span> <span class="o">-</span> <span class="n">today</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>We added the <code>Rails.logger.debug</code> statement to the <code>Owner.countdown</code> method.</p>
<p>Visit the home page and here’s what you’ll see in the console output:</p>
<div class="highlight"><pre><span class="go">Started GET "/" for 127.0.0.1 at ...</span>
<span class="go">Processing by HomeController#index as HTML</span>
<span class="go">DEBUG: entering index method</span>
<span class="go">DEBUG: Owner name is Foobar Kadigan</span>
<span class="go">DEBUG: entering Owner countdown method</span>
<span class="go">  Rendered home/index.html.erb within layouts/application (0.3ms)</span>
<span class="go">Completed 200 OK in 7ms (Views: 4.2ms | ActiveRecord: 0.0ms)</span>
</pre></div><p>You’ll often need to “get inside” the model or controller to see what’s happening. The Rails logger is the best tool for the job.</p>
<p>Here are some tricks for the Rails logger.</p>
<p>In a controller, you can use the method <code>logger</code> on its own. In a model, you have to write <code>Rails.logger</code> (both class and method).</p>
<p>You can use any of the methods <code>logger.debug</code>, <code>logger.info</code>, <code>logger.warn</code>, <code>logger.error</code>, or <code>logger.fatal</code> to write log messages. By default, you’ll see any of these messages in the development log. Log messages written with the <code>logger.debug</code> method will not be recorded in a production log file.</p>
<p>If you want your log messages to stand out, you can add formating code for color:</p>
<div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[1;34;40m[DEBUG]</span><span class="se">\033</span><span class="s2">[0m "</span> <span class="o">+</span> <span class="s1">'will appear in bold blue'</span>
</pre></div><p>For more about the Rails logger, see the <a href="http://guides.rubyonrails.org/debugging_rails_applications.html">RailsGuide: Debugging Rails Applications</a>.</p>
<h3 id="the-stack-trace">The Stack Trace</h3>
<p>The Rails logger is extremely useful if you want to insert messages to show program flow or display variables. But there will be times when program flow halts and the console displays a <em>stack trace</em>.</p>
<p>Let’s deliberately create an error condition and see an error page and stack trace.</p>
<p>Modify the file <strong>app/controllers/home_controller.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">HomeController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: entering index method'</span>
    <span class="vi">@owner</span> <span class="o">=</span> <span class="no">Owner</span><span class="o">.</span><span class="n">new</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: Owner name is '</span> <span class="o">+</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">name</span>
    <span class="no">DISASTER</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>Visit the home page and you’ll see an error page:</p>
<p><img src="https://tutorials.railsapps.org/assets/learn-rails-43-error.png" title="Error Page" alt="Error Page" /></p>
<p>You’ll see this error page because we’ve installed the <a href="https://github.com/charliesome/better_errors">better_errors</a> gem. Without the better_errors gem, you’d see the default Rails error page which is quite similar.</p>
<p>In the console log, you’ll many lines from a stack trace that shows everything that happens before Rails encounters the error.</p>
<div class="highlight"><pre><span class="go">Started GET "/" for 127.0.0.1 at ...</span>
<span class="go">Processing by HomeController#index as HTML</span>
<span class="go">DEBUG: entering index method</span>
<span class="go">DEBUG: Owner name is Foobar Kadigan</span>
<span class="go">Completed 500 Internal Server Error in 10ms</span>

<span class="go">NameError - uninitialized constant HomeController::DISASTER:</span>
<span class="go">  app/controllers/home_controller.rb:7:in `index'</span>
<span class="go">  .</span>
<span class="go">  .</span>
<span class="go">  .</span>
</pre></div><p>To save space, I’m only showing the first line of the stack trace. I’ve eliminated about sixty lines from the stack trace.</p>
<p>Don’t feel bad if your reaction to a stack trace is an immediate, “<span class="caps">TMI</span>!” Indeed, it is usually Too Much Information. There are times when it pays to carefully read through the stack trace line by line, but most often, only the first line of the stack trace is important.</p>
<p>In this case, both the error page and the first line of the stack trace show the application failed (“barfed”) when it encountered an “uninitialized constant” at line 7 of the <strong>app/controllers/home_controller.rb</strong> file in the <code>index</code> method. It’s easy to find line 7 in the file and see that is exactly where we added a string that Rails doesn’t understand.</p>
<p>The point of this exercise is to encourage you to read the first line of the stack trace and use it to diagnose the problem. I’m always surprised how many developers ignore the stack trace, probably because it looks intimidating.</p>
<h3 id="raising-an-exception">Raising an Exception</h3>
<p>As you just saw, you can purposefully break your application by adding characters that Rails doesn’t understand. However, there is a better way to force your program to halt, called <em>raising an exception</em>.</p>
<p>Let’s try it. Modify the file <strong>app/controllers/home_controller.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">HomeController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: entering index method'</span>
    <span class="vi">@owner</span> <span class="o">=</span> <span class="no">Owner</span><span class="o">.</span><span class="n">new</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: Owner name is '</span> <span class="o">+</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">name</span>
    <span class="k">raise</span> <span class="s1">'Deliberate Failure'</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>You can throw an error by using the <code>raise</code> keyword from the Ruby <span class="caps">API</span>. You can provide any error message you’d like in quotes following <code>raise</code>.</p>
<p>Here’s the console log after you try to visit the home page:</p>
<div class="highlight"><pre><span class="go">Started GET "/" for 127.0.0.1 at ...</span>
<span class="go">Processing by HomeController#index as HTML</span>
<span class="go">DEBUG: entering index method</span>
<span class="go">DEBUG: Owner name is Foobar Kadigan</span>
<span class="go">Completed 500 Internal Server Error in 22ms</span>

<span class="go">RuntimeError - Deliberate Failure:</span>
<span class="go">  app/controllers/home_controller.rb:7:in `index'</span>
<span class="go">  .</span>
<span class="go">  .</span>
<span class="go">  .</span>
</pre></div><p>Before we continue, let’s remove the deliberate failure. Modify the file <strong>app/controllers/home_controller.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">HomeController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: entering index method'</span>
    <span class="vi">@owner</span> <span class="o">=</span> <span class="no">Owner</span><span class="o">.</span><span class="n">new</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: Owner name is '</span> <span class="o">+</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">name</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>Rails and the Ruby <span class="caps">API</span> provide a rich library of classes and methods to raise and handle exceptions. For example, you might want to display an error if Foobar Kadigan’s birthdate is in the future. Rails gives you various exception handlers to display errors in production so users will see a helpful web page explaining the error.</p>
<h3 id="investigating-the-request-response-cycle">Investigating the Request Response Cycle</h3>
<p>We’ll conclude our introduction to troubleshooting by looking at the tools we have available for investigating the entire request-response cycle.</p>
<p>Everything that happens in a web application takes place within the program flow of the request-response cycle. If a web application is not responding to a request, it sits idle. Let’s take a look at the request-response cycle.</p>
<p><img src="https://tutorials.railsapps.org/assets/mvc-flow.png" title="Model–View–Controller in Rails" alt="Model–View–Controller in Rails" /></p>
<h4 id="the-browser-side">The Browser Side</h4>
<p>Developers use various web browsers during development. Google Chrome is the most popular but developers also use Mozilla Firefox and Apple Safari. I’ll provide instructions for Chrome so, even if you prefer one of the others, try this in Chrome.</p>
<p>In Chrome on Mac OS X, press Command-Option-I to open the <em>Developer Tools View</em> at the bottom of the browser window. Alternatively, you can find the menu item under View/Developer/Developer Tools. The Developer Tools View is your primary diagnostic tool for front-end (browser-based) development, including <span class="caps">CSS</span> and JavaScript.</p>
<p>We’ll use the diagnostic tools built into your web browser to see the actual data sent as a request and received as a response.</p>
<p>Select the Network tab in the Developer Tools View.</p>
<p>Begin the request-response cycle by visiting the home page at <a href="http://localhost:3000/">http://localhost:3000/</a>.</p>
<p>In the Developer Tools View, you’ll see a list of files received by the browser from the web server. There are three types of files: <span class="caps">HTML</span> (labelled “localhost”), <span class="caps">CSS</span>, and JavaScript. These are the files that the browser evaulates to display a web page.</p>
<p>Click the “localhost” file icon. Then click the tab “Headers.” The diagnostic window shows the entire request sent to the server and the entire response received by the browser.</p>
<p>The request is composed of:</p>
<ul>
  <li>request <span class="caps">URL</span> (http://localhost:3000/)</li>
  <li>request method (<span class="caps">GET</span>)</li>
  <li>request headers (including cookies and User Agent identifer)</li>
</ul>
<p>The response is composed of</p>
<ul>
  <li>status code (200 OK or 304 Not Modified)</li>
  <li>response headers (including date/time and server identifier)</li>
  <li><span class="caps">HTML</span></li>
</ul>
<p>You can see the <span class="caps">HTML</span> sent to the browser by clicking the Preview or Response tabs in the diagnostic view.</p>
<p>Here’s the point of the exercise: The browser’s diagnostic view shows all the data exchanged between the browser and server. You’re looking at everything that passes through the plumbing.</p>
<h4 id="the-server-side">The Server Side</h4>
<p>The browser’s diagnostic view doesn’t show you want happens on the server. For that, go to the server logs or the console window.</p>
<div class="highlight"><pre><span class="go">Started GET "/" for 127.0.0.1 at ...</span>
<span class="go">Processing by HomeController#index as HTML</span>
<span class="go">DEBUG: entering index method</span>
<span class="go">DEBUG: Owner name is Foobar Kadigan</span>
<span class="go">DEBUG: entering Owner countdown method</span>
<span class="go">  Rendered home/index.html.erb within layouts/application (0.3ms)</span>
<span class="go">Completed 200 OK in 5ms (Views: 4.2ms | ActiveRecord: 0.0ms)</span>
<span class="go">Started GET "/assets/jquery.js?body=1" for 127.0.0.1 at ...</span>
<span class="go">Started GET "/assets/application.js?body=1" for 127.0.0.1 at ...</span>
<span class="go">Started GET "/assets/turbolinks.js?body=1" for 127.0.0.1 at ...</span>
<span class="go">Started GET "/assets/application.css?body=1" for 127.0.0.1 at ...</span>
<span class="go">Started GET "/assets/jquery_ujs.js?body=1" for 127.0.0.1 at ...</span>
</pre></div><p>Notice how the diagnostic messages in the console window match the headers in the browser diagnostic view. The broswer’s “Request Method:<span class="caps">GET</span>” matches the server’s “Started <span class="caps">GET</span>.” The broswer’s “Request <span class="caps">URL</span>:http://localhost:3000/” matches the server’s “‘/’ for 127.0.0.1” (localhost is at IP address 127.0.0.1). The browser’s “Status Code: 200” matches the server’s “Completed 200 OK” (you might have to clear the browser’s cache if the browser is showing “304 Not Modified”).</p>
<p>Of course the console log shows what happens on the server side. “Processing by HomeController#index” shows the program flow entering the controller. Our debug statements show we enter the index method and reveal the value of the Owner name. The next debug statement reveals the flow has passed to the Owner model. A diagnostic message shows the controller has rendered the <strong>home/index.html.erb</strong> view file. Finally, the “Completed 200 OK” message indicates the response has been sent to the browser, followed by a sequence of <span class="caps">CSS</span> and JavaScript files.</p>
<p>It’s wonky but we’re able to trace the entire request-response cycle, including the server’s traverse of the model-view-controller architecture.</p>
<h3 id="git-5">Git</h3>
<p>There’s no need to save any of the changes we made for troubleshooting.</p>
<p>You could go to each file and carefully remove the debugging code you added. But there’s an easier way.</p>
<p>Check which files have changed:</p>
<div class="highlight"><pre><span class="gp">$</span> git status
<span class="gp">#</span> Changes not staged <span class="k">for </span>commit:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">"git add &lt;file&gt;..."</span> to update what will be committed<span class="o">)</span>
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">"git checkout -- &lt;file&gt;..."</span> to discard changes in working directory<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span> modified:   app/controllers/home_controller.rb
<span class="gp">#</span> modified:   app/models/owner.rb
<span class="gp">#</span>
<span class="go">no changes added to commit (use "git add" and/or "git commit -a")</span>
</pre></div><p>Use Git to revert your project to the most recent commit:</p>
<div class="highlight"><pre><span class="gp">$</span> git reset --hard HEAD
</pre></div><p>The Git command <code>git reset --hard HEAD</code> discards any changes you’ve made since the most recent commit. Check the status to make sure:</p>
<p><code>@</code> console<br />
$ git status</p>
<ol>
  <li>On branch master<br />
nothing to commit (working directory clean)<br />
@@</li>
</ol>
<p>We’ve cleaned up after our troubleshooting exercise.</p>
</section>
<section class='chapter' id='just-enough-ruby'><h2>Just Enough Ruby</h2>
<h3 id="learn-to-program">Learn to Program</h3>
<p>Book (free): <a href="http://pine.fm/LearnToProgram/">Learn To Program</a> by Chris Pine<br />
Book ($18.50 ebook): <a href="http://pragprog.com/book/ltp2/learn-to-program">Learn To Program</a> by Chris Pine</p>
<h3 id="do-you-need-to-know-ruby-to-learn-rails">Do You Need to Know Ruby to Learn Rails?</h3>
<p>Tutorial: <a href="http://rubymonk.com/">RubyMonk</a> – free browser-based interactive tutorial<br />
Tutorial: <a href="http://tryruby.org/levels/1/challenges/0">Try Ruby</a> – free browser-based interactive tutorial<br />
Tutorial: <a href="http://rubykoans.com/">Ruby Koans</a> – free browser-based interactive exercises<br />
Videos: <a href="https://github.com/JoshCheek/ruby-kickstart">Ruby Kickstart</a> – free</p>
<h3 id="ruby-basics">Ruby Basics</h3>
<p>Tutorial: <a href="http://curriculum.railsbridge.org/ruby/ruby">RailsBridge Ruby</a><br />
Reference: <a href="http://pragtob.github.io/rails-beginner-cheatsheet/index.html">Rails Beginner Cheat Sheet</a><br />
Reference: <a href="http://apidock.com/ruby">Ruby <span class="caps">API</span> docs with usage notes</a></p>
</section>
<section class='chapter' id='layout-and-views'><h2>Layout and Views</h2>
<p>In previous chapters we created a dynamic home page and learned techniques for troubleshooting.</p>
<p>In this chapter we’ll look closely at view files, particularly the application layout, so we can organize the design of our web pages. In the next chapter we’ll learn how to add <span class="caps">CSS</span> stylesheets to complete the graphic design of our web pages.</p>
<h3 id="application-layout">Application Layout</h3>
<p>We’ve already created the view file for our home page.</p>
<p>The file <strong>app/views/home/index.html.erb</strong> looks like this:</p>
<div class="highlight"><pre><span class="x">&lt;h3&gt;Home&lt;/h3&gt;</span>
<span class="x">&lt;p&gt;Welcome to the home of </span><span class="cp">&lt;%=</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">.&lt;/p&gt;</span>
<span class="x">&lt;p&gt;I was born on </span><span class="cp">&lt;%=</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">birthdate</span> <span class="cp">%&gt;</span><span class="x">.&lt;/p&gt;</span>
<span class="x">&lt;p&gt;Only </span><span class="cp">&lt;%=</span> <span class="vi">@owner</span><span class="o">.</span><span class="n">countdown</span> <span class="cp">%&gt;</span><span class="x"> days until my birthday!&lt;/p&gt;</span>
</pre></div><p>The first line in the file contains an <span class="caps">HTML</span> heading tag, <code>&lt;h3&gt;</code>, with headline text, “Home.”</p>
<p>When you used the browser diagnostic view to see the <span class="caps">HTML</span> file received by the server, you saw this:</p>
<div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>LearnRails<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">data-turbolinks-track=</span><span class="s">"true"</span> <span class="na">href=</span><span class="s">"/assets/application.css?body=1"</span> <span class="na">media=</span><span class="s">"all"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;script </span><span class="na">data-turbolinks-track=</span><span class="s">"true"</span> <span class="na">src=</span><span class="s">"/assets/jquery.js?body=1"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">data-turbolinks-track=</span><span class="s">"true"</span> <span class="na">src=</span><span class="s">"/assets/jquery_ujs.js?body=1"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">data-turbolinks-track=</span><span class="s">"true"</span> <span class="na">src=</span><span class="s">"/assets/turbolinks.js?body=1"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">data-turbolinks-track=</span><span class="s">"true"</span> <span class="na">src=</span><span class="s">"/assets/application.js?body=1"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">content=</span><span class="s">"authenticity_token"</span> <span class="na">name=</span><span class="s">"csrf-param"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">content=</span><span class="s">"NRPrgfuj5GAyylNpNxQaMHDypcOsu6dmh5DT1yET6hQ="</span> <span class="na">name=</span><span class="s">"csrf-token"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;h3&gt;</span>Home<span class="nt">&lt;/h3&gt;</span>
<span class="nt">&lt;p&gt;</span>Welcome to the home of Foobar Kadigan.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>I was born on 1990-09-22.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>Only 126 days until my birthday!<span class="nt">&lt;/p&gt;</span>


<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div><p>The <span class="caps">HTML</span> file is more than twice the size of the view file. Where did all the extra <span class="caps">HTML</span> come from?</p>
<p>If you’ve built websites before, you’ll recognize the <span class="caps">HTML</span> file conforms to the HTML5 specification, with a <code>DOCTYPE</code>, <code>&lt;head&gt;</code> and <code>&lt;body&gt;</code> tags, and miscellaneous tags in the <span class="caps">HEAD</span> section, including a title and various <span class="caps">CSS</span> and JavaScript assets.</p>
<p>The additional tags come from the default application layout file.</p>
<p>Open the file <strong>app/views/layouts/application.html.erb</strong>:</p>
<div class="highlight"><pre><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">  &lt;title&gt;LearnRails&lt;/title&gt;</span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="ss">media</span><span class="p">:</span> <span class="s2">"all"</span><span class="p">,</span> <span class="s2">"data-turbolinks-track"</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="s2">"data-turbolinks-track"</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>

<span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div><p>You’ll see that Rails has combined the Home#Index view with the default application layout file.</p>
<p>Static pages delivered from the <strong>public</strong> folder do not use the default application layout. But every page generated by the model-view-controller architecture in the <strong>app/</strong> folder incorporates the default application layout, unless you specify otherwise.</p>
<p>The default application layout is where you put <span class="caps">HTML</span> that you want to include on every page of your website.</p>
<p>Remember when we looked at the hidden code in the controller that renders a view? The controller uses the <code>render</code> method to combine the view file with the application layout:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">HomeController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@owner</span> <span class="o">=</span> <span class="no">Owner</span><span class="o">.</span><span class="n">new</span>
    <span class="n">render</span> <span class="s1">'home/index'</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>Here the <code>render</code> method combines the <strong>app/views/home/index.html.erb</strong> view file with the <strong>app/views/layouts/application.html.erb</strong>: application layout.</p>
<p>You could tell the controller to render the view without any application layout:</p>
<div class="highlight"><pre><span class="n">render</span> <span class="s1">'home/index'</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</pre></div><p>Or you could specify an alternative layout file, for example <strong>app/views/layouts/special.html.erb</strong>:</p>
<div class="highlight"><pre><span class="n">render</span> <span class="s1">'home/index'</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="s1">'special'</span>
</pre></div><p>An alternative layout can be useful for special categories of pages, such as administrative pages or landing pages.</p>
<p>The reference <a href="http://guides.rubyonrails.org/layouts_and_rendering.html">RailsGuides: Layouts and Rendering in Rails</a> explains more about using alternative layouts.</p>
<h3 id="yield">Yield</h3>
<p>How does the <code>render</code> method insert the view file in the application layout?</p>
<p>Notice that the default application layout contains the Ruby keyword <code>yield</code>.</p>
<p>The <code>yield</code> keyword is replaced with a view file that is specific to the controller and action, in this case, the <strong>app/views/home/index.html.erb</strong> view file.</p>
<p>The content from the view is inserted where you place the <code>yield</code> keyword.</p>
<p>Rails provides other ways to insert content into a layout file. For example, the <code>content_for</code> method is helpful when your layout contains distinct regions such as sidebars and footers that should get their own blocks of content.</p>
<p>For example, you could create an application layout that includes a sidebar. This is just an example, so don’t add it to the application you are building:</p>
<div class="highlight"><pre><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">  &lt;title&gt;LearnRails&lt;/title&gt;</span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="ss">media</span><span class="p">:</span> <span class="s2">"all"</span><span class="p">,</span> <span class="s2">"data-turbolinks-track"</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="s2">"data-turbolinks-track"</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">  &lt;div class="main"&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/div&gt;</span>
<span class="x">  &lt;div class="sidebar"&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="ss">:sidebar</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/div&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div><p>This view file provides both the main content and a sidebar:</p>
<div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">content_for</span> <span class="ss">:sidebar</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;h3&gt;Contact Info&lt;/h3&gt;</span>
<span class="x">  &lt;p&gt;Email: me@example.com&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;h3&gt;Main&lt;/h3&gt;</span>
<span class="x">&lt;p&gt;Welcome!&lt;/p&gt;</span>
</pre></div><p>The reference <a href="http://guides.rubyonrails.org/layouts_and_rendering.html">RailsGuides: Layouts and Rendering in Rails</a> explains more about using <code>yield</code> and <code>content_for</code>.</p>
<h3 id="view-helpers">View Helpers</h3>
<p>Let’s look more closely at the application layout file.</p>
<p>As we might expect, we see <span class="caps">HTML</span> tags, enclosed in angle brackets (sometimes called chevrons).</p>
<p>We also see <span class="caps">ERB</span> <code>&lt;%= ... %&gt;</code> delimiters. Earlier, we saw that the delimiters allow us to insert Ruby expressions which are replaced by the result of evaluating the code.</p>
<p>In the application layout file, the <code>&lt;%= ... %&gt;</code> delimiters don’t include anything that looks like Ruby code. For example, we see <code>&lt;%= csrf_meta_tags %&gt;</code> which seems to be neither <span class="caps">HTML</span> nor anything from the Ruby <span class="caps">API</span>. In fact, this expression is Ruby code, but it is from the Rails <span class="caps">API</span> and only found in Rails applications.</p>
<p>Ruby is an ideal choice for a web application development platform such as Rails because it can easily be used to create a <em>domain-specific language</em> (or <em>DSL_). Much of Rails is a domain-specific language. The Smalltalk programming language was famous for its mantra “Code should read like a conversation.” Ruby, which borrows much from Smalltalk, makes it easy to add new words to the conversation. We can add new keywords that produce complex behaviour, creating entire new APIs such as Rails. Ruby makes it easy for the Rails core team to add keywords such as @csrf_meta</em>tags@ that are additions to the Ruby language.</p>
<p>In this case, Ruby’s ability to produce a domain-specific language gives us Rails <em>view helpers</em>. Think of Rails view helpers as “macros to generate <span class="caps">HTML</span>.” You may have used macros to automate a series of commands in World of Warcraft or other games. If you’re an office worker, you may have used macros in Microsoft Word or Excel. A Rails view helper is a keyword that expands into a longer string of <span class="caps">HTML</span> tags and content.</p>
<p>In this case, the <code>csrf_meta_tags</code> view helper expands into two lines of <span class="caps">HTML</span>:</p>
<div class="highlight"><pre><span class="nt">&lt;meta</span> <span class="na">content=</span><span class="s">"authenticity_token"</span> <span class="na">name=</span><span class="s">"csrf-param"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">content=</span><span class="s">"NRPrgfuj5GAyylNpNxQaMHDypcOsu6dmh5DT1yET6hQ="</span> <span class="na">name=</span><span class="s">"csrf-token"</span> <span class="nt">/&gt;</span>
</pre></div><p>But why? It turns out that almost any website that accepts user input via a form is vulnerable to a security bug (an <em>exploit_) named a <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgery</a>. To prevent rampant <span class="caps">CSRF</span> exploits, the Rails core team includes the @csrf_meta</em>tags@ view helper in the default application layout. Rails provides a number of similar features that make websites more secure.</p>
<p>A Rails view file becomes much less mysterious when you realize that many of the keywords you see are view helpers. Strange new keywords may be part of the Rails <span class="caps">API</span>. Or they may be provided by gems you’ve added (gem developers often use the Ruby <span class="caps">DSL</span> capability to create new keywords). Think of it this way: Ruby gives developers the power to create an unlimited number of new “<span class="caps">HTML</span> tags.” These tags are not really <span class="caps">HTML</span> because they are not part of the <span class="caps">HTML</span> specification. But they serve as shortcuts to produce complex snippets of <span class="caps">HTML</span> and content.</p>
<h3 id="basic-boilerplate">Basic Boilerplate</h3>
<p>So far we’ve seen the standard <span class="caps">HTML</span> <code>DOCTYPE</code>, <code>&lt;head&gt;</code>, and <code>&lt;body&gt;</code> tags.</p>
<p>We’ve seen the <code>yield</code> keyword.</p>
<p>We’ve seen the <code>&lt;%= ... %&gt;</code> delimiters surrounding the <code>csrf_meta_tags</code> view helper:</p>
<ul>
  <li><code>csrf_meta_tags</code> – generates <code>&lt;meta&gt;</code> tags that prevent <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgery</a></li>
</ul>
<p>Finally, notice the <code>&lt;%= ... %&gt;</code> delimiters surrounding other Rails helper methods:</p>
<ul>
  <li><code>stylesheet_link_tag</code> – generates an <span class="caps">HTML</span> <code>&lt;link&gt;</code> tag for <span class="caps">CSS</span></li>
  <li><code>javascript_include_tag</code> – generates an <span class="caps">HTML</span> <code>&lt;script&gt;</code> tag for JavaScript</li>
</ul>
<p>These are tags that add <span class="caps">CSS</span> and JavaScript to the web page. Later in this chapter, we’ll take a closer look at the view helpers that add <span class="caps">CSS</span> and JavaScript.</p>
<h3 id="adding-boilerplate">Adding Boilerplate</h3>
<p>Webmasters who build static websites are accustomed to setting up web pages with “boilerplate,” or basic templates for a standard web page. The well-known <a href="http://html5boilerplate.com/">HTML5 Boilerplate</a> project has been recommending “best practice” tweaks to web pages since 2010. Very few of the HTML5 Boilerplate recommendations are relevant for Rails developers, as Rails already provides almost everything required. There is only one boilerplate item you should add: the <code>viewport</code> metatag.</p>
<p>If you want to learn more, the article <a href="http://railsapps.github.io/rails-html5-boilerplate.html">HTML5 Boilerplate for Rails Developers</a> looks at the recommendations.</p>
<h4 id="viewport">Viewport</h4>
<p>The <code>viewport</code> metatag improves the presentation of web pages on mobile devices. Setting a viewport tells the browser how content should fit on the device’s screen. Apple’s developer documentation on <a href="http://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariWebContent/UsingtheViewport/UsingtheViewport.html">Configuring the Viewport</a> provides details.</p>
<p>The <code>viewport</code> metatag looks like this:</p>
<div class="highlight"><pre><span class="x">&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span>
</pre></div><h4 id="title-and-description">Title and Description</h4>
<p>If you want to maximize traffic to your website, you should make your web pages search-engine friendly. That means adding <em>title</em> and <em>description</em> metatags. Google uses contents of the title tag to display titles in search results. And it will sometimes use the content of a description metatag in search results snippets. See Google’s explanation of how it uses <a href="http://support.google.com/webmasters/bin/answer.py?hl=en&amp;answer=35624">Site Title and Description</a>. Good titles and descriptions improve clickthrough from Google searches. Later in the tutorial, we’ll see how to use a <code>content_for</code> statement to set a title and description for a page.</p>
<p>Adding title and description looks like this:</p>
<div class="highlight"><pre><span class="x">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">content_for?</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">?</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">:</span> <span class="s2">"Learning Rails"</span> <span class="cp">%&gt;</span><span class="x">&lt;/title&gt;</span>
<span class="x">&lt;meta name="description" content="</span><span class="cp">&lt;%=</span> <span class="n">content_for?</span><span class="p">(</span><span class="ss">:description</span><span class="p">)</span> <span class="p">?</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:description</span><span class="p">)</span> <span class="p">:</span> <span class="s2">"Learning Rails"</span> <span class="cp">%&gt;</span><span class="x">"&gt;</span>
</pre></div><p>The code is complex if you haven’t see Ruby before. It uses the Ruby <a href="http://ruby.about.com/od/beginningruby/a/The-Ternary-Or-Conditional-Operator.htm">ternary operator</a> which maximizes compactness at the price of introducing obscurity. It’s a fancy conditional statement that says, “if <code>content_for?(:title)</code> is present in the view file, use <code>yield(:title)</code> to include it, otherwise just display ‘Learning Rails’.”</p>
<p>We’ll add the <code>viewport</code> metatag, title, and description to the application layout at the end of this chapter.</p>
<h3 id="asset-pipeline">Asset Pipeline</h3>
<p>When building static websites, webmasters add JavaScript to a page using the <code>&lt;script&gt;</code> tag. For every JavaScript file, they add an additional <code>&lt;script&gt;</code> tag, so a page <span class="caps">HEAD</span> section looks like this:</p>
<div class="highlight"><pre><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">  &lt;title&gt;Page that uses multiple JavaScript files&lt;/title&gt;</span>
<span class="x">  &lt;script src="jquery.js" type="text/javascript"&gt;&lt;/script&gt;</span>
<span class="x">  &lt;script src="jquery.plugin.js" type="text/javascript"&gt;&lt;/script&gt;</span>
<span class="x">  &lt;script src="custom.js" type="text/javascript"&gt;&lt;/script&gt;</span>
<span class="x">&lt;/head&gt;</span>
</pre></div><p>The same is true for <span class="caps">CSS</span> files. When you organize stylesheets in multiple files, you add a <code>&lt;link&gt;</code> tag for each one.</p>
<p>There’s a drawback to using multiple files. Requesting files from the server is a time-consuming operation for a web browser, so every extra file request slows down the browser.</p>
<p>Rails improves website performance by providing the <em>asset pipeline</em> utility. The Rails asset pipeline improves website performance by concatenating multiple JavaScript or <span class="caps">CSS</span> files into a single script, allowing the developer to organize code in separate files, but eliminating the performance penalty of multiple <code>&lt;script&gt;</code> or <code>&lt;link&gt;</code> tags. The Rails asset pipeline also compresses JavaScript and <span class="caps">CSS</span> files for faster page loads.</p>
<p>The asset pipeline is an example of a Rails convention that helps organize complex websites. It is not needed for a simple website that uses a few JavaScript or <span class="caps">CSS</span> files. But it is beneficial on bigger projects.</p>
<p>You’ll use the <strong>app/assets/</strong> directory to fill the asset pipeline. The directory contains two folders:</p>
<ul>
  <li><strong>app/assets/javascripts/</strong></li>
  <li><strong>app/assets/stylesheets/</strong></li>
</ul>
<p>For now, just note that any JavaScript and <span class="caps">CSS</span> files you add to these folders will be automatically added to every page. We’ve already seen the tags that perform this service:</p>
<div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="ss">media</span><span class="p">:</span> <span class="s2">"all"</span><span class="p">,</span> <span class="s2">"data-turbolinks-track"</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="s2">"data-turbolinks-track"</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div><p>Later in the tutorial, we’ll use the asset pipeline to add <span class="caps">CSS</span> and JavaScript to our application.</p>
<h3 id="navigation-links">Navigation Links</h3>
<p>Every website needs navigation links. For our application, we’ll want links for Home, About, and Contact.</p>
<p>You can add navigation links directly to your application layout but many Rails developers prefer to create a <a href="http://guides.rubyonrails.org/layouts_and_rendering.html#using-partials">partial template</a> – a “partial” – to better organize the default application layout.</p>
<p>A <em>partial</em> is similar to any view file, except the filename begins with an underscore character. Save the file in any view folder and use the <code>render</code> keyword to insert the partial. Here’s an example of using the <code>render</code> keyword with a hypothetical file named <strong>app/views/layouts/_footer.html.erb</strong>:</p>
<div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/footer'</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div><p>Notice that you specify the folder within the <strong>app/views/</strong> directory with a truncated version of the filename. The <code>render</code> method doesn’t want the <code>_</code> underscore character or the <code>.html.erb</code> file extension. That can be confusing; it makes sense when you remember that Rails likes “convention over configuration” and economizes on extra characters when possible.</p>
<p>There’s no rule against using raw <span class="caps">HTML</span> in our view files, so we could create a partial for navigation links that uses the <span class="caps">HTML</span> <code>&lt;a&gt;</code> anchor tag like this:</p>
<div class="highlight"><pre><span class="x">&lt;ul class="nav"&gt;</span>
<span class="x">  &lt;li&gt;&lt;a href="/"&gt;Home&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">  &lt;li&gt;&lt;a href="/about"&gt;About&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">  &lt;li&gt;&lt;a href="/contact"&gt;Contact&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">&lt;/ul&gt;</span>
</pre></div><p>Rails gives us another option, however. We can use the Rails <code>link_to</code> view helper instead of the <span class="caps">HTML</span> <code>&lt;a&gt;</code> anchor tag. The Rails <code>link_to</code> helper eliminates the crufty <code>&lt;&gt;</code> angle brackets and the unnecessary <code>href=""</code>. More importantly, it adds a layer of abstraction, using the routing configuration file to form links. This is advantageous if we make changes to the location of the link destinations. Earlier, when we created a static “About” page, we first set the <strong>config/routes.rb</strong> file with a route to the “About” page: <code>root :to =&gt; redirect('/about.html')</code>. Later we removed the static “About” page and set the <strong>config/routes.rb</strong> file with a route to the dynamic home page: <code>root :to =&gt; 'home#index'</code>. If we used the raw <span class="caps">HTML</span> <code>&lt;a&gt;</code> anchor tag, we’d have to change the raw <span class="caps">HTML</span> everywhere we had a link to the home page. Using the Rails <code>link_to</code> helper, we name a route and make any changes once, in the <strong>config/routes.rb</strong> file.</p>
<p>When you use the Rails <code>link_to</code> helper, you’ll avoid the problem of link maintenance that webmasters face on static websites. Some webmasters like to use <em>absolute</em> URLs, specifying a host name in the link, for example <code>http://www.example.com/about.html</code>. Absolute URLs are a headache when moving the site, for example from <code>staging.example.com</code> to <code>www.example.com</code>. The problem is avoided by using <em>relative</em> URLs,  such as <code>/about.html</code>, <code>about.html</code>, or even <code>../about.html</code>. But relative URLs are fragile, and moving files or directories often results in overlooked and broken links. Instead, with the Rails <code>link_to</code> helper, you always get the destination location specified in the <strong>config/routes.rb</strong> file.</p>
<p>Using the <code>link_to</code> helper, create a file <strong>app/views/layouts/_navigation.html.erb</strong>:</p>
<div class="highlight"><pre><span class="x">&lt;ul class="nav"&gt;</span>
<span class="x">  &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Home'</span><span class="p">,</span> <span class="n">root_path</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="x">  &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'About'</span><span class="p">,</span> <span class="n">page_path</span><span class="p">(</span><span class="s1">'about'</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="x">  &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Contact'</span><span class="p">,</span> <span class="n">page_path</span><span class="p">(</span><span class="s1">'contact'</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="x">&lt;/ul&gt;</span>
</pre></div><p>Here the <code>link_to</code> helper takes two parameters. The first parameter is the string displayed as the anchor text (<code>'Home'</code>). The second parameter is the route. In this case, the route <code>root_path</code> has been set in the <strong>config/routes.rb</strong> file. The two other routes, <code>page_path('about')</code> and <code>page_path('contact')</code>, are not set. We’ll add them to the <strong>config/routes.rb</strong> file later.</p>
<p>We can add the navigation links partial to our application layout with the expression:</p>
<div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/navigation'</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div><p>We’ll add this to the application layout at the end of this chapter.</p>
<h3 id="flash-messages">Flash Messages</h3>
<p>Rails provides a standard convention to display alerts (including error messages) and other notices (including success messages), called a <em>flash message</em>. The name comes from the term “flash memory” and should not be confused with the “Adobe Flash” web development platform that was once popular for animated websites.</p>
<p>Here’s a flash message you might see after logging it to an application:</p>
<p><img src="https://tutorials.railsapps.org/assets/learn-rails-44-flash.png" title="Flash Message in Rails" alt="Flash Message in Rails" /></p>
<p>It is called a “flash message” because it appears on a page temporarily. When the page is reloaded or another page is visited, the message disappears.</p>
<p>Flash messages are created in a controller. For example, we could add messages to the home page by modifying the HomeController like this:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">HomeController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@owner</span> <span class="o">=</span> <span class="no">Owner</span><span class="o">.</span><span class="n">new</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'Welcome!'</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:alert</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'My birthday is soon.'</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>Rails provides the <code>flash</code> object so that messages can be created in the controller and displayed on the rendered web page. The <code>flash</code> object is a Ruby <em>hash</em> (also known as an <em>associative array</em>). A hash is a data structure that associates a key to some value. You retrieve the value based upon its key. This construct is called a <em>dictionary</em> in other languages, which is appropriate because you use the key to “look up” a value, as you would look up a definition for a word in a dictionary.</p>
<p>In this example, we create a flash message by associating the key <code>flash[:notice]</code> with the string <code>'Welcome!'</code>. We can assign other messages, such as <code>flash[:alert]</code> or even <code>flash[:warning]</code>. In practice, Rails uses only <code>:notice</code> and <code>:alert</code> as flash message keys so it is wise to stick with just these.</p>
<p>Hash is a type of <em>collection</em>. In Ruby, all collections support an <em>iterator</em> method named <code>each</code>. Iterators return all the elements of a collection, one after the other. The iterator returns each key-value pair, item by item, to a <em>block</em>. In Ruby, a block is delimited by <code>do</code> and <code>end</code> or <code>{ }</code> braces. You can add any code to a block to process each item from the collection.</p>
<p>Here is simple Ruby code to iterate through a <code>flash</code> object, outputting each flash message in an <span class="caps">HTML</span> <code>div</code> tag and applying a <span class="caps">CSS</span> class for styling:</p>
<div class="highlight"><pre><span class="n">flash</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s1">'&lt;div class="'</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">'"&gt;'</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">'&lt;/div&gt;'</span>
<span class="k">end</span>
</pre></div><p>In this simple example, we use <code>each</code> to iterate through the flash hash, retrieving a <code>key</code> and <code>value</code> that are passed to a block to be output as a string. We’ve chosen the variable names <code>key</code> and <code>value</code> but the names are arbitrary. In the next example, we’ll use <code>name</code> and <code>msg</code> as variables for the key-value pair. The output string will appear as <span class="caps">HTML</span> like this:</p>
<div class="highlight"><pre><span class="x">&lt;div class="notice"&gt;Welcome!&lt;/div&gt;</span>
<span class="x">&lt;div class="alert"&gt;My birthday is soon.&lt;/div&gt;</span>
</pre></div><p>Flash messages are a very useful feature for a dynamic website and could be used on any page. We’ll add code to output flash messages within the application layout.</p>
<p>Code for flash messages can go directly in your application layout file or you can create a partial.</p>
<p>Add a partial for flash messages by creating a file <strong>app/views/layouts/_messages.html.erb</strong> like this:</p>
<div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">flash</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">msg</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="nb">String</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">content_tag</span> <span class="ss">:div</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="ss">:id</span> <span class="o">=&gt;</span> <span class="s2">"flash_</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div><p>We’ve improved on our simple Ruby example in several ways. First, we’ve added <code>if msg.is_a?(String)</code> as a test to make sure we only display messages that are strings. Second, we’ve used the Rails <code>content_tag</code> view helper to create the <span class="caps">HTML</span> <code>div</code>. The <code>content_tag</code> helper eliminates the messy soup of angle brackets and quote marks we used to create the <span class="caps">HTML</span> output in the example above. Finally, instead of applying a <span class="caps">CSS</span> <code>class</code> for styling, we’ve applied a <span class="caps">CSS</span> <code>id</code> and combined the word “flash” with “notice” or “alert” to make the <span class="caps">CSS</span> ID. It’s appropriate to apply an ID instead of a class because there should be only be a single flash message on the page (classes are used for multiple elements).</p>
<p>We’ll add the partial to the application layout at the end of this chapter.</p>
<h3 id="html5-elements">HTML5 Elements</h3>
<p>To complete our application layout, we’ll add a few structural elements to make it easy to apply <span class="caps">CSS</span> styling. These elements are not unique to a Rails application and will be familiar to anyone who has done front-end development.</p>
<p>We’ll add a container div to the page. This is a common technique among front-end designers, particularly useful for adding margins or borders to the page layout.</p>
<p>The HTML5 specification provides <code>&lt;header&gt;</code> and <code>&lt;footer&gt;</code> elements that add structure to a web page. The tags don’t add any new behavior but make it easier to determine the structure of the page and apply <span class="caps">CSS</span> styles. The <code>&lt;header&gt;</code> tag is typically used for branding or navigation and the <code>&lt;footer&gt;</code> tag typically contains links to copyright information, legal disclaimers, or contact information.</p>
<p>Finally we’ll wrap our <code>yield</code> in a <code>&lt;main role="main"&gt;</code> element. The <code>&lt;main&gt;</code> tag is among the newest HTML5 elements (see the <a href="http://www.w3.org/html/wg/drafts/html/master/grouping-content.html#the-main-element">W3C specification</a> for details). From the specification: “The main content area of a document includes content that is unique to that document and excludes content that is repeated across a set of documents such as site navigation links, copyright information, site logos.” The specification recommends, “Authors are advised to use <span class="caps">ARIA</span> @role=”main"@ attribute on the main element until user agents implement the required role mapping." We’ll follow the advice of the specification and wrap our unique content in the <code>&lt;main&gt;</code> tag.</p>
<p>Let’s put this all together for our updated application layout.</p>
<h3 id="updated-application-layout">Updated Application Layout</h3>
<p>Modify the file <strong>app/views/layouts/application.html.erb</strong> to include everything we’ve discussed in this chapter:</p>
<div class="highlight"><pre><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span>
<span class="x">  &lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">content_for?</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">?</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">:</span> <span class="s2">"Learning Rails"</span> <span class="cp">%&gt;</span><span class="x">&lt;/title&gt;</span>
<span class="x">  &lt;meta name="description" content="</span><span class="cp">&lt;%=</span> <span class="n">content_for?</span><span class="p">(</span><span class="ss">:description</span><span class="p">)</span> <span class="p">?</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:description</span><span class="p">)</span> <span class="p">:</span> <span class="s2">"Learning Rails"</span> <span class="cp">%&gt;</span><span class="x">"&gt;</span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="ss">media</span><span class="p">:</span> <span class="s2">"all"</span><span class="p">,</span> <span class="s2">"data-turbolinks-track"</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="s2">"data-turbolinks-track"</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">  &lt;div id="container"&gt;</span>
<span class="x">    &lt;header&gt;</span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/navigation'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/messages'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;/header&gt;</span>
<span class="x">    &lt;main role="main"&gt;</span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;/main&gt;</span>
<span class="x">    &lt;footer&gt;</span>
<span class="x">    &lt;/footer&gt;</span>
<span class="x">  &lt;/div&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div><p>We’ve added the <code>viewport</code> metatag, replaced the title, and added a description.</p>
<p>We’ve added the partials for navigation links and flash messages.</p>
<p>Finally we’ve added HTML5 structural elements.</p>
<p>Our application layout is complete—for now. In the next chapter, we’ll revise it to support styling with Twitter Bootstrap.</p>
<h3 id="test-the-application-3">Test the Application</h3>
<p>Let’s run the application to see how it looks with the new application layout. The web server may already be running. If not, enter the command:</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>Our home page now has navigation links. The links are broken because we haven’t yet created “About” and “Contact” pages. We’ll add those soon.</p>
<p>Next we’ll add <span class="caps">CSS</span> to improve the design.</p>
</section>
<section class='chapter' id='stylesheets-and-themes'><h2>Stylesheets and Themes</h2>
<p>This chapter touches on front-end development and design using <span class="caps">CSS</span>. I’ll show you how to add <span class="caps">CSS</span> to a Rails application, including Twitter Bootstrap for a simple theme.</p>
<p>There are three approaches to front-end design for your Rails application.</p>
<p>One approach is to purchase a pre-designed theme for your website. You may have visited <a href="http://themeforest.net/">ThemeForest</a> or other theme galleries that offer pre-built themes for a few dollars each. These huge commercial galleries offer themes for WordPress, Tumblr, or <span class="caps">CMS</span> applications such as Drupal or Joomla. They don’t offer themes for Rails and it is not easy to adapt one of their themes for a Rails application. However, I’ll provide links to a few small commercial sites offering themes pre-built for Rails applications.</p>
<p>A second approach is to use <a href="http://twitter.github.io/bootstrap/">Twitter Bootstrap</a> or <a href="http://foundation.zurb.com/">Zurb Foundation</a>. (Which one? See <a href="http://designshack.net/articles/css/framework-fight-zurb-foundation-vs-twitter-bootstrap/">Framework Fight</a>). You can use these front-end frameworks to quickly add attractive <span class="caps">CSS</span> styling to your application. Many developers don’t have the skill or resources to customize the design. Consequently, sites that use Twitter Bootstrap or Zurb Foundation look very similar. If that’s your situation, it’s okay, really! It’s better to have a decent site with the clean look of Twitter Bootstrap than leak ugliness onto the web.</p>
<p>A third approach is to implement a unique design, built from scratch using <span class="caps">CSS</span> or customized from a framework such as Twitter Bootstrap or Zurb Foundation. If you’ve got strong design skills, or can partner with an experienced web designer, this gives you a custom design that expresses the purpose and motif of your website.</p>
<p>I’ll give you some links for theme galleries and then we’ll add Twitter Bootstrap to our tutorial application.</p>
<h3 id="themes">Themes</h3>
<p>Rails developers are not a large market for commercial theme galleries because many Rails projects can afford custom design. And unlike WordPress, Rails projects implement such a great variety of sites that no theme can be prepackaged to accommodate all Rails projects. That said, a few consultants recently have introduced themes that can be used on Rails projects.</p>
<ul>
  <li><a href="https://railsthemes.com/">RailsThemes.com</a> from Eliza Brock, Anthony Panozzo, and Luke Flener</li>
  <li><a href="http://dresssed.com/">Dressed Rails Themes</a> from Marc-André Cournoyer</li>
  <li><a href="http://railsview.com/">Railsview.com</a> from Richardson Dackam</li>
</ul>
<p>The <a href="https://wrapbootstrap.com/">WrapBootstrap</a> marketplace offers themes that can be adapted for Rails. One offering built on Twitter Bootstrap is packaged as a Rails gem:</p>
<ul>
  <li><a href="https://wrapbootstrap.com/theme/rails-strap-ruby-ready-theme-WB00952P7">RailsStrap</a> by Leon Touroutoglou</li>
</ul>
<p>The <a href="http://bootswatch.com/">Bootswatch</a> site offers free themes for Twitter Bootstrap that can be adapted for Rails.</p>
<p>If you want the retro look of the 1990s web, use:</p>
<ul>
  <li><a href="http://divshot.github.io/geo-bootstrap/">Geo for Bootstrap</a></li>
</ul>
<p>You’ve got to see it. Believe it or not, websites used to look like that.</p>
<p>Even if you use a prepackaged theme, you’ll need to know how to set up <span class="caps">CSS</span> stylesheets in Rails. And you’re likely to need Twitter Bootstrap. We’ll look at the asset pipeline for <span class="caps">CSS</span> and Twitter Bootstrap next.</p>
<h3 id="asset-pipeline-for-css">Asset Pipeline for <span class="caps">CSS</span></h3>
<p>In the previous chapter, I introduced the Rails <em>asset pipeline</em>. The asset pipeline helps web pages display faster in the browser by combining all <span class="caps">CSS</span> files into a single file (it does the same for JavaScript).</p>
<p>Your <span class="caps">CSS</span> stylesheets get concatenated and compacted for delivery to the browser when you add them to this directory:</p>
<ul>
  <li><strong>app/assets/stylesheets/</strong></li>
</ul>
<p>The default Rails starter application contains one file in the directory:</p>
<ul>
  <li><strong>app/assets/stylesheets/application.css</strong></li>
</ul>
<p>Open the file in your text editor and you’ll see this:</p>
<div class="highlight"><pre><span class="cm">/*</span>
 <span class="cm">* This is a manifest file that'll be compiled into application.css, which will include all the files</span>
 <span class="cm">* listed below.</span>
 <span class="cm">*</span>
 <span class="cm">* Any CSS and SCSS file within this directory, lib/assets/stylesheets, vendor/assets/stylesheets,</span>
 <span class="cm">* or vendor/assets/stylesheets of plugins, if any, can be referenced here using a relative path.</span>
 <span class="cm">*</span>
 <span class="cm">* You're free to add application-wide styles to this file and they'll appear at the top of the</span>
 <span class="cm">* compiled file, but it's generally better to create a new file per style scope.</span>
 <span class="cm">*</span>
 <span class="cm">*= require_self</span>
 <span class="cm">*= require_tree .</span>
 <span class="cm">*/</span>
</pre></div><p>The <strong>app/assets/stylesheets/application.css</strong> file serves two purposes. First, you can add any <span class="caps">CSS</span> rules to the file that you want to use anywhere on your website. Second, the file serves as a <em>manifest</em>, providing a list of files that should be concatenated and included in the single <span class="caps">CSS</span> file that is delivered to the browser.</p>
<p>It’s bad practice to place all your <span class="caps">CSS</span> in the <strong>app/assets/stylesheets/application.css</strong> file (unless your <span class="caps">CSS</span> is very limited). Instead, structure your <span class="caps">CSS</span> in multiple files. <span class="caps">CSS</span> that is used on only a single page can go in a file with a name that matches the page. Or, if sections of the website share common elements, such as themes for landing pages or administrative pages, make a file for each theme. How you organize your <span class="caps">CSS</span> is up to you; the asset pipeline lets you organize your <span class="caps">CSS</span> so it is easier to develop and maintain. Just add the files to the <strong>app/assets/stylesheets/</strong> folder.</p>
<p>It’s not obvious from the name of the <strong>app/assets/stylesheets/application.css</strong> file that it serves as a <em>manifest file</em> as well as a location for miscellaneous <span class="caps">CSS</span> rules. For most websites, you can ignore its role as a manifest file. In the comments at the top of the file, the <code>*= require_self</code> directive indicates that any <span class="caps">CSS</span> in the file should be delivered to the browser. The <code>*= require_tree .</code> directive (note the Unix “dot operator”) indicates any files in the same folder, including files in subfolders, should be combined into a single file for delivery to the browser.</p>
<p>If your website is large and complex, you can remove the <code>*= require_tree .</code> directive and specify individual files to be included in the file that is generated by the asset pipeline. This gives you the option of reducing the size of the application-wide <span class="caps">CSS</span> file that is delivered to the browser. For example, you might segregate a file that includes <span class="caps">CSS</span> that is used only in the site’s administrative section. In general, only large and complex sites need this optimization. The speed of rendering a single large <span class="caps">CSS</span> file is faster than fetching multiple files.</p>
<h3 id="css-styling-with-sass"><span class="caps">CSS</span> Styling with Sass</h3>
<p>It’s a good idea to rename the <strong>app/assets/stylesheets/application.css</strong> file as <strong>app/assets/stylesheets/application.css.scss</strong>. You’ll add the <strong>.scss</strong> file extension. This will allow you to use the advantages of the <a href="http://sass-lang.com/">Sass</a> syntax for your application stylesheet.</p>
<p>Ordinary <span class="caps">CSS</span> is not a programming language so <span class="caps">CSS</span> rules are verbose and often repetitive. <a href="http://sass-lang.com/">Sass</a> is a preprocessor for <span class="caps">CSS</span> so your stylesheets can use variables, <em>mixins</em>, and nesting of <span class="caps">CSS</span> rules. You can create a variable such as <code>$blue: #3bbfce</code> and specify colors anywhere using the variable, for example, <code>border-color: $blue</code>. Mixins are like variables that let you use snippets of reusable <span class="caps">CSS</span>. Nesting eliminates repetition by layering <span class="caps">CSS</span> selectors.</p>
<p>You can use Sass in any file by adding the file extension <strong>.scss</strong>. The asset pipeline will preprocess the file and expand it as standard <span class="caps">CSS</span>.</p>
<p>For more on the advantages of Sass and how to use it, see the the <a href="http://sass-lang.com/">Sass</a> website or the <a href="http://railscasts.com/episodes/268-sass-basics">Sass Basics RailsCast</a> from Ryan Bates.</p>
<h3 id="adding-twitter-bootstrap">Adding Twitter Bootstrap</h3>
<p><a href="http://twitter.github.io/bootstrap/">Twitter Bootstrap</a> and other <span class="caps">CSS</span> front-end frameworks are toolkits that provide the kind of structure and convention that make Rails popular for back-end development. Twitter Bootstrap provides a standard grid for layout plus dozens of reusable components for common page elements such as navigation, forms, and buttons.</p>
<p>Visit the <a href="http://bootsnipp.com/">Bootsnipp.com</a> gallery for dozens of additional page elements and code snippets.</p>
<p>The Bootstrap Hero site offers a <a href="http://www.bootstraphero.com/the-big-badass-list-of-twitter-bootstrap-resources/">Big Badass List of Useful Twitter Bootstrap Resources</a>.</p>
<h4 id="twitter-bootstrap-gem">Twitter Bootstrap Gem</h4>
<p>Several options are available for installing Twitter Bootstrap in a Rails application. Gems are available for either the native Bootstrap <a href="http://lesscss.org/"><span class="caps">LESS</span></a> language or the <a href="http://sass-lang.com/">Sass</a> language that is the default for <span class="caps">CSS</span> files in Rails. Sass is a default for <span class="caps">CSS</span> development in Rails so I recommend using Thomas McDonald’s <a href="https://github.com/thomas-mcdonald/bootstrap-sass">bootstrap-sass</a> gem to add Twitter Bootstrap.</p>
<p>In your <strong>Gemfile</strong>, you’ve already added:</p>
<div class="highlight"><pre><span class="n">gem</span> <span class="s1">'bootstrap-sass'</span>
</pre></div><p>and previously run <code>$ bundle install</code>.</p>
<h4 id="add-twitter-bootstrap-css">Add Twitter Bootstrap <span class="caps">CSS</span></h4>
<p>Add a file <strong>app/assets/stylesheets/bootstrap_and_overrides.css.scss</strong> containing:</p>
<div class="highlight"><pre><span class="k">@import</span> <span class="s2">"bootstrap"</span><span class="p">;</span>
<span class="nt">body</span> <span class="p">{</span> <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span> <span class="p">}</span>
<span class="k">@import</span> <span class="s2">"bootstrap-responsive"</span><span class="p">;</span>
</pre></div><p>The file <strong>app/assets/stylesheets/bootstrap_and_overrides.css.scss</strong> is automatically included and compiled into your Rails application.css file by the <code>*= require_tree .</code> statement in the <strong>app/assets/stylesheets/application.css.scss</strong> file.</p>
<p>The file will import both basic Bootstrap <span class="caps">CSS</span> rules and the Bootstrap rules for responsive design (allowing the layout to resize for various devices and screen sizes).</p>
<p>The <span class="caps">CSS</span> rule <code>body { padding-top: 60px; }</code> applies an additional <span class="caps">CSS</span> rule to accommodate the Bootstrap navigation bar heading created by the <code>navbar-fixed-top class</code> in the <code>header</code> tag in the layout below.</p>
<p>You could add the Bootstrap <code>@import</code> code to the <strong>app/assets/stylesheets/application.css.scss</strong> file. However, I recommend adding the separate <strong>app/assets/stylesheets/bootstrap_and_overrides.css.scss</strong> file. You may wish to modify the Twitter Bootstrap <span class="caps">CSS</span> rules; placing changes to Twitter Bootstrap <span class="caps">CSS</span> rules in the <strong>bootstrap_and_overrides.css.scss</strong> file will keep your <span class="caps">CSS</span> better organized.</p>
<h4 id="add-twitter-bootstrap-javascript">Add Twitter Bootstrap JavaScript</h4>
<p>On this project, we’ll use Twitter Bootstrap for <span class="caps">CSS</span> only. But we’ll set up the Twitter Bootstrap JavaScript component in case you choose to extend the project.</p>
<p>Include the Twitter Bootstrap JavaScript files by modifying the file <strong>app/assets/javascripts/application.js</strong>:</p>
<div class="highlight"><pre><span class="c1">//= require jquery</span>
<span class="c1">//= require jquery_ujs</span>
<span class="c1">//= require bootstrap</span>
<span class="c1">//= require_tree .</span>
</pre></div><p>Like the <strong>application.css.scss</strong> file, the <strong>application.js</strong> file is a manifest that allows a developer to designate the JavaScript files that will be combined for delivery to the browser.</p>
<h3 id="css-example"><span class="caps">CSS</span> Example</h3>
<p>We’ll add a nice gray box as a background to page content. This gives us an example of adding a <span class="caps">CSS</span> rule that will be used on every page of the application.</p>
<p>Add this to your <strong>app/assets/stylesheets/application.css.scss</strong> file for a gray background:</p>
<div class="highlight"><pre><span class="nc">.content</span> <span class="p">{</span>
  <span class="na">background-color</span><span class="o">:</span> <span class="mh">#eee</span><span class="p">;</span>
  <span class="na">padding</span><span class="o">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin</span><span class="o">:</span> <span class="mi">0</span> <span class="mi">-20</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">-webkit-border-radius</span><span class="o">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">6</span><span class="kt">px</span> <span class="mi">6</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">-moz-border-radius</span><span class="o">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">6</span><span class="kt">px</span> <span class="mi">6</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-radius</span><span class="o">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">6</span><span class="kt">px</span> <span class="mi">6</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">-webkit-box-shadow</span><span class="o">:</span> <span class="mi">0</span> <span class="mi">1</span><span class="kt">px</span> <span class="mi">2</span><span class="kt">px</span> <span class="nf">rgba</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,.</span><span class="mi">15</span><span class="p">);</span>
  <span class="na">-moz-box-shadow</span><span class="o">:</span> <span class="mi">0</span> <span class="mi">1</span><span class="kt">px</span> <span class="mi">2</span><span class="kt">px</span> <span class="nf">rgba</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,.</span><span class="mi">15</span><span class="p">);</span>
  <span class="na">box-shadow</span><span class="o">:</span> <span class="mi">0</span> <span class="mi">1</span><span class="kt">px</span> <span class="mi">2</span><span class="kt">px</span> <span class="nf">rgba</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,.</span><span class="mi">15</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><p>The <span class="caps">CSS</span> code applies styling to a <code>.content</code> class. It sets background color, a border and shadow, padding and margin. It’s complicated by accommodating differences among web browsers.</p>
<h3 id="default-application-layout-with-twitter-bootstrap">Default Application Layout with Twitter Bootstrap</h3>
<p>In the last chapter, we configured the default application layout with HTML5 elements, navigation links, and flash messages. Now that we’ve installed Twitter Bootstrap, we can style the page with Bootstrap’s built-in <span class="caps">CSS</span> components. You can choose from dozens of <a href="http://twitter.github.io/bootstrap/components.html">Bootstrap <span class="caps">CSS</span> components</a>; we’ll use the navigation components with the <a href="http://twitter.github.io/bootstrap/scaffolding.html">Bootstrap 12-column grid</a>.</p>
<p>Replace the contents of the file <strong>app/views/layouts/application.html.erb</strong> with this:</p>
<div class="highlight"><pre><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">  &lt;head&gt;</span>
<span class="x">    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span>
<span class="x">    &lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">content_for?</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">?</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">:</span> <span class="s2">"Learning Rails"</span> <span class="cp">%&gt;</span><span class="x">&lt;/title&gt;</span>
<span class="x">    &lt;meta name="description" content="</span><span class="cp">&lt;%=</span> <span class="n">content_for?</span><span class="p">(</span><span class="ss">:description</span><span class="p">)</span> <span class="p">?</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:description</span><span class="p">)</span> <span class="p">:</span> <span class="s2">"Learning Rails"</span> <span class="cp">%&gt;</span><span class="x">"&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s2">"all"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">"application"</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/head&gt;</span>
<span class="x">  &lt;body&gt;</span>
<span class="x">    &lt;header class="navbar navbar-fixed-top"&gt;</span>
<span class="x">      &lt;nav class="navbar-inner"&gt;</span>
<span class="x">        &lt;div class="container"&gt;</span>
<span class="x">          </span><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/navigation'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">      &lt;/nav&gt;</span>
<span class="x">    &lt;/header&gt;</span>
<span class="x">    &lt;main role="main"&gt;</span>
<span class="x">      &lt;div class="container"&gt;</span>
<span class="x">        &lt;div class="content"&gt;</span>
<span class="x">           &lt;div class="row"&gt;</span>
<span class="x">            &lt;div class="span12"&gt;</span>
<span class="x">              </span><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/messages'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">              </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">          &lt;/div&gt;</span>
<span class="x">          &lt;footer&gt;</span>
<span class="x">          &lt;/footer&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">      &lt;/div&gt;</span>
<span class="x">    &lt;/main&gt;</span>
<span class="x">  &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div><p>We wrap the navigation partial <code>render 'layouts/navigation'</code> with the Bootstrap navigation classes.</p>
<p>We wrap both the flash messages partial <code>render 'layouts/messages'</code> and the main page content rendered by <code>yield</code> with Bootstrap <code>row</code> and <code>span</code> classes. We also apply the <code>content</code> class for the nice gray box around the main page content.</p>
<h3 id="set-up-simpleform-with-twitter-bootstrap">Set up SimpleForm with Twitter Bootstrap</h3>
<p>One of the requirements for our tutorial application is a contact form. We could set up styling for the form when we implement the contact page, but it is convenient to set up form styling now, as we would if we were adding multiple forms to the site.</p>
<p>Rails provides a set of view helpers for forms. They are described in the <a href="http://guides.rubyonrails.org/form_helpers.html">RailsGuides: Rails Form Helpers</a> document. But, as you’ve learned, Rails has more than one stack, and most developers use an alternative set of form helpers named SimpleForm, provided by the <a href="https://github.com/plataformatec/simple_form">SimpleForm gem</a>. The SimpleForm helpers are more powerful, easier to use, and offer an option for styling with Twitter Bootstrap.</p>
<p>The <a href="http://simple-form-bootstrap.plataformatec.com.br/">SimpleForm and Twitter Bootstrap Demo</a> shows what you can expect.</p>
<p>In your <strong>Gemfile</strong>, you’ve already added:</p>
<div class="highlight"><pre><span class="n">gem</span> <span class="s1">'simple_form'</span>
</pre></div><p>and previously run <code>$ bundle install</code>.</p>
<p>Run the generator to install SimpleForm with a Twitter Bootstrap option:</p>
<div class="highlight"><pre><span class="gp">$</span> rails generate simple_form:install --bootstrap
</pre></div><p>which installs several configuration files:</p>
<div class="highlight"><pre><span class="go">config/initializers/simple_form.rb</span>
<span class="go">config/initializers/simple_form_bootstrap.rb</span>
<span class="go">config/locales/simple_form.en.yml</span>
<span class="go">lib/templates/erb/scaffold/_form.html.erb</span>
</pre></div><p>You previously used the <code>rails generate</code> command to set up configuration files with the Figaro gem. Any gem that needs default files can use the <code>rails generate</code> command to run a simple script that creates files. Here the SimpleForm uses the generator command to create files for initialization and localization (language translation). SimpleForm can be customized with settings in the initialization file. We’ll use the defaults.</p>
<h3 id="test-the-application-4">Test the Application</h3>
<p>Let’s see how the application looks with Twitter Bootstrap. The web server may already be running. If not, enter the command:</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>The links are broken because we haven’t yet created “About” and “Contact” pages. We’ll add those next.</p>
<h3 id="git-6">Git</h3>
<p>Let’s commit our changes to the Git repository.</p>
<div class="highlight"><pre><span class="gp">$</span> git add -A
<span class="gp">$</span> git commit -m <span class="s2">"stylesheets"</span>
<span class="gp">$</span> git push origin master
</pre></div>
</section>
<section class='chapter' id='adding-pages'><h2>Adding Pages</h2>
<p>Let’s begin adding pages to our web application.</p>
<p>There are three types of web pages in a Rails application. We’ve looked at two types so far:</p>
<ul>
  <li>static pages in the <strong>public/</strong> folder that contain no Ruby code</li>
  <li>dynamic pages such as our home page that use the application layout</li>
</ul>
<p>There’s another type of web page that is required on many websites. It has static content; that is, no dynamic data is needed on the page. But it uses the default application layout to maintain consistency in the website look and feel. We classify this type of page as a:</p>
<ul>
  <li>static view that uses the application layout</li>
</ul>
<p>Examples include:</p>
<ul>
  <li>“About” page</li>
  <li>Legal page</li>
  <li><span class="caps">FAQ</span> page</li>
</ul>
<p>It’s possible to place these pages in the <strong>public/</strong> folder and copy the <span class="caps">HTML</span> and <span class="caps">CSS</span> from the default application layout but this leads to duplicated code and maintenance headaches. And dynamic elements such as navigation links can’t be included. For these reasons, developers seldom create static pages in the <strong>public/</strong> folder.</p>
<p>Alternatively, a dynamic page can be created that has no model, a nearly-empty controller, and a view that contains no instance variables. This solution is quite common for static views that use the application layout.</p>
<p>This solution is implemented so frequently that many developers create a gem to encapsulate the functionality. We’re going to use the best-known of these gems, the <a href="https://github.com/thoughtbot/high_voltage">high_voltage gem</a> created by the <a href="http://www.thoughtbot.com/">Thoughtbot</a> consulting firm.</p>
<p>First we’ll use the HighVoltage gem to create an “About” Page. Then we’ll begin an exercise to create a Contact page. Initially we’ll use the HighVoltage gem. Then we’ll add a controller to process the form. And finally we’ll discard the page we created with the HighVoltage gem and replace it with a full model-view-controller implementation. The process will show the difference between an older form of web application architecture and a newer “Rails way.”</p>
<h3 id="highvoltage-gem">HighVoltage Gem</h3>
<p>We can add a page using the HighVoltage gem almost effortlessly. The gem implements Rails “convention over configuration” so well that there is nothing to configure. There are alternatives to its defaults which can be useful but we won’t need them; visit the GitHub home page for the <a href="https://github.com/thoughtbot/high_voltage">high_voltage gem</a> if you want to explore all the options.</p>
<p>In your <strong>Gemfile</strong>, you’ve already added:</p>
<div class="highlight"><pre><span class="n">gem</span> <span class="s1">'high_voltage'</span>
</pre></div><p>and previously run <code>$ bundle install</code>.</p>
<p>Create a folder <strong>app/views/pages</strong>:</p>
<div class="highlight"><pre><span class="gp">$</span> mkdir app/views/pages
</pre></div><p>Any view files we add to this directory will automatically use the default application layout and appear when we use a <span class="caps">URL</span> that contains the filename.</p>
<p>The HighVoltage gem contains all the controller and routing magic required for this to happen.</p>
<p>Let’s try it out.</p>
<h3 id="about-page">“About” Page</h3>
<p>Create a file <strong>app/views/pages/about.html.erb</strong>:</p>
<div class="highlight"><pre><span class="x">&lt;h3&gt;About Foobar Kadigan&lt;/h3&gt;</span>
<span class="x">&lt;p&gt;He was born in Waikikamukau, New Zealand. He left New Zealand for England, excelled at the University of Mopery, and served in the Royal Loamshire Regiment. While in service, he invented the kanuten valve used in the processing of unobtainium for industrial use. He founded Acme Manfacturing, later acquired by the Advent Corporation, to commercialize the product. Mr. Kadigan is now retired and lives in Middlehampton where he raises Griadium frieda.&lt;/p&gt;</span>
<span class="x">&lt;p&gt;His favorite quotation is:&lt;/p&gt;</span>
<span class="x">&lt;p&gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.&lt;/p&gt;</span>
</pre></div><p>Our simple “About” view will be combined with the default application layout by the HighVoltage gem.</p>
<h3 id="contact-page">Contact Page</h3>
<p>For the initial version of the Contact page, create a file <strong>app/views/pages/contact.html.erb</strong>:</p>
<div class="highlight"><pre><span class="x">&lt;h3&gt;Contact&lt;/h3&gt;</span>
</pre></div><p>This is a placeholder page we’ll use to test the navigation link we’ve already created.</p>
<h3 id="routing-for-the-highvoltage-gem">Routing for the HighVoltage Gem</h3>
<p>The HighVoltage gem provides a PagesController. You’ll never see it; it is packaged inside the gem.</p>
<p>In addition to providing a controller, the HighVoltage gem provides default routing so any <span class="caps">URL</span> with the form <a href="http://localhost:3000/pages/about">http://localhost:3000/pages/about</a> will obtain a view from the <strong>app/views/pages</strong> directory.</p>
<p>Like the PagesController, the code that sets up the route is packaged inside the gem. If we wanted to add the route explicitly to the file <strong>config/routes.rb</strong>, the file would look like this:</p>
<div class="highlight"><pre><span class="ss">LearnRails</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"/pages/*id"</span> <span class="o">=&gt;</span> <span class="s1">'pages#show'</span>
  <span class="n">root</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s1">'home#index'</span>
<span class="k">end</span>
</pre></div><p>Again, you don’t need to add the code above because the HighVoltage gem already provides the route.</p>
<p>For details about the syntax of routing directives, refer to <a href="http://guides.rubyonrails.org/routing.html">RailsGuides: Routing from the Outside In</a>.</p>
<p>You can use a Rails route helper to create a link to any view in the <strong>app/views/pages</strong> directory like this:</p>
<div class="highlight"><pre><span class="x">link_to 'About', page_path('about')</span>
</pre></div><p>We already have links to the “About” and Contact pages in the navigation partial so we can test the application immediately.</p>
<h3 id="test-the-application-5">Test the Application</h3>
<p>The web server may already be running. If not, enter the command:</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>Links to the pages “About” and “Contact” should work.</p>
<h3 id="git-7">Git</h3>
<p>Let’s commit our changes to the Git repository.</p>
<div class="highlight"><pre><span class="gp">$</span> git add -A
<span class="gp">$</span> git commit -m <span class="s2">"add 'about' and 'contact' pages"</span>
<span class="gp">$</span> git push origin master
</pre></div><p>There is nothing more we need for our “About” page.</p>
<p>In the next chapter, we’ll explore two different implementations for the Contact page.</p>
</section>
<section class='chapter' id='contact-form'><h2>Contact Form</h2>
<p>Forms are ubiquitous on the web, to the degree we seldom notice how often they are used for data entry, whether we’re logging into a website or posting a blog comment.</p>
<p>A contact form is common on many websites. If you think about it, contact forms are often unnecessary; simply displaying an email address is sufficient, more convenient, and easier to implement. But building a contact form is an excellent way to learn how to handle user data input. We’ll pretend that our odd client, Mr. Foobar Kadigan, insists that he needs a contact form on his website.</p>
<p>In this chapter, we’ll explore two ways to implement a contact form. The first way will be familiar to anyone who has used <span class="caps">PHP</span> or similar web platforms. It is an obvious and straightforward way to handle a form. As we look closer, we’ll see the approach has limitations. We’ll discard our first approach and rebuild the Contact page, discovering how the “Rails way” is more powerful.</p>
<p>We’re not backing the tutorial application with a database so we won’t store the contact data after the information is submitted. Instead, in a subsequent chapter we’ll learn how to send the contents of the form by email to the website owner.</p>
<h3 id="user-story-2">User Story</h3>
<p>Let’s plan our work with a user story:</p>
<div class="highlight"><pre><span class="nf">*Contact Page*</span>
<span class="nf">As a visitor to the website</span>
<span class="k">I </span><span class="nf">want to fill out a form with my name, email address, and some text</span>
<span class="nf">so I can send a message to the owner of the website</span>
</pre></div><p>Our first step will be to create a route to a controller that will process the submitted form.</p>
<h3 id="routing-2">Routing</h3>
<p>We’re going to create a ContactsController to process the submitted form data. Every form must have a destination <span class="caps">URL</span> that receives the form submission. We need to set a route to generate the destination <span class="caps">URL</span>.</p>
<p>Open the file <strong>config/routes.rb</strong>. Replace the contents with this:</p>
<div class="highlight"><pre><span class="ss">LearnRails</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">post</span> <span class="s1">'contact'</span> <span class="o">=&gt;</span> <span class="s1">'contacts#process_form'</span>
  <span class="n">root</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s1">'home#index'</span>
<span class="k">end</span>
</pre></div><p>The route <code>post 'contact' =&gt; 'contacts#process_form'</code> will create a route helper that generates a <span class="caps">URL</span> and hands off the request to a controller:</p>
<ul>
  <li><code>contact_path</code> – route helper</li>
  <li><code>contacts</code> – name of the controller (ContactsController)</li>
  <li><code>process_form</code> – a controller action we’ll create</li>
  <li><a href="http://localhost:3000/contact">http://localhost:3000/contact</a> – <span class="caps">URL</span> generated by the route helper</li>
  <li><code>POST</code> – <span class="caps">HTTP</span> method to submit form data</li>
</ul>
<p>You can run the <code>rake routes</code> command to see our routes in the console:</p>
<div class="highlight"><pre><span class="gp">$</span> rake routes
<span class="go"> Prefix Verb URI Pattern        Controller#Action</span>
<span class="go">contact POST /contact(.:format) contacts#process_form</span>
<span class="go">   root GET  /                  home#index</span>
<span class="go">   page GET  /pages/*id         high_voltage/pages#show</span>
</pre></div><p>The output of the <code>rake routes</code> command is somewhat cryptic but confirms we’ve created the routes we need.</p>
<p>For details about the syntax of routing directives, refer to <a href="http://guides.rubyonrails.org/routing.html">RailsGuides: Routing from the Outside In</a>.</p>
<p>The route won’t work; we need to create a ContactsController. But first we’ll create the form.</p>
<h3 id="adding-a-form-to-the-contact-page">Adding a Form to the Contact Page</h3>
<p>You’ll recall that we set up the <a href="https://github.com/plataformatec/simple_form">SimpleForm gem</a> when we added Twitter Bootstrap to our application. The SimpleForm gem provides Rails view helpers for forms. You’ll remember that we described Rails view helpers as “macros to generate <span class="caps">HTML</span>.” The SimpleForm gem gives us view helpers to generate all the <span class="caps">HTML</span> required by complex forms. Forms require some of the most complex <span class="caps">HTML</span> a developer will encounter, so the SimpleForm gem is truly worthwhile. You can see a demonstration of <a href="http://simple-form-bootstrap.plataformatec.com.br/">SimpleForm and Twitter Bootstrap</a> for all the possible form elements.</p>
<p>Let’s add the code for a contact form to the Contact page.</p>
<p>Replace the contents of the file <strong>app/views/pages/contact.html.erb</strong>:</p>
<div class="highlight"><pre><span class="x">&lt;h3&gt;Contact&lt;/h3&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">simple_form_for</span> <span class="ss">:contact</span><span class="p">,</span> <span class="ss">url</span><span class="p">:</span> <span class="n">contact_path</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">input</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">autofocus</span><span class="p">:</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">input</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">input</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">:input_html</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:class</span> <span class="o">=&gt;</span> <span class="s2">"span6"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">button</span> <span class="ss">:submit</span><span class="p">,</span> <span class="s1">'Submit'</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'btn-primary'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div><p>The code is compact but complex. We see several elements:</p>
<ul>
  <li><code>simple_form_for</code> is the view helper</li>
</ul>
<p>The <code>simple_form_for</code> view helper instantiates a form object which we assign to a variable named <code>form</code>. SimpleForm offers many standard form elements, such as text fields and submit buttons. Each element is available as a method call on the form object.</p>
<p>The view helper <code>simple_form_for</code> requires <em>parameters</em> and a <em>block</em>.</p>
<p>Every form needs a name and a route in the application that will handle processing of the form data. The parameters are:</p>
<ul>
  <li><code>contact</code> – the name of the form</li>
  <li><code>url</code> – a destination for the form data</li>
</ul>
<p>The <code>simple_form_for</code> view helper accommodates a Ruby block. The block begins with <code>do</code> and closes with <code>end</code>. The code inside the block works just like code inside a method. In this case, the <code>form</code> object is passed to the block and methods belonging to the <code>form</code> object are called to produce <span class="caps">HTML</span> output.</p>
<p>Inside the block, the <code>form</code> object methods generate <span class="caps">HTML</span> for:</p>
<ul>
  <li>a name field</li>
  <li>an email field</li>
  <li>a field for “content”</li>
  <li>a submit button</li>
</ul>
<p>Each of the form methods takes various parameters, such as:</p>
<ul>
  <li><code>autofocus</code> – displays the cursor in the field</li>
  <li><code>required</code> – indicates the field cannot be blank</li>
  <li><code>as: :text</code> – displays a multiline text area</li>
  <li><code>input_html</code> – adds any <span class="caps">HTML</span> such as a <span class="caps">CSS</span> class</li>
  <li><code>class</code> – applies a <span class="caps">CSS</span> class to modify a button’s appearance</li>
</ul>
<p>The structure of the form is clearly visible in the code. The form begins with a <code>simple_form_for</code> helper and closes with the <code>end</code> keyword. Each line of code produces an element in the form such as a field or a button.</p>
<p>This is a common structure for a Rails view helper and it will soon become familiar.</p>
<h3 id="controller-2">Controller</h3>
<p>We need code to process the form data. The form data is sent to the server as a <span class="caps">POST</span> request attached to a <span class="caps">URL</span>. As we’ve learned, in Rails we use controllers to respond to browser requests. For this implementation, we’ll create a ContactsController to process the submitted form data.</p>
<p>Create a file <strong>app/controllers/contacts_controller.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">ContactsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">process_form</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: params are'</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">inspect</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Received request from </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">][</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">redirect_to</span> <span class="n">root_path</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>The ContactsController inherits the behavior of the base ApplicationController.</p>
<p>We create a <code>process_form</code> method to respond when the form is submitted. Later we’ll learn that <code>process_form</code> doesn’t fit the “Rails way.” We’ll use it for now.</p>
<p>Before we look closely at the code for the <code>process_form</code> method, we need to learn about the <code>params</code> hash.</p>
<h4 id="params-hash">Params Hash</h4>
<p>Take a close look at these two lines:</p>
<div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: params are'</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">inspect</span>
<span class="n">message</span> <span class="o">=</span> <span class="s2">"Received request from </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">][</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
</pre></div><p>Notice the <code>params</code> object.</p>
<p>Earlier we learned about the Ruby <em>hash</em> object. It is a data structure for key/value pairs and it is ideal for storing form data. Each field on the form can be mapped as <em>label</em> and <em>data</em>, or key and value, and stored in a hash.</p>
<p>Rails does all the work of extracting the form data from the browser’s <span class="caps">POST</span> request. Rails creates a hash with the form field data mapped to the form field labels and gives the hash the name of the form. Here’s the hash as pure Ruby code:</p>
<div class="highlight"><pre><span class="n">contact</span> <span class="o">=</span> <span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="s1">'Daniel'</span> <span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">'daniel@danielkehoe.com@'</span><span class="p">,</span> <span class="ss">contents</span><span class="p">:</span> <span class="s1">'hi!'</span><span class="p">}</span>
</pre></div><p>Rails goes a step further and nests the form hash inside another hash named <code>params</code>.</p>
<p>As pure Ruby code, the <code>params</code> hash looks like this:</p>
<div class="highlight"><pre><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="ss">controller</span><span class="p">:</span> <span class="s1">'contacts'</span><span class="p">,</span>
          <span class="ss">action</span><span class="p">:</span> <span class="s1">'process_form'</span><span class="p">,</span>
          <span class="ss">contact</span><span class="p">:</span> <span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="s1">'Daniel'</span> <span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">'daniel@danielkehoe.com@'</span><span class="p">,</span> <span class="ss">content</span><span class="p">:</span> <span class="s1">'hi!'</span><span class="p">}</span>
          <span class="p">}</span>
</pre></div><p>The <code>params</code> hash includes these elements (plus others we won’t cover):</p>
<ul>
  <li>current controller</li>
  <li>current action</li>
  <li>form data (our <code>contact</code> hash)</li>
</ul>
<p>You will see the contents of the <code>params</code> hash in the console log after you submit the form. We’ll look at the console log when we test the implementation.</p>
<h4 id="process_form-method">Process_form Method</h4>
<p>Now that we know about the <code>params</code> hash, take a look again at the <code>process_form</code> method:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">process_form</span>
  <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s1">'DEBUG: params are'</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">inspect</span>
  <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Received request from </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">][</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">redirect_to</span> <span class="n">root_path</span>
<span class="k">end</span>
</pre></div><p>We use a <code>logger.debug</code> method to reveal the form data in our console log by calling an <code>inspect</code> method on the <code>params</code> hash.</p>
<p>Then we extract the data posted to the name field of the form and construct a flash message. A hash containing the data from the contact form is nested inside the <code>params</code> hash. We can retrieve the value of the name field with the expression <code>params[:contact][:name]</code>. We use double quotes and string interpolation to form the message using the <code>#{...}</code> syntax that evaluates a Ruby expression and combines it with a string.</p>
<p>Finally we use the <code>redirect_to</code> directive to render the home page.</p>
<p>We haven’t actually sent the contact data to anyone. We’ll add code for that later, after we refactor the controller to be a better example of the “Rails way.” Before we do that, let’s test the current implementation. We’ve already set up routing for the new controller.</p>
<h3 id="test-the-application-6">Test the Application</h3>
<p>You’ve added a new route so you will need to restart the web server. Use control-c to halt the server and then restart with the command:</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>Click the “Contact” link and fill out the form.</p>
<p>Notice the flash message that appears on the home page.</p>
<p>Notice what appears in the console log:</p>
<div class="highlight"><pre><span class="go">Started POST "/contact" for 127.0.0.1 at ...</span>
<span class="go">Processing by ContactsController#process_form as HTML</span>
<span class="go">  Parameters: {"utf8"=&gt;"✓", "authenticity_token"=&gt;"rQJfWNurHbEI3RBj/myfUkcbkeX5cgQ06y4y91Jqthw=", "contact"=&gt;{"name"=&gt;"Daniel Kehoe", "email"=&gt;"daniel@danielkehoe.com", "content"=&gt;"Looking forward to your birthday!"}, "commit"=&gt;"Submit"}</span>
<span class="go">DEBUG: params are{"utf8"=&gt;"✓", "authenticity_token"=&gt;"rQJfWNurHbEI3RBj/myfUkcbkeX5cgQ06y4y91Jqthw=", "contact"=&gt;{"name"=&gt;"Daniel Kehoe", "email"=&gt;"daniel@danielkehoe.com", "content"=&gt;"Looking forward to your birthday!"}, "commit"=&gt;"Submit", "action"=&gt;"process_form", "controller"=&gt;"contacts"}</span>
<span class="go">Redirected to http://localhost:3000/</span>
<span class="go">Completed 302 Found in 0ms (ActiveRecord: 0.0ms)</span>
</pre></div><p>The console log is our most important tool for debugging. Let’s analyze what we see:</p>
<ul>
  <li><em>Started <span class="caps">POST</span></em> – shows the server is responding to an <span class="caps">HTTP</span> <span class="caps">POST</span> request</li>
  <li><em>“/contact”</em> – the path portion of the <span class="caps">URL</span></li>
  <li><em>for 127.0.0.1</em> – the IP address for localhost</li>
  <li><em>at …</em> – timestamp</li>
  <li><em>Processing by ContactsController</em> – the controller</li>
  <li><em>process_form</em> – the controller action (the method that handles the request)</li>
  <li><em>as <span class="caps">HTML</span></em> – not <span class="caps">XML</span> or some other markup</li>
  <li><em>Parameters:</em> – the <code>params</code> hash containing all the submitted data</li>
  <li><em>“utf8”=&gt;"✓"</em> – a Rails 3 workaround to set the language encoding in Internet Explorer</li>
  <li><em>“authenticity token”</em> – prevents <span class="caps">CSRF</span> security exploits</li>
  <li><em>“contact”</em> – a hash containing the form data</li>
  <li><em>“commit”</em> – the “Submit” label from the button</li>
  <li><em><span class="caps">DEBUG</span></em> – our debug message containing the form data</li>
  <li><em>Redirected to http://localhost:3000/</em> – responded by displaying the home page</li>
  <li><em>Completed 302 Found</em> – <span class="caps">HTTP</span> response status code 302 indicating a redirection</li>
  <li><em>in 0ms</em> – time required to process the request</li>
</ul>
<p>That’s a lot of data. For now, we really only care about the form data buried in the <code>params</code> hash.</p>
<p>You can see that we really don’t need the debug message because the console log shows us the contents of the <code>params</code> hash.</p>
<h3 id="the-validation-problem">The Validation Problem</h3>
<p>It looks like we’ve got everything we need to handle a form submission. As a next step, we could implement code to send an email message using form data extracted from the <code>params</code> hash.</p>
<p>But consider a potential problem. What if the email address is poorly formed? The visitor will think the message has been sent but it will never be delivered.</p>
<p>Or what if the name field or message is blank? It’s not just a problem for the hapless visitor. An evildoer could repeatedly click the submit button, filling Foobar Kadigan’s email inbox with endless empty messages.</p>
<p>We need <em>validation</em> of the form data before we process it.</p>
<p>We could dig into the Rails <code>String</code> <span class="caps">API</span> and look for a way to test if the string is empty or contains only whitespaces. And we could raise an <code>Exception</code> if the string is blank.</p>
<p>Here’s what validation code could look like. We won’t use this code (because there’s a better way to do this):</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">ContactsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">process_form</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">][</span><span class="ss">:name</span><span class="o">].</span><span class="n">blank?</span>
      <span class="k">raise</span> <span class="s1">'Name is blank!'</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">][</span><span class="ss">:email</span><span class="o">].</span><span class="n">blank?</span>
      <span class="k">raise</span> <span class="s1">'Email is blank!'</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">][</span><span class="ss">:content</span><span class="o">].</span><span class="n">blank?</span>
      <span class="k">raise</span> <span class="s1">'Message is blank!'</span>
    <span class="k">end</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">"Received request from </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">][</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">:notice</span> <span class="o">=&gt;</span> <span class="n">message</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>We would need additional code to test for invalid email addresses (it will be a complex <em>regex</em>, or <em>regular expression</em>). And we would need a nicer way of showing the error to the visitor (right now, raising the exception displays an error message that makes it appear the application is broken). If we were implementing this on another web application platform, we might go further down this path, googling for code examples, and implementing a lengthy but bulletproof validation function.</p>
<p>Rails offers a better way.</p>
<h3 id="the-old-way-or-the-rails-way">The Old Way or the Rails Way</h3>
<p>Our initial implementation of the contact form is consistent with the earliest approach to web application development, an approach that originated in 1993 with a specification for <span class="caps">CGI</span>, the <a href="http://en.wikipedia.org/wiki/Common_Gateway_Interface">Common Gateway Interface</a>. Before <span class="caps">CGI</span>, every page on the web existed only as a static <span class="caps">HTML</span> file. <span class="caps">CGI</span> made it possible to run a program, or <span class="caps">CGI</span> script, that dynamically generated <span class="caps">HTML</span>. In the early years of the web, every web <span class="caps">URL</span> matched either an <span class="caps">HTML</span> file or a <span class="caps">CGI</span> script. This is the “page paradigm” of the web.</p>
<p>So far, we’re following the “page paradigm.” Our Contact page hosts the form. Clicking the submit button makes a request to another page that is actually a program that returns <span class="caps">HTML</span>. Until the late 1990s, this is how the web worked. But soon after the introduction of <span class="caps">CGI</span>, developers began exploring the possibility of running a single program (an application server) that responds to any <span class="caps">URL</span>, parsing the <span class="caps">URL</span> to establish routing, and generating pages dynamically. This was the genesis of the “web application paradigm.” It’s how Rails works.</p>
<p>The web application paradigm frees us from one-to-one correspondence of a <span class="caps">URL</span> with a single file or script. It allows us to refactor our code into object-oriented classes and methods that can be inherited rather than duplicated, which means we don’t repeat the same code on every page that processes a form.</p>
<p>The web application paradigm makes it possible to use the model-view-controller architecture. Instead of looking at the web as URLs that return pages, we see requests that are routed to controllers that render views. We can segregate any code that manipulates data into a model class, instead of mixing <span class="caps">HTML</span> with data manipulation in a single script. With the “web application paradigm,” we can have a generic model class that isolates the code that connects to a database or validates form data. We can create models that inherit the generic behavior from a parent class and get a database connection or validation “for free.” Unlike the “page paradigm,” we’ll avoid duplicating validation code every time we need to process a form.</p>
<p>Consider our <code>process_form</code> method again:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">ContactsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">process_form</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">][</span><span class="ss">:name</span><span class="o">].</span><span class="n">blank?</span>
      <span class="k">raise</span> <span class="s1">'Name is blank!'</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">][</span><span class="ss">:email</span><span class="o">].</span><span class="n">blank?</span>
      <span class="k">raise</span> <span class="s1">'Email is blank!'</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">][</span><span class="ss">:content</span><span class="o">].</span><span class="n">blank?</span>
      <span class="k">raise</span> <span class="s1">'Message is blank!'</span>
    <span class="k">end</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">"Received request from </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">][</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">:notice</span> <span class="o">=&gt;</span> <span class="n">message</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>Our “segregation of concern” philosophy suggests that validation belongs in a model, since validation is a type of data manipulation (strictly speaking, a test of data integrity). Furthermore, it would be nice to make the validation tests generic so they could be used to validate data submitted from any form.</p>
<p>Rails, as a framework, provides all this for us.</p>
<h3 id="activerecord">ActiveRecord</h3>
<p>Rails extracts and generalizes common code that every website requires. The code that websites need for access to databases is abstracted into the Rails <a href="https://github.com/rails/rails/tree/master/activerecord">ActiveRecord</a> class. ActiveRecord includes code from the <a href="https://github.com/rails/rails/tree/master/activemodel">ActiveModel</a> class that handles interaction with forms and data validation.</p>
<p>The ActiveRecord class interfaces with SimpleForm to provide sophisticated validation and error handling. We can inherit behavior from the ActiveRecord class to add validation and error handling to any model we create.</p>
<p>SimpleForm will recognize ActiveRecord methods if we provide a model as an argument to the SimpleForm view helper. SimpleForm will give the form a name that matches the model name. And SimpleForm will automatically generate a destination <span class="caps">URL</span> for the form based on the model name.</p>
<p>More significantly, SimpleForm will add sophisticated error handling to the form. If a visitor submits a form with a blank name or invalid email address, and we declare in our model that we require validation, SimpleForm will highlight the invalid field and display an inline message indicating the problem. Compared to what we’ve implemented so far, this kind of error handling provides a vastly superior user experience. Instead of displaying a message that the application failed, the form will be redisplayed with the problem marked and noted.</p>
<p>Now that we’ve seen the advantages of the “Rails way,” let’s re-implement our contact form using the model-view-controller architecture.</p>
<h3 id="model-2">Model</h3>
<p>When we build database-backed applications with Rails, we base our models on a parent class named ActiveRecord. We are not using a database for our tutorial application, so we’ll use the <a href="https://github.com/softace/activerecord-tableless">activerecord-tableless</a> gem to disable the database features of ActiveRecord.</p>
<p><em>Note:</em> There’s a way to create a model without a database using only the <a href="https://github.com/rails/rails/tree/master/activemodel">ActiveModel</a> class, described in the <a href="http://railscasts.com/episodes/219-active-model">RailsCasts: ActiveModel</a> screencast. Either approach is fine; we’re using the activerecord-tableless gem because it is easier to explain.</p>
<p>Let’s set up a model that inherits from ActiveRecord.</p>
<p>Create a file <strong>app/models/contact.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Contact</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
  <span class="n">has_no_table</span>

  <span class="n">column</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="n">column</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="n">column</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:string</span>

  <span class="n">validates_presence_of</span> <span class="ss">:name</span>
  <span class="n">validates_format_of</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="sr">/^[-a-z0-9_+\.]+\@([-a-z0-9]+\.)+[a-z0-9]{2,4}$/i</span>
  <span class="n">validates_length_of</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">500</span>

<span class="k">end</span>
</pre></div><p>We give the model the name “Contact” and inherit from the ActiveRecord class.</p>
<p>We use the <code>has_no_table</code> directive from the activerecord-tableless gem to disable database features of ActiveRecord.</p>
<p>We specify attributes (data fields) for the model by using the <code>column</code> keyword from the activerecord-tableless gem. These match the fields in the contact form.</p>
<p>ActiveRecord gives us validation methods named <code>validates_presence_of</code>, <code>validates_format_of</code>, and <code>validates_length_of</code>. We check that <code>name</code> exists (it can’t be blank). We provide a complex <em>regex</em>, or <em>regular expression</em>, to test if the email address is valid. Finally, we declare that the message content cannot exceed 500 characters.</p>
<p>The model is elegant. We describe the fields we need and state our validation requirements. ActiveRecord does all the rest.</p>
<p>Let’s change our contact form to use our new model.</p>
<h3 id="remove-the-contact-page">Remove the Contact Page</h3>
<p>We’re implementing a model-view-controller architecture for our Contact feature. That means we have a Contact model, a ContactsController, and we’ll need view files in the <strong>app/views/contacts/</strong> folder.</p>
<p>Start by removing the file <strong>app/views/pages/contact.html.erb</strong>.</p>
<div class="highlight"><pre><span class="gp">$</span> rm app/views/pages/contact.html.erb
</pre></div><p>In a minute, we’ll replace it with a file in the <strong>app/views/contacts/</strong> folder.</p>
<p>Let’s create the <strong>app/views/contacts/</strong> folder:</p>
<div class="highlight"><pre><span class="gp">$</span> mkdir app/views/contacts/
</pre></div><h3 id="change-navigation-links">Change Navigation Links</h3>
<p>Now that we’ve removed the file <strong>app/views/pages/contact.html.erb</strong>, we’ll change the navigation links.</p>
<p>Change the file <strong>app/views/layouts/_navigation.html.erb</strong>:</p>
<div class="highlight"><pre><span class="x">&lt;ul class="nav"&gt;</span>
<span class="x">  &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Home'</span><span class="p">,</span> <span class="n">root_path</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="x">  &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'About'</span><span class="p">,</span> <span class="n">page_path</span><span class="p">(</span><span class="s1">'about'</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="x">  &lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Contact'</span><span class="p">,</span> <span class="n">new_contact_path</span> <span class="cp">%&gt;</span><span class="x">&lt;/li&gt;</span>
<span class="x">&lt;/ul&gt;</span>
</pre></div><p>Our new route <code>new_contact_path</code> doesn’t yet exist. We’ll complete our move to the model-view-controller architecture by adding the appropriate routes.</p>
<p>Next we’ll add a new Contact page.</p>
<h3 id="create-a-new-contact-page">Create a New Contact Page</h3>
<p>Earlier, I said SimpleForm configures itself if we provide a model that inherits from ActiveRecord. SimpleForm gives the form a name that matches the model name. And SimpleForm generates a destination <span class="caps">URL</span> based on the model name.</p>
<p>We’ll soon create a controller that assigns the Contact model to the <code>@contact</code> instance variable. We’ll use that as an argument for the SimpleForm view helper: <code>simple_form_for @contact do |form| ... end</code>.</p>
<p>We’ll also add an <code>error_notification</code> method provided by the form object.</p>
<p>Create a file <strong>app/views/contacts/new.html.erb</strong>:</p>
<div class="highlight"><pre><span class="x">&lt;h3&gt;Contact&lt;/h3&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">simple_form_for</span> <span class="vi">@contact</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">error_notification</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">input</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">autofocus</span><span class="p">:</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">input</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">required</span><span class="p">:</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">input</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">:input_html</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:class</span> <span class="o">=&gt;</span> <span class="s2">"span6"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">form</span><span class="o">.</span><span class="n">button</span> <span class="ss">:submit</span><span class="p">,</span> <span class="s1">'Submit'</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'btn-primary'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div><p>We’re now providing only one argument, the <code>@contact</code> instance variable, to the SimpleForm view helper. That’s enough to generate the form name and destination <span class="caps">URL</span>.</p>
<p>We’ve added the <code>error_notification</code> method which provides all the error handling. The method call is very simple but the results will be impressive.</p>
<p>We’ll need a controller and routing to complete our model-view-controller architecture. But first, we’ll detour to learn about seven standard controller actions.</p>
<h3 id="seven-controller-actions">Seven Controller Actions</h3>
<p>Consider all the possibilities for managing a list. It’s a list of anything: users, inventory, thingamajigs. We use a web application to manage the list, so we’ll fill out a form to record each item in our list.</p>
<p>The web application offers seven features to help us manage our records:</p>
<ul>
  <li><strong><em>index</em></strong> – display a list of all items</li>
  <li><strong><em>show</em></strong> – display a record of one item</li>
  <li><strong><em>new</em></strong> – display an empty form</li>
  <li><strong><em>create</em></strong> – save a record of a new item</li>
  <li><strong><em>edit</em></strong> – display a record for editing</li>
  <li><strong><em>update</em></strong> – save an edited record</li>
  <li><strong><em>destroy</em></strong> – delete a record</li>
</ul>
<p>You can manage any list using these seven actions. There are a few extra actions that are helpful, such as:</p>
<ul>
  <li><em>pagination</em> – displaying a portion of a list</li>
  <li><em>sorting</em> – displaying the list in a different order</li>
  <li><em>bulk edit</em> – changing multiple items at once</li>
</ul>
<p>But seven basic actions are all you need for managing any list of items.</p>
<p>The “Rails way” is about taking advantage of structure and convention to leverage the power of the framework.</p>
<p>The ApplicationController contains code to implement each of the seven standard actions. When we create a controller that inherits from the ApplicationController, we get these standard actions “for free.” That’s why our <code>index</code> method in our HomeController was so simple. The controller knew to render a view file named <strong>index.html.erb</strong> from the <strong>views/home/</strong> folder because of behavior inherited from the ApplicationController.</p>
<p>Just like the Rails directory structure provides consistency to make it easy for any Rails developer to collaborate with other Rails developers, relying on the seven standard controller actions makes it easy for other team members to understand how your controllers work.</p>
<p>When necessary, you will add other controller actions. For example, imagine you’ve built a subscription website. When a user’s subscription ends, you may not want to <code>destroy</code> the subscriber record. Instead you might add a controller <code>expire</code> or <code>suspend</code> action that marks the subscriber record as expired so you can continue to access the subscriber’s contact information for customer service or renewal offers. To the extent you can, use the seven standard controller actions and be cautious about adding more.</p>
<p>Earlier, I said our ContactsController <code>process_form</code> method isn’t suitable for the “Rails way.” With our model-view-controller architecture, we can piggyback on the ApplicationController to display our empty contact form and process the form when it is submitted.</p>
<p>We’ll use only two of the seven standard controller actions:</p>
<ul>
  <li><strong><em>new</em></strong> – display the empty contact form</li>
  <li><strong><em>create</em></strong> – validate and process the submitted form</li>
</ul>
<p>Our ContactsController will know to render a view from the <strong>app/views/contacts/new.html.erb</strong> file when we call the controller <code>new</code> method.</p>
<p>We won’t piggyback on behavior from the ApplicationController <code>create</code> method. But we’ll implement a <code>create</code> method because, by convention, the form will submit the data to the controller’s <code>create</code> method. SimpleForm will create a destination <span class="caps">URL</span> that corresponds to the ContactsController#create action.</p>
<h3 id="controller-3">Controller</h3>
<p>Replace the contents of the file <strong>app/controllers/contacts_controller.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">ContactsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@contact</span> <span class="o">=</span> <span class="no">Contact</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@contact</span> <span class="o">=</span> <span class="no">Contact</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">]</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@contact</span><span class="o">.</span><span class="n">valid?</span>
      <span class="c1"># TODO send message here</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Message sent from </span><span class="si">#{</span><span class="vi">@contact</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">."</span>
      <span class="n">redirect_to</span> <span class="n">root_path</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div><p>We’ve dropped the “old school” <code>process_form</code> method and added the “Rails way” <code>new</code> and <code>create</code> methods.</p>
<p>The controller <code>new</code> action will instantiate an empty Contact model, assign it to the <code>@contact</code> instance variable, and render the <strong>app/views/contacts/new.html.erb</strong> view. We’ve already created the view file containing the form.</p>
<p>SimpleForm will set a destination <span class="caps">URL</span> that corresponds to the ContactsController#create action. The <code>create</code> method will instantiate a new Contact model and pass the <code>params[:contact]</code> hash to the model. We don’t need any code in the Contact model to retrieve parameters from the hash; the ActiveRecord parent class provides the code “for free.”</p>
<p>The ActiveRecord parent class also provides a method <code>valid?</code> which we can call on the Contact model. Our conditional statement <code>if @contact.valid?</code> checks each of the validation requirements we’ve set in the model.</p>
<p>If all the Contact fields are valid, we can send a message (not yet implemented), prepare a flash message, and redirect to the home page. Notice that we don’t need to dig into the <code>params</code> hash for the visitor’s name; it is now available as <code>@contact.name</code> directly from the model.</p>
<p>If any validation fails, the controller <code>create</code> action will render the <strong>app/views/contacts/new.html.erb</strong> view. This time, appropriate error messages are set and the form object’s <code>error_notification</code> method will highlight the invalid field and display a matching prompt.</p>
<p>You’re looking at the tightly bound interaction of the “Rails way” model, view, and controller.</p>
<p>The only element we are missing is routing.</p>
<h3 id="routing-3">Routing</h3>
<p>Rails routing is aware of the seven standard controller actions.</p>
<p>In fact, it takes only one keyword (with one parameter) to generate seven different routes for any controller.</p>
<p>The keyword is <code>resources</code> and supplying a name that matches model and controller provides all seven routes.</p>
<p>Open the file <strong>config/routes.rb</strong>. Replace the contents with this:</p>
<div class="highlight"><pre><span class="ss">LearnRails</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:contacts</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="o">]</span>
  <span class="n">root</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s1">'home#index'</span>
<span class="k">end</span>
</pre></div><p>Here we’ve added <code>resources :contacts, only: [:new, :create]</code>.</p>
<p>We only want two routes so we’ve added the restriction <code>only: [:new, :create]</code>.</p>
<p>The <code>new</code> route has these properties:</p>
<ul>
  <li><code>new_contact_path</code> – route helper</li>
  <li><code>contacts</code> – name of the controller (ContactsController)</li>
  <li><code>new</code> – controller action</li>
  <li><a href="http://localhost:3000/contacts/new">http://localhost:3000/contacts/new</a> – <span class="caps">URL</span> generated by the route helper</li>
  <li><code>GET</code> – <span class="caps">HTTP</span> method to display a page</li>
</ul>
<p>The <code>create</code> route has these properties:</p>
<ul>
  <li><code>contacts_path</code> – route helper</li>
  <li><code>contacts</code> – name of the controller (ContactsController)</li>
  <li><code>create</code> – controller action</li>
  <li><a href="http://localhost:3000/contacts">http://localhost:3000/contacts</a> – <span class="caps">URL</span> generated by the route helper</li>
  <li><code>POST</code> – <span class="caps">HTTP</span> method to submit form data</li>
</ul>
<p>You can run the <code>rake routes</code> command to see these in the console:</p>
<div class="highlight"><pre><span class="gp">$</span> rake routes
<span class="go">     Prefix Verb URI Pattern             Controller#Action</span>
<span class="go">   contacts POST /contacts(.:format)     contacts#create</span>
<span class="go">new_contact GET  /contacts/new(.:format) contacts#new</span>
<span class="go">       root GET  /                       home#index</span>
<span class="go">       page GET  /pages/*id              high_voltage/pages#show</span>
</pre></div><p>The output of the <code>rake routes</code> command shows we’ve created the routes we need.</p>
<p>We’re ready to test the model-view-controller implementation of the Contact feature.</p>
<h3 id="test-the-application-7">Test the Application</h3>
<p>Stop the web server with Control-c and restart:</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>Click the “Contact” link and fill out the form.</p>
<p>Notice the flash message that appears on the home page.</p>
<p>Try submitting the form with a blank name or invalid email address.</p>
<p>You’ll see a form validation error message.</p>
<h3 id="git-8">Git</h3>
<p>Let’s commit our changes to the Git repository.</p>
<div class="highlight"><pre><span class="gp">$</span> git add -A
<span class="gp">$</span> git commit -m <span class="s2">"contact form"</span>
<span class="gp">$</span> git push origin master
</pre></div><p>We’ve built a sophisticated Contact form. Now let’s add the code to email the form data to our client.</p>
</section>
<section class='chapter' id='sending-mail'><h2>Sending Mail</h2>
<p>Article: <a href="http://guides.rubyonrails.org/action_mailer_basics.html">RailsGuides: Action Mailer Basics</a></p>
<h3 id="create-email-message">Create Email Message</h3>
<p>Generate a mailer with accompanying views:</p>
<div class="highlight"><pre><span class="gp">$</span> rails generate mailer UserMailer
</pre></div><p>Add a <code>contact_email</code> method to the mailer by editing the file <strong>app/mailers/user_mailer.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="ss">ActionMailer</span><span class="p">:</span><span class="ss">:Base</span>
  <span class="n">default</span> <span class="ss">:from</span> <span class="o">=&gt;</span> <span class="s2">"notifications@example.com"</span>

  <span class="k">def</span> <span class="nf">contact_email</span><span class="p">(</span><span class="n">contact</span><span class="p">)</span>
    <span class="vi">@contact</span> <span class="o">=</span> <span class="n">contact</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s2">"notifications@example.com"</span><span class="p">,</span> <span class="ss">:subject</span> <span class="o">=&gt;</span> <span class="s2">"Website Contact"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div><p>Replace the “notifications@example.com” string with your email address. You’ll need to <strong>replace it in <span class="caps">TWO</span> places</strong>.</p>
<p>Create a mailer view by creating a file <strong>app/views/user_mailer/contact_email.html.erb</strong>. This will be the template used for the email, formatted in <span class="caps">HTML</span>:</p>
<div class="highlight"><pre><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">  &lt;head&gt;</span>
<span class="x">    &lt;meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /&gt;</span>
<span class="x">  &lt;/head&gt;</span>
<span class="x">  &lt;body&gt;</span>
<span class="x">    &lt;h1&gt;Website Contact&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;</span>
<span class="x">      This visitor requested contact:</span>
<span class="x">    &lt;/p&gt;</span>
<span class="x">    &lt;p&gt;</span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="vi">@contact</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">&lt;br/&gt;</span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="vi">@contact</span><span class="o">.</span><span class="n">email</span> <span class="cp">%&gt;</span><span class="x">&lt;br/&gt;</span>
<span class="x">    &lt;/p&gt;</span>
<span class="x">    &lt;p&gt;</span>
<span class="x">      The visitor said:</span>
<span class="x">    &lt;/p&gt;</span>
<span class="x">    &lt;p&gt;</span>
<span class="x">      "</span><span class="cp">&lt;%=</span> <span class="vi">@contact</span><span class="o">.</span><span class="n">content</span> <span class="cp">%&gt;</span><span class="x">"</span>
<span class="x">    &lt;/p&gt;</span>
<span class="x">  &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div><h3 id="modify-controller">Modify Controller</h3>
<p>Replace the contents of the file <strong>app/controllers/contacts_controller.rb</strong>:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">ContactsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@contact</span> <span class="o">=</span> <span class="no">Contact</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@contact</span> <span class="o">=</span> <span class="no">Contact</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:contact</span><span class="o">]</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@contact</span><span class="o">.</span><span class="n">valid?</span>
      <span class="c1"># send message here</span>
      <span class="no">UserMailer</span><span class="o">.</span><span class="n">contact_email</span><span class="p">(</span><span class="vi">@contact</span><span class="p">)</span><span class="o">.</span><span class="n">deliver</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Message sent from </span><span class="si">#{</span><span class="vi">@contact</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">."</span>
      <span class="n">redirect_to</span> <span class="n">root_path</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:action</span> <span class="o">=&gt;</span> <span class="s1">'new'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div><h3 id="update-configuration-file">Update Configuration File</h3>
<p>You’ll need a Gmail account if you want to try sending real email.</p>
<p>If you don’t have a Gmail account, you can sign up for an account with <a href="http://mandrill.com/">Mandrill</a> instead and follow instructions in the article <a href="http://railsapps.github.io/rails-send-email.html">Send Email with Rails</a>.</p>
<p>You’ll need to add your Gmail username and password to the file <strong>config/application.yml</strong>. Change this to your real username and password:</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">GMAIL_USERNAME</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Your_Username</span>
<span class="l-Scalar-Plain">GMAIL_PASSWORD</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Your_Password</span>
</pre></div><h3 id="configure-email">Configure Email</h3>
<p>Article: <a href="http://railsapps.github.io/rails-send-email.html">Send Email with Rails</a></p>
<p>Email messages are visible in the console and the log file when you test the application.</p>
<p>If you want to send real messages when you test the application in development mode, modify the file <strong>config/environments/development.rb</strong>.</p>
<p>Add this:</p>
<div class="highlight"><pre><span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">smtp_settings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">address</span><span class="p">:</span> <span class="s2">"smtp.gmail.com"</span><span class="p">,</span>
  <span class="ss">port</span><span class="p">:</span> <span class="mi">587</span><span class="p">,</span>
  <span class="ss">domain</span><span class="p">:</span> <span class="s2">"example.com"</span><span class="p">,</span>
  <span class="ss">authentication</span><span class="p">:</span> <span class="s2">"plain"</span><span class="p">,</span>
  <span class="n">enable_starttls_auto</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
  <span class="n">user_name</span><span class="p">:</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">"GMAIL_USERNAME"</span><span class="o">]</span><span class="p">,</span>
  <span class="ss">password</span><span class="p">:</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">"GMAIL_PASSWORD"</span><span class="o">]</span>
<span class="p">}</span>
</pre></div><p>Change the statement:</p>
<div class="highlight"><pre><span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">perform_deliveries</span> <span class="o">=</span> <span class="kp">false</span>
</pre></div><p>to:</p>
<div class="highlight"><pre><span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">perform_deliveries</span> <span class="o">=</span> <span class="kp">true</span>
</pre></div><p>and when you try the application, a real message will be sent.</p>
<h3 id="test-the-application-8">Test the Application</h3>
<p>If your web server is not running, restart it:</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>Click the “Contact” link try submitting the form.</p>
<p>The email message should be visible in the console.</p>
<p>You’ll should get a real email message in your inbox if you set up your <strong>config/environments/development.rb</strong> file to perform deliveries.</p>
<h3 id="git-9">Git</h3>
<p>Let’s commit our changes to the Git repository.</p>
<div class="highlight"><pre><span class="gp">$</span> git add -A
<span class="gp">$</span> git commit -m <span class="s2">"sending mail"</span>
<span class="gp">$</span> git push origin master
</pre></div>
</section>
<section class='chapter' id='mailing-list'><h2>Mailing List</h2>
<h3 id="modify-controller-2">Modify Controller</h3>
<h3 id="flash-message">Flash Message</h3>
</section>
<section class='chapter' id='deploy'><h2>Deploy</h2>
<h3 id="cleanup">Cleanup</h3>
<p>Several unneeded files are generated in the process of creating a new Rails application.</p>
<p>Additionally, you may want to prevent search engines from indexing your website if you’ve deployed it publicly while still in development.</p>
<p>See instructions for <a href="http://railsapps.github.io/rails-cleanup.html">cleaning up unneeded files in Rails and banning spiders</a>.</p>
<h3 id="test-the-app">Test the App</h3>
<p>You can check that your app runs properly by entering the command</p>
<div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div><p>To see your application in action, open a browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>Stop the server with Control-C.</p>
<h3 id="testing">Testing</h3>
<p>If you’ve copied the RSpec unit tests and Cucumber integration tests from the  <a href="http://github.com/RailsApps/learn-rails/">learn-rails</a> example application, and set up RSpec and Cucumber, you can run <code>rake -T</code> to check that rake tasks for RSpec and Cucumber are available.</p>
<p>Run <code>rake spec</code> to run RSpec tests.</p>
<p>Run <code>rake cucumber</code> (or more simply, <code>cucumber</code>) to run Cucumber scenarios.</p>
<h3 id="deploy-to-heroku">Deploy to Heroku</h3>
<p>For your convenience, here is a <a href="http://railsapps.github.io/rails-heroku-tutorial.html">Tutorial for Rails on Heroku</a>. Heroku provides low cost, easily configured Rails application hosting.</p>
<p>Be sure to set up <span class="caps">SSL</span> before you make your application available in production. See the <a href="https://devcenter.heroku.com/articles/ssl">Heroku documentation on <span class="caps">SSL</span></a>.</p>
<p>Add this configuration parameter to the <strong>config/application.rb</strong> file:</p>
<div class="highlight"><pre><span class="c1"># Heroku requires this to be false</span>
<span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">initialize_on_precompile</span><span class="o">=</span><span class="kp">false</span>
</pre></div><p>Then precompile assets, commit to git, and push to Heroku:</p>
<div class="highlight"><pre><span class="gp">$</span> rake assets:precompile
<span class="gp">$</span> git add -A
<span class="gp">$</span> git commit -m <span class="s2">"assets compiled for Heroku"</span>
<span class="gp">$</span> git push heroku master
</pre></div><p>You’ll need to set the configuration values from the <strong>config/application.yml</strong> file as Heroku environment variables. See the article <a href="http://railsapps.github.io/rails-environment-variables.html">Rails Environment Variables</a> for more information.</p>
<p>With the figaro gem, just run:</p>
<div class="highlight"><pre><span class="gp">$</span> rake figaro:heroku
</pre></div><p>Alternatively, you can set Heroku environment variables directly.</p>
<p>Here’s how to set environment variables directly on Heroku with <code>heroku config:add</code>.</p>
<div class="highlight"><pre><span class="gp">$</span> heroku config:add <span class="nv">GMAIL_USERNAME</span><span class="o">=</span><span class="s1">'myname@gmail.com'</span> <span class="nv">GMAIL_PASSWORD</span><span class="o">=</span><span class="s1">'secret'</span>
<span class="gp">$</span> heroku config:add <span class="s1">'ROLES=[admin, user, VIP]'</span>
<span class="gp">$</span> heroku config:add <span class="nv">ADMIN_NAME</span><span class="o">=</span><span class="s1">'First User'</span> <span class="nv">ADMIN_EMAIL</span><span class="o">=</span><span class="s1">'user@example.com'</span> <span class="nv">ADMIN_PASSWORD</span><span class="o">=</span><span class="s1">'changeme'</span>
</pre></div><p>Complete Heroku deployment with:</p>
<div class="highlight"><pre><span class="gp">$</span> heroku run rake db:migrate
<span class="gp">$</span> heroku run rake db:seed
</pre></div><p>See the <a href="http://railsapps.github.io/rails-heroku-tutorial.html">Tutorial for Rails on Heroku</a> for details.</p>
</section>
<section class='chapter' id='landing-pages'><h2>Landing Pages</h2>
</section>
<section class='chapter' id='analytics'><h2>Analytics</h2>
<h3 id="introducing-javascript">Introducing JavaScript</h3>
<h3 id="google-analytics">Google Analytics</h3>
<h3 id="segment-io">segment.io</h3>
<h3 id="tracking-user-actions">tracking user actions</h3>
<h3 id="conversion-testing">Conversion Testing</h3>
</section>
<section class='chapter' id='traffic'><h2>Traffic</h2>
<h3 id="marketing-plan">marketing plan</h3>
<h3 id="advertising">advertising</h3>

    <ul>
      <li>AdWords</li>
    </ul><h3 id="search-engine-marketing">search engine marketing</h3>

    <ul>
      <li>keywords</li>
    </ul>
    <ul>
      <li>landing pages</li>
    </ul>
    <ul>
      <li>link building</li>
    </ul><h3 id="social-marketing">social marketing</h3>
</section>
<section class='chapter' id='whats-next'><h2>What’s Next?</h2>
</section>
<section class='chapter' id='comments'><h2>Comments</h2>
<h3 id="credits">Credits</h3>
<p>Daniel Kehoe implemented the application and wrote the tutorial.</p>
<h3 id="did-you-like-the-tutorial">Did You Like the Tutorial?</h3>
<p>Was this useful to you? Follow <a href="http://twitter.com/rails_apps">rails_apps</a> on Twitter and tweet some praise. I’d love to know you were helped out by the tutorial.</p>
<p>Any issues? Please create an <a href="http://github.com/RailsApps/learn-rails/issues">issue</a> on GitHub. Reporting (and patching!) issues helps everyone.</p>
</section>
<div class='comments'>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'railsapps'; // required: replace example with your forum shortname
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">Comments disabled.</a>
</div><!-- class="comments" -->
    </div>
  </div>
</div>
<footer class="footer">
  <div class="footer-constrain">
    <p>Code licensed under the <a href="http://www.opensource.org/licenses/mit-license" target="_blank">MIT License</a>.<br />Use of the tutorials is restricted to registered users of the RailsApps Tutorials website.</p>
    <ul class="footer-links">
      <li><a href="https://tutorials.railsapps.org/pages/support#Privacy">Privacy</a></li>
      <li class="muted">&middot;</li>
      <li><a href="https://tutorials.railsapps.org/pages/support#Legal">Legal</a></li>
      <li class="muted">&middot;</li>
      <li><a href="https://tutorials.railsapps.org/pages/support">Support</a></li>
    </ul>
  </div>
</footer>
</body>
</html>
