<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Updating Rails &#183; RailsApps</title>
    <link href="https://plus.google.com/u/0/b/117374718581973393536/117374718581973393536/posts/" rel="publisher" />
    <link rel="stylesheet" href="http://railsapps.github.com/css/bootstrap.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="http://railsapps.github.com/css/screen.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="http://railsapps.github.com/css/gollum.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="http://railsapps.github.com/css/site.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="http://railsapps.github.com/css/syntax.css" type="text/css" charset="utf-8" />
    <script src="http://code.jquery.com/jquery-1.6.min.js" type="text/javascript"></script>
    <script src="http://railsapps.github.com/javascript/jquery.text_selection-1.0.0.min.js" type="text/javascript"></script>
    <script src="http://railsapps.github.com/javascript/jquery.previewable_comment_form.js" type="text/javascript"></script>
    <script src="http://railsapps.github.com/javascript/jquery.tabs.js" type="text/javascript"></script>
    <script src="http://railsapps.github.com/javascript/gollum.js" type="text/javascript"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-5109366-14']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body>

  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a href="http://railsapps.github.com/" class="brand">RailsApps Project</a>
        <ul class="pull-right nav">
          <li><a href="https://tutorials.railsapps.org/" class="google">Tutorials</a></li>
          <li><a href="http://twitter.com/rails_apps" class="twitter">Twitter</a></li>
          <li><a href="http://blog.railsapps.org/" class="twitter">Blog</a></li>
          <li><a href="https://github.com/RailsApps" class="github">GitHub Repository</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container">

    <div class="content wikistyle gollum textile">
      <h1>Updating Rails</h1>
<h4>by Daniel Kehoe</h4>
<p><em>Last updated 28 February 2013</em></p>
<p>Installing Rails 3.2 and Rails 4.0, managing versions, and updating a Rails application.</p>
<p>If you’re a Rails developer, you really don’t want to replace an old version of Rails with another. Instead, you’ll want to install multiple versions of Rails and switch between them as you step through the process of updating your Rails applications. This article describes how to update a Rails application. Before you start, follow the steps detailed in the “Installing Rails” article to install multiple versions of Rails:</p>
<ul>
	<li><a href="http://railsapps.github.com/installing-rails.html">Installing Rails</a></li>
</ul>
<p>The <a href="http://railsapps.github.com/installing-rails.html">Installing Rails</a> article will show you how to install Rails 3.2.12, Rails 3.2.13.rc1, and Rails 4.0 so you can easily switch between the most recent stable release, a version of Rails patched for Ruby 2.0, and the newest version of Rails (Rails 4.0.0.beta1). With these versions on your machine, you’ll be able to begin updating your Rails applications.</p>
<p>This is a guide for developers using the example applications from the <a href="http://railsapps.github.com/">RailsApps</a> project. Others may find it helpful as well.</p>
<p><a href="http://www.twitter.com/rails_apps"><img src="http://twitter-badges.s3.amazonaws.com/t_logo-a.png" title="Follow on Twitter" alt="Follow on Twitter"></a> Follow <a href="http://twitter.com/rails_apps">@rails_apps</a> on Twitter for updates and timely Rails tips.</p>
<h2>When to Update Rails</h2>
<p>You should upgrade your Rails applications when a new version of Rails is released. Occasionally a critical security fix is released. If you neglect to update regularly, upgrading several versions at once may require considerable effort, making it difficult to resolve security vulnerabilities quickly. If you avoid updating Rails, you could leave your application and its server open to security vulnerabilities (for example, applications that have not been updated to Rails 3.2.12 are open to attack). If you cannot upgrade Rails regularly, at least stay informed of changes in each release and be prepared to upgrade through multiple versions if a security fix is released.</p>
<h2>Don’t Just Update Rails</h2>
<p>Developers often install the newest version of Rails but neglect other components needed for Rails to run successfully. Rails is not just a Ruby gem, it is a complex and rapidly evolving ecosystem. It is important to deploy with the most current version of Rails. It is just as important to set up your development environment with the most current version of the gems that are needed for development.</p>
<p>You should have:</p>
<ul>
	<li>RubyGems 2.0.0 — <a href="https://rubygems.org/gems/rubygems-update">newest RubyGems system gem</a>
</li>
	<li>Rake 10.0.3 — <a href="http://rubygems.org/gems/rake">newest Rake gem</a>
</li>
	<li>Bundler 1.3.0 — <a href="https://rubygems.org/gems/bundler">newest Bundler gem</a>
</li>
	<li>Rubygems-Bundler 1.1.1 — <a href="http://rubygems.org/gems/rubygems-bundler">newest version of Rubygems-Bundler</a>
</li>
</ul>
<p>Check the gem versions:</p>
<pre>
$ gem -v
</pre>
<p>Use <code>gem update --system</code> to upgrade the RubyGems system gem.</p>
<pre>
$ gem list
</pre>
<p>Use <code>gem update rake</code> to upgrade Rake.</p>
<p>Use <code>gem update bundler</code> to upgrade Bundler.</p>
<p>Use <code>gem update rubygems-bundler</code> to upgrade Rubygems-Bundler.</p>
<p>See the article <a href="http://railsapps.github.com/installing-rails.html">Installing Rails</a> for complete instructions on preparing the development environment.</p>
<p>You can track updates to gems by creating an account and visiting your <a href="https://rubygems.org/dashboard">dashboard</a> at the RubyGems.org site. Search for each gem you use and “subscribe” to see a feed of updates in the dashboard (an <span class="caps">RSS</span> feed is available from the dashboard). As an alternative, use the <a href="https://gemnasium.com/">Gemnasium</a> service which surveys your GitHub repo and sends email notifications when gem versions change. Gemnasium is free for public repositories with a premium plan for private repositories.</p>
<h2>Learn What’s Changed</h2>
<p>Before you update Rails, take time to find out if the default new Rails application has changed. Using the older version of Rails that is installed on your computer, run <code>rails new myapp_old</code> to create a new Rails application. After updating Rails, run <code>rails new myapp_new</code> and compare the two applications with a file compare tool. You can also run <code>rake rails:update</code> to find how configuration files changed between versions.</p>
<p>Minor Rails version updates seldom change the default new Rails application. Major Rails updates often make many changes. You’ll be able to see the changes by comparing the old and new default Rails applications.</p>
<h2>Simple Rails Update</h2>
<p>You can run <code>gem update rails</code> to get a newer version of the Rails gem. This approach replaces the version of Rails in your development environment. It’s better to use <span class="caps">RVM</span>, the <a href="https://rvm.io/">Ruby Version Manager</a>, as described below, so you can switch between Rails versions. If you don’t use <span class="caps">RVM</span>, make sure you have committed the Gemfile and Gemfile.lock files to git so you can restore a known working version of your application if necessary.</p>
<h3>Change the Rails Version in the Gemfile</h3>
<p>In most cases, your Gemfile specifies the Rails version used by your application:</p>
<pre>
source 'https://rubygems.org'
gem 'rails', '3.2.12'
</pre>
<p>Change the Rails version to a newer version of Rails.</p>
<p>Then run:</p>
<pre>
$ bundle update rails
</pre>
<p>The Rails gem will be updated by bundler and the Gemfile.lock file will be updated to record the new gem version.</p>
<p>You’ll see a message showing which version of Rails is running when you start the webserver.</p>
<p>This approach is simple but doesn’t give you much flexibility.</p>
<h2>Using <span class="caps">RVM</span> and Updating Rails</h2>
<p>If you have installed rvm, the <a href="https://rvm.io/">Ruby Version Manager</a>, you’ll have greater flexibility in maintaining your Rails applications and updating Rails. With rvm, it’s convenient to preserve the set of gems that are known to work with your application. If you have difficulties with new gem versions, you can switch back to the older gemset easily, without reinstalling and compiling your old gems.</p>
<p>The article <a href="http://railsapps.github.com/installing-rails.html">Installing Rails</a> shows how to install multiple versions of Ruby and create gemsets for more than one version of Rails.</p>
<p>Let’s assume you have an application named “myapp” that runs with Ruby 1.9.3-p392 and Rails 3.2.12.</p>
<p>First, you’ll update it to Ruby 2.0 and Rails 3.2.13.rc1, a version of Rails patched for Ruby 2.0.</p>
<p>Then you’ll upgrade it to Ruby 2.0 and Rails 4.0.</p>
<p>If you followed the instructions in the article <a href="http://railsapps.github.com/installing-rails.html">Installing Rails</a>, you installed Ruby 1.9.3-p392 and Ruby 2.0.0-p0.</p>
<p>Start the upgrade in the application’s root directory:</p>
<pre>
$ cd myapp
</pre>
<h3>Ruby 1.9.3-p392 and Rails 3.2.12</h3>
<p>If you already have a project-specific gemset, rename it:</p>
<pre>
$ rvm gemset rename myapp Rails3.2.12_myapp
</pre>
<p>If not, create a project-specific gemset using Ruby 1.9.3-p392 and Rails 3.2.12:</p>
<pre>
$ rvm use ruby-1.9.3-p392@Rails3.2.12_myapp --create
$ rvm gemset list
$ bundle install
</pre>
<p>Test the application. It should be working as before.</p>
<h3>Ruby 2.0 and Rails 3.2.13</h3>
<p>Create a new project-specific gemset for Ruby 2.0 and Rails 3.2.13.rc1:</p>
<pre>
$ rvm use ruby-2.0.0@Rails3.2.13_myapp --create
$ rvm gemset list
</pre>
<p>Check that the only installed gems are those from the global gemset:</p>
<pre>
$ gem list
*** LOCAL GEMS ***
bundler (...)
rake (...)
rubygems-bundler (...)
rvm (...)
</pre>
<p>Check a list of <a href="http://rubygems.org/gems/rails">versions of Rails</a> to find the newest version of Rails 3.2.13.</p>
<p>Your Gemfile specifies the Rails version used by your application:</p>
<pre>
source 'https://rubygems.org'
gem 'rails', '3.2.12'
.
.
.
</pre>
<p>Change the Rails version to 3.2.13.rc1 (or a newer one if released).</p>
<p>Remove the Gemfile.lock file:</p>
<pre>
$ rm Gemfile.lock
</pre>
<p>Then install the gems specified in the Gemfile:</p>
<pre>
$ bundle install
</pre>
<p>Each gem specified in the Gemfile will be installed by bundler and a Gemfile.lock file will be created to record the gem versions. You can run <code>gem list</code> again to see the gems that were installed in the gemset.</p>
<p>Check the Rails version:</p>
<pre>
$ rails -v
</pre>
<p>Test the application and make any changes needed to run it with Ruby 2.0 and Rails 3.2.13.</p>
<p>Now repeat the process for Ruby 2.0 and Rails 4.0.</p>
<h3>Ruby 2.0 and Rails 4.0</h3>
<p>Create a new project-specific gemset for Ruby 2.0 and Rails 4.0.beta1:</p>
<pre>
$ rvm use ruby-2.0.0@Rails4.0_myapp --create
$ rvm gemset list
</pre>
<p>Check that the only installed gems are those from the global gemset:</p>
<pre>
$ gem list
*** LOCAL GEMS ***
bundler (...)
rake (...)
rubygems-bundler (...)
rvm (...)
</pre>
<p>Check for the <a href="http://rubygems.org/gems/rails">newest version of Rails</a>.</p>
<p>Your Gemfile specifies the Rails version used by your application:</p>
<pre>
source 'https://rubygems.org'
gem 'rails', '3.2.13.rc1'
.
.
.
</pre>
<p>Change the Rails version to 4.0.0.beta1 (or a newer version if released).</p>
<p>Remove the Gemfile.lock file:</p>
<pre>
$ rm Gemfile.lock
</pre>
<p>Then install the gems specified in the Gemfile:</p>
<pre>
$ bundle install
</pre>
<p>Each gem specified in the Gemfile will be installed by bundler and a Gemfile.lock file will be created to record the gem versions. You can run <code>gem list</code> again to see the gems that were installed in the gemset.</p>
<p>Check the Rails version:</p>
<pre>
$ rails -v
</pre>
<p>Test the application and make any changes needed to run it with Ruby 2.0 and Rails 4.0.</p>
<p>I recommend Andy Lindeman’s ebook <a href="http://www.upgradingtorails4.com/">Upgrading to Rails 4</a> as a guide to development with Rails 4.0. You can follow the progress of Rails 4.0 development on the <a href="http://www.edgerails.info/">EdgeRails.info</a> site.</p>
<h2>Rake Rails:Update</h2>
<p>Minor Rails version updates seldom require changes to configuration files. Major Rails updates often change configuration files. If you don’t make the required configuration file changes, you’ll likely see deprecation warnings when you launch a Rails application.</p>
<p>Rails provides a rake task to update configuration files. Be sure you’ve committed your application with git before running <code>rake rails:update</code> in case you need to roll back changes.</p>
<pre>
$ git commit -m 'before rake rails update'
$ rake rails:update
</pre>
<p>The <code>rake rails:update</code> will identify every configuration file in your application that differs from a new Rails application. When it detects a conflict, it will offer to overwrite your file.</p>
<p>Don’t blindly allow <code>rake rails:update</code> to overwrite your files. Many of your files will be different because you’ve made changes from a default new Rails application. You’ll need to check each file to determine if <code>rake rails:update</code> is seeing your own changes or pointing out changes due to a Rails update.</p>
<p>When <code>rake rails:update</code> offers to overwrite a file, enter <code>d</code> (for “diff”) and review the differences. Most differences will be your own. If you’re uncertain, don’t overwrite the file; make a note for yourself and investigate later. If you are certain that the difference is due to a Rails version change, you can allow <code>rake rails:update</code> to overwrite the file.</p>
<h3>Researching Changes to Configuration Files</h3>
<p>Instead of running <code>rake rails:update</code> on your application, it may be easier to use the rake command to compare two default Rails applications to identify changes to configuration files. Using the older version of Rails that you’ve used to build your application run <code>rails new my_old_app</code>. Update the “my_old_app” application to the newest version of Rails by changing the Gemfile and running <code>bundle update</code>. Then run <code>rake rails:update</code> to find how configuration files changed between versions.</p>
<h2>Updating Other Gems</h2>
<p>It’s important to update the Rails gem when there are security fixes. You’ll seldom need to update other gems once you’ve deployed your application but you may want to stay informed of changes. You can track updates to gems by creating an account and visiting your <a href="https://rubygems.org/dashboard">dashboard</a> at the RubyGems.org site. Search for each gem you use and “subscribe” to see a feed of updates in the dashboard (an <span class="caps">RSS</span> feed is available from the dashboard). As an alternative, use the <a href="https://gemnasium.com/">Gemnasium</a> service which surveys your GitHub repo and sends email notifications when gem versions change. Gemnasium is free for public repositories with a premium plan for private repositories.</p>
<p>You can update any gem by running <code>bundle update gem_name</code>. This installs the newest version of the gem (if the Gemfile entry doesn’t require a specific version) and updates the Gemfile.lock file.</p>
<p>You can run <code>bundle update</code> to update all gems at once. Bundler will observe the version rules specified in the Gemfile; when a specific version is specified in the Gemfile, running <code>bundle update</code> without changing the Gemfile entry won’t update a gem. Running <code>bundle update</code> installs new gem versions and updates the Gemfile.lock file. As an alternative to running <code>bundle update</code>, you can delete the Gemfile.lock file and run <code>bundle install</code> to replace the Gemfile.lock file.</p>
<p>If you are using rvm and multiple gemsets, it is best not to run <code>bundle update rails</code>. Instead, create a new gemset for the new Rails version as described above so you can switch gemsets as needed.</p>
<h2>Updating Your Application</h2>
<p>After updating Rails or other gems, run your test suite (hopefully, you have tests; this is why you need them!).</p>
<p>Often, when the changes to Rails are minor, you will not need to update your application. When a major new version of Rails is released, you may have to rework parts of your application. After major new Rails releases, many community members offer helpful blog posts (and even some gems) to identify specific code that needs to be updated for a new version of Rails. For example, there’s a Railscast from Ryan Bates titiled <a href="http://railscasts.com/episodes/318-upgrading-to-rails-3-2">Upgrading to Rails 3.2</a>.</p>
<h2>Security</h2>
<p>By design, Rails encourages practices that avoid common web application vulnerabilities. The Rails security team actively investigates and patches vulnerabilities. If you use the most current version of Rails, you will be protected from known vulnerabilities. See the <a href="http://guides.rubyonrails.org/security.html">Ruby On Rails Security Guide</a> for an overview of potential issues and watch the <a href="https://groups.google.com/forum/?fromgroups#!forum/rubyonrails-security">Ruby on Rails Security Mailing List</a> for announcements and discussion.</p>
<h3>Your Application’s Secret Token</h3>
<p>Rails uses a session store to provide persistence between page requests. The default session store uses cookies. To prevent decoding of cookie data and hijacking a session, Rails encypts cookie data using a secret key. When you create a new Rails application using the <code>rails new</code> command, a unique secret key is generated and written to the <strong>config/initializers/secret_token.rb</strong> file. If you’ve generated a Rails application and committed it only to a private GitHub repository, you do not need to change the secret key. However, if you’ve cloned a public GitHub repository or made your application publicly available on GitHub, you must change the secret key when you deploy. The command <code>rake secret</code> generates a new random secret you can use. The command won’t install the key; you have to copy the key from the console output to the <strong>config/initializers/secret_token.rb</strong> file. Remember, you should never deploy an application to production that uses a publicly available secret token (obviously, it is not secret if it is public!).</p>
<h2>Where to Get Help</h2>
<p>Your best source for help with problems is <a href="http://stackoverflow.com/questions/tagged/ruby-on-rails-3">Stack Overflow</a>. Your issue may have been encountered and addressed by others.</p>
<p>You can also try <a href="http://www.railshotline.com/">Rails Hotline</a>, a free telephone hotline for Rails help staffed by volunteers.</p>
    </div><!-- class="content" -->

    <div class="comments">
      <div class="content wikistyle gollum">
        <h2>Comments</h2>
      </div>
      <p>Is this helpful? Your encouragement fuels the project. Please tweet or add a comment. Couldn't get something to work? For the example apps and tutorials, it's best to open an issue on GitHub so we can help you.</p>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'railsapps'; // required: replace example with your forum shortname
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div><!-- class="comments" -->

    <footer class="footer row">
      <div class="span4">
      <dl class="footer_nav">
      <dt>RailsApps &#183; Getting Started</dt>
        <dd><a href="http://railsapps.github.com/ruby-and-rails.html">Ruby and Rails</a></dd>
        <dd><a href="http://railsapps.github.com/what-is-ruby-rails.html">What is Ruby? And Rails?</a></dd>
        <dd><a href="https://tutorials.railsapps.org/rails-tutorial">Rails Tutorial</a></dd>
        <dd><a href="http://railsapps.github.com/installing-rails.html">Installing Rails</a></dd>
        <dd><a href="http://railsapps.github.com/installing-rails-4.html">Installing Rails 4.0</a></dd>
        <dd><a href="http://railsapps.github.com/updating-rails.html">Updating Rails</a></dd>
        <dd><a href="http://railsapps.github.com/rails-composer/">Rails Composer</a></dd>
        <dd><a href="http://railsapps.github.com/">Rails Examples</a></dd>
        <dd><a href="http://railsapps.github.com/rails-examples-tutorials.html">Rails Starter Apps</a></dd>
      </dl>
      </div>
      <div class="span4">
      <dl class="footer_nav">
      <dt>RailsApps &#183; Articles</dt>
        <dd><a href="http://railsapps.github.com/rails-heroku-tutorial.html">Heroku and Rails</a></dd>
        <dd><a href="http://railsapps.github.com/twitter-bootstrap-rails.html">Twitter Bootstrap and Rails</a></dd>
        <dd><a href="http://railsapps.github.com/rails-javascript-include-external.html">JavaScript and Rails</a></dd>
        <dd><a href="http://railsapps.github.com/rails-environment-variables.html">Rails Environment Variables</a></dd>
        <dd><a href="http://railsapps.github.com/rails-git.html">Git and GitHub with Rails</a></dd>
        <dd><a href="http://railsapps.github.com/rails-send-email.html">Send Email with Rails</a></dd>
        <dd><a href="http://railsapps.github.com/rails-haml.html">Haml and Rails</a></dd>
        <dd><a href="http://railsapps.github.com/rails-default-application-layout.html">Rails Application Layout</a></dd>
        <dd><a href="http://railsapps.github.com/rails-html5-boilerplate.html">HTML5 Boilerplate for Rails</a></dd>
        <dd><a href="http://railsapps.github.com/rails-3-2-example-gemfile.html">Example Gemfiles for Rails</a></dd>
        <dd><a href="http://railsapps.github.com/rails-application-templates.html">Rails Application Templates</a></dd>
      </dl>
      </div>
      <div class="span4">
      <dl class="footer_nav">
      <dt>RailsApps &#183; Tutorials</dt>
        <dd><a href="https://tutorials.railsapps.org/rails3-bootstrap-devise-cancan">Devise with CanCan and Twitter Bootstrap</a></dd>
        <dd><a href="https://tutorials.railsapps.org/rails-stripe-membership-saas">Rails Membership Site with Stripe</a></dd>
        <dd><a href="https://tutorials.railsapps.org/rails-recurly-subscription-saas">Rails Subscription Site with Recurly</a></dd>
        <dd><a href="http://railsapps.github.com/tutorial-rails-prelaunch-signup.html">Startup Prelaunch Signup Application</a></dd>
        <dd><a href="http://railsapps.github.com/tutorial-rails-devise-rspec-cucumber.html">Devise with RSpec and Cucumber</a></dd>
        <dd><a href="http://railsapps.github.com/tutorial-rails-mongoid-devise.html">Devise with Mongoid</a></dd>
        <dd><a href="http://railsapps.github.com/tutorial-rails-mongoid-omniauth.html">OmniAuth with Mongoid</a></dd>
        <dd><a href="http://railsapps.github.com/tutorial-rails-subdomains.html">Subdomains with Devise</a></dd>
      </dl>
      </div>
      <hr class="footer-divider">
    </footer>

  </div>

  </body>
</html>
